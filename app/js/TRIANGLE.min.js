"use strict";var TRIANGLE=TRIANGLE||{};TRIANGLE.version="1.03.01";Element.prototype.remove=function(){this.parentElement.removeChild(this)};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var b=0,a=this.length;b<a;b++){if(this[b]&&this[b].parentElement){this[b].parentElement.removeChild(this[b])}}};TRIANGLE.iframe=function(){return document.getElementById("iframeTemplate")};TRIANGLE.iframe().getElementById=function(a){return TRIANGLE.iframe().contentDocument.getElementById(a)};TRIANGLE.iframe().getElementsByClassName=function(a){return TRIANGLE.iframe().contentDocument.getElementsByClassName(a)};TRIANGLE.iframe().getElementsByTriangleClass=function(a){return TRIANGLE.iframe().contentDocument.querySelectorAll("[triangle-class~="+a+"]")};TRIANGLE.iframe().getElementsByTagName=function(a){return TRIANGLE.iframe().contentDocument.getElementsByClassName(a)};TRIANGLE.iframe().getElementByUserId=function(a){return TRIANGLE.iframe().contentDocument.querySelector("[user-id="+a+"]")};TRIANGLE.iframe().querySelector=function(a){return TRIANGLE.iframe().contentDocument.querySelector(a)};TRIANGLE.iframe().querySelectorAll=function(a){return TRIANGLE.iframe().contentDocument.querySelectorAll(a)};TRIANGLE.iframe().getTriangleIndex=function(a){return TRIANGLE.iframe().contentDocument.querySelector("#template [triangle-index='"+a+"']")};TRIANGLE.templateWrapper=function(){return TRIANGLE.iframe().getElementById("templateWrapper")};TRIANGLE.template=function(){return TRIANGLE.iframe().getElementById("template")};TRIANGLE.templateItems=TRIANGLE.iframe().querySelectorAll("#template [triangle-class~=templateItem]");TRIANGLE.refreshTemplateItems=function(){var a=TRIANGLE.template().querySelectorAll("#template [triangle-class~=templateItem]");TRIANGLE.templateItems=null;TRIANGLE.templateItems=a;return a};TRIANGLE.item;TRIANGLE.itemStyles;TRIANGLE.scrollbarWidth;TRIANGLE.TemplateItem=function(a){this.index=parseInt(a);this.objRef=TRIANGLE.iframe().getTriangleIndex(this.index)||TRIANGLE.templateItems[this.index];this.prevItem=TRIANGLE.iframe().getTriangleIndex(this.index-1)||TRIANGLE.templateItems[a-1];this.nextItem=TRIANGLE.iframe().getTriangleIndex(this.index+1)||TRIANGLE.templateItems[a+1];this.parent=this.objRef.parentNode;this.childOf=this.objRef.getAttribute("triangle-childof");this.id=this.objRef.id;this.parentId=this.objRef.parentNode.id;this.className=this.objRef.className;this.triangleClass=this.objRef.getAttribute("triangle-class");this.triangleClassList=this.triangleClass?this.triangleClass.split(" "):[];this.textNodes=this.objRef.getElementsByClassName("textBox").length;this.tag=this.objRef.tagName.toLowerCase();this.resizing=false;this.align=this.objRef.getAttribute("item-align");this.isFirstChild=!this.prevSibling()?true:false;this.isLastChild=!this.nextSibling()?true:false;this.image=TRIANGLE.isType.imageItem(this.objRef)?this.objRef.children[0]:undefined;this.cropMap=this.objRef.getAttribute("crop-map")||false;this.cropRatio=this.objRef.getAttribute("crop-ratio")?parseFloat(this.objRef.getAttribute("crop-ratio")):false;this.linkTo=this.objRef.getAttribute("link-to")||false;this.userID=this.objRef.getAttribute("user-id")||false;this.userClass=this.objRef.getAttribute("user-class")||false;this.hover={};this.hover.cssText=this.objRef.getAttribute("hover-style")||"";this.hoverObj=TRIANGLE.iframe().getElementById(this.id+"hover");this.hoverVersion=this.hoverObj?true:false};TRIANGLE.TemplateItem.prototype.insertBeforeMe=function(a){this.parent.insertBefore(a,this.objRef)};TRIANGLE.TemplateItem.prototype.insertAfterMe=function(a){if(this.isLastChild){this.parent.appendChild(a)}else{this.parent.insertBefore(a,this.objRef.nextSibling)}};TRIANGLE.TemplateItem.prototype.append=function(a){this.objRef.appendChild(a)};TRIANGLE.TemplateItem.prototype.remove=function(){this.parent.removeChild(this.objRef);TRIANGLE.selectionBorder.remove()};TRIANGLE.TemplateItem.prototype.countTextNodes=function(){var b=this.objRef.querySelectorAll("[triangle-class~=textbox]");var a=b.length;for(var c=0;c<b.length;c++){a+=b[c].children.length}return a};TRIANGLE.TemplateItem.prototype.siblings=function(){var d=this.parent.children;var c=[];for(var b=0,a=0;a<d.length;a++){if(d[a].parentNode===this.parent&&d[a]!==this.objRef&&(d[a].classList.contains("templateItem")||(/templateItem/g).test(d[a].getAttribute("triangle-class")))){c[b]=d[a];b++}}return c};TRIANGLE.TemplateItem.prototype.prevSibling=function(){var c=this.parent.children;for(var a=c.length-1;a>=0;a--){if(c[a]===this.objRef){var b=this.index}if(parseInt(c[a].getAttribute("triangle-index"))<b&&c[a].parentNode===this.parent){return c[a]}}};TRIANGLE.TemplateItem.prototype.nextSibling=function(){var c=this.parent.children;for(var a=0;a<c.length;a++){if(c[a]===this.objRef){var b=this.index}if(parseInt(c[a].getAttribute("triangle-index"))>b&&c[a].parentNode===this.parent){return c[a]}}};TRIANGLE.TemplateItem.prototype.detectTransform=function(){if(this.objRef.style.transform){return this.objRef.style.transform}else{if(this.objRef.style.WebkitTransform){return this.objRef.style.WebkitTransform}else{if(this.objRef.style.msTransform){return this.objRef.style.msTransform}}}};TRIANGLE.TemplateItem.prototype.isAbove=function(b){var e=this.siblings();for(var a=0;a<e.length;a++){if(e[a]===TRIANGLE.iframe().getTriangleIndex(b)){var c=this.objRef.getBoundingClientRect();var d=e[a].getBoundingClientRect();if(d.bottom<=c.top&&c.top-d.bottom<=200){return true}else{return false}break}}};TRIANGLE.TemplateItem.prototype.isBelow=function(b){var e=this.siblings();for(var a=0;a<e.length;a++){if(e[a]===TRIANGLE.iframe().getTriangleIndex(b)){var c=this.objRef.getBoundingClientRect();var d=e[a].getBoundingClientRect();if(d.top>=c.bottom&&d.bottom-c.bottom<=200){return true}else{return false}break}}};TRIANGLE.TemplateItem.prototype.searchParentTree=function(b){var c=this.objRef;var a=new RegExp(b);while(c.id!="template"){if((a).test(c.className)){break}else{c=c.parentNode}}if(c.id!="template"){return true}else{return false}};TRIANGLE.TemplateItem.prototype.isType=function(a){return this.triangleClassList.includes(a)||this.objRef.classList.contains(a)};TRIANGLE.TemplateItem.prototype.addTriangleClass=function(a){if(!this.triangleClassList.includes(a)){this.objRef.setAttribute("triangle-class",this.triangleClass+" "+a)}};TRIANGLE.TemplateItem.prototype.removeTriangleClass=function(a){if(this.triangleClassList.includes(a)){this.objRef.setAttribute("triangle-class",this.triangleClass.replace(a,"").replace("  "," ").trim())}};TRIANGLE.updateTemplateItems=function(d){TRIANGLE.templateItems=TRIANGLE.refreshTemplateItems();TRIANGLE.resetClearFloat();for(var b=0;b<TRIANGLE.templateItems.length;b++){var c=new TRIANGLE.TemplateItem(b);c.objRef.addEventListener("mousedown",TRIANGLE.importItem.single,true);c.objRef.addEventListener("mouseover",TRIANGLE.hoverBorder.show,true);if(c.parent.getAttribute("triangle-class")&&!c.parent.getAttribute("triangle-class").includes("templateItem")){}else{if(!c.triangleClassList.includes("childItem")){c.addTriangleClass("childItem")}}if(c.triangleClassList.includes("textbox")){c.objRef.addEventListener("dblclick",TRIANGLE.text.editText)}else{c.objRef.removeEventListener("dblclick",TRIANGLE.text.editText)}TRIANGLE.templateItems[b].setAttribute("triangle-index",b);if(c.triangleClassList.includes("childItem")){if(c.parent.id==="template"){c.removeTriangleClass("childItem");c.objRef.setAttribute("triangle-childof","")}else{var a=c.parent.getAttribute("triangle-index");c.objRef.setAttribute("triangle-childof",a)}}if(TRIANGLE.isType.formField(c.objRef)){c.objRef.setAttribute("name","item"+b)}else{c.objRef.removeAttribute("name")}TRIANGLE.insertClearFloats(c)}TRIANGLE.dragDrop.updateItemMap();if(d){TRIANGLE.updateTemplateItems()}};TRIANGLE.selectItem=function(a){TRIANGLE.item=new TRIANGLE.TemplateItem(a);TRIANGLE.itemStyles=TRIANGLE.item.objRef.style;TRIANGLE.selectionBorder.update()};TRIANGLE.clearSelection=function(){TRIANGLE.selectionBorder.remove();TRIANGLE.selectedItemOptions.hide();for(var f=0;f<TRIANGLE.templateItems.length;f++){var g=TRIANGLE.iframe().getTriangleIndex(f);if(TRIANGLE.isType.textBox(g)){if(g.isContentEditable&&g!==TRIANGLE.iframe().contentDocument.activeElement){g.blur();TRIANGLE.text.checkTextEditing()}}}document.getElementById("templateTree").innerHTML="";var k=document.createElement("input");document.getElementById("dummyDiv").appendChild(k);k.focus();document.getElementById("dummyDiv").removeChild(k);var c=document.getElementById("menu");var h=c.querySelectorAll("input[type=text], input[type=number]");for(var f=0;f<h.length;f++){if(h[f].getAttribute("no-clear")=="true"){continue}h[f].value=""}var b=c.querySelectorAll("input[type=checkbox]");for(var f=0;f<b.length;f++){if(b[f].getAttribute("no-clear")=="true"){continue}b[f].checked=false}var d=c.getElementsByTagName("textarea");for(var f=0;f<d.length;f++){if(d[f].getAttribute("no-clear")=="true"){continue}d[f].value=""}var e=c.querySelectorAll("input[type=radio]");for(var f=0;f<e.length;f++){e[f].checked=false}TRIANGLE.developer.sessions.innerHTML.off("change",TRIANGLE.saveItem.innerHTML);TRIANGLE.developer.sessions.outerHTML.off("change",TRIANGLE.saveItem.outerHTML);TRIANGLE.developer.sessions.css.off("change",TRIANGLE.saveItem.cssStyles);TRIANGLE.developer.sessions.hover.off("change",TRIANGLE.saveItem.hoverStyles);TRIANGLE.developer.sessions.innerHTML.setValue("");TRIANGLE.developer.sessions.outerHTML.setValue("");TRIANGLE.developer.sessions.css.setValue("");TRIANGLE.developer.sessions.hover.setValue("");TRIANGLE.menu.toggleVisibility(0);TRIANGLE.colors.cancelCanvasMenu();var j=document.getElementById("fontType");var a=TRIANGLE.template().style.fontFamily.split(",")[0].replace(/'|"/g,"");if(!a){j.selectedIndex=0}else{for(var f=0;f<j.options.length;f++){if(j.options[f].text==a){j.selectedIndex=f;break}}}TRIANGLE.iframe().getElementById("updateAnimation").innerHTML="";document.getElementById("hrefTarget").value=0;document.getElementById("hrefTarget").disabled=true;TRIANGLE.text.importedHyperlink=null;TRIANGLE.updateTemplateItems();TRIANGLE.item=false};TRIANGLE.styleSheets={};TRIANGLE.deleteItem=function(a){var b=new TRIANGLE.TemplateItem(a);if(b.hoverVersion){TRIANGLE.iframe().getElementById("hoverItems").removeChild(b.hoverObj)}b.remove();TRIANGLE.text.deleteUnusedFonts();TRIANGLE.clearSelection()};TRIANGLE.menu={displaySubMenu:function displaySubMenu(c){var a=document.getElementsByClassName("subMenu");for(var b=0;b<a.length;b++){a[b].style.display="none"}document.getElementById(c).style.display="block"},addMenuBtnEvent:function(){var a=document.getElementsByClassName("mainOption");for(var b=0;b<a.length;b++){var c=a[b].getAttribute("onClick");c+="TRIANGLE.menu.menuBtnActive(this);";a[b].setAttribute("onClick",c)}},menuBtnActive:function menuBtnActive(c){var a=document.getElementsByClassName("mainOption");for(var b=0;b<a.length;b++){a[b].className="mainOption"}c.className+=" mainOptionActive"},toggleVisibility:function(c){var b=menu.getElementsByClassName("toggleVisibility");for(var a=0;a<b.length;a++){b[a].style.display=c?"inline-block":"none"}},toggleMenuDisplay:function toggleMenuDisplay(d,c){var a=document.getElementById("menu").querySelectorAll(".hidden");if(document.getElementById(d).style.display=="none"){for(var b=0;b<a.length;b++){a[b].style.display="none"}document.getElementById(d).style.display=c}else{document.getElementById(d).style.display="none"}},sideMenuId:null,openSideMenu:function openSideMenu(a){TRIANGLE.menu.sideMenuId=a;document.getElementById(a).style.display="block";document.getElementById("sideMenu").className="sideMenuOpen"},closeSideMenu:function closeSideMenu(){if(TRIANGLE.menu.sideMenuId){document.getElementById("sideMenu").className="sideMenuClose";document.getElementById(TRIANGLE.menu.sideMenuId).style.display="none";TRIANGLE.menu.sideMenuId=null}},displayLibraryCategory:function(b){var a=document.getElementById(b);if(a.style.display!=="none"){a.style.display="none"}else{a.style.display="block"}}};TRIANGLE.importItem={group:[],groupIndex:function(a,c){a=parseInt(a);if(TRIANGLE.importItem.group.indexOf(a)===-1){TRIANGLE.importItem.group[TRIANGLE.importItem.group.length]=a;TRIANGLE.importItem.group.sort()}else{if(TRIANGLE.importItem.group.length>1){var b=TRIANGLE.importItem.group.indexOf(parseInt(a));TRIANGLE.importItem.group.splice(b,1)}}},currentUserClass:false,single:function importItem(i,r){if(isNaN(parseInt(i))){r=i;try{i=this.getAttribute("triangle-index")}catch(t){return}if(r.shiftKey){TRIANGLE.importItem.groupIndex(i,r)}else{TRIANGLE.importItem.group=[parseInt(i)]}}else{if(r&&r.shiftKey){TRIANGLE.importItem.groupIndex(i,r)}else{if(!isNaN(parseInt(i))){TRIANGLE.importItem.group=[parseInt(i)]}}}var b=i;if(arguments.length>1){b=arguments[0]}else{if(arguments.length===1&&((/\d/).test(arguments[0])||parseInt(arguments[0]))){b=arguments[0]}else{if(this){b=this.getAttribute("triangle-index")}else{return}}}TRIANGLE.selectItem(b);TRIANGLE.selectionBorder.create(r);s();d();k();g();o();c();h();q();TRIANGLE.importItem.importColors();n();u();a();v();p();m();j();TRIANGLE.importItem.importCodeSnippet();TRIANGLE.importItem.importInnerHTML();TRIANGLE.importItem.importOuterHTML();TRIANGLE.importItem.importCSSText();TRIANGLE.importItem.importHoverCSSText();TRIANGLE.menu.toggleVisibility(1);TRIANGLE.updateTemplateItems();function s(){document.getElementById("bgColor").value=(/rgba/).test(TRIANGLE.itemStyles.backgroundColor)?TRIANGLE.itemStyles.backgroundColor:TRIANGLE.colors.rgbToHex(TRIANGLE.itemStyles.backgroundColor)}function d(){document.getElementById("height").value=TRIANGLE.itemStyles.height||TRIANGLE.itemStyles.minHeight;document.getElementById("heightLabel").innerHTML="H: "+document.getElementById("height").value;document.getElementById("dimensionLabels").style.display="inline-block"}function k(){document.getElementById("width").value=TRIANGLE.itemStyles.width;document.getElementById("widthLabel").innerHTML="W: "+TRIANGLE.itemStyles.width;document.getElementById("dimensionLabels").style.display="inline-block"}function g(){document.getElementById("display").value=TRIANGLE.itemStyles.display}function o(){var w=document.getElementById("paddingSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");document.getElementById("padding").value=TRIANGLE.itemStyles["padding"+w]}function c(){var w=document.getElementById("marginSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");document.getElementById("margin").value=TRIANGLE.itemStyles["margin"+w]}function h(){var x=document.getElementById("borderSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");var w=["solid","dashed","dotted"];document.getElementById("borderWidth").value=TRIANGLE.itemStyles["border"+x+"Width"];document.getElementById("borderStyle").selectedIndex=w.indexOf(TRIANGLE.itemStyles["border"+x+"Style"]);document.getElementById("borderColor").value=(/rgb/).test(TRIANGLE.itemStyles["border"+x+"Color"])?TRIANGLE.colors.rgbToHex(TRIANGLE.itemStyles["border"+x+"Color"]):TRIANGLE.itemStyles["border"+x+"Color"]}function q(){var y=TRIANGLE.itemStyles.boxShadow.replace(/rgb(a)?\((\d+), ?(\d+), ?(\d+)(,)? ?(\d*\.?\d*)?\)/g,"rgb$1($2,$3,$4$5$6)").split(" ");var A=document.getElementById("boxShadowH");var x=document.getElementById("boxShadowV");var w=document.getElementById("boxShadowBlur");var z=document.getElementById("boxShadowColor");var B=-1;if(isNaN(parseInt(y[0]))){z.value=y[0];A.value=y[1];x.value=y[2];w.value=y[3]}else{if(isNaN(parseInt(y[1]))){z.value=y[1];A.value=y[0];x.value=y[2];w.value=y[3]}else{if(isNaN(parseInt(y[2]))){z.value=y[2];A.value=y[0];x.value=y[1];w.value=y[3]}else{if(isNaN(parseInt(y[3]))){z.value=y[3];A.value=y[0];x.value=y[1];w.value=y[2]}}}}if(A.value==""||A.value=="undefined"){A.value=""}if(x.value==""||x.value=="undefined"){x.value=""}if(w.value==""||w.value=="undefined"){w.value=""}if(z.value==""||z.value=="undefined"){z.value="black"}}function n(){document.getElementById("fontColor").value=TRIANGLE.colors.rgbToHex(TRIANGLE.itemStyles.color);document.getElementById("fontSize").value=TRIANGLE.itemStyles.fontSize;document.getElementById("fontLineHeight").value=TRIANGLE.itemStyles.lineHeight;document.getElementById("fontWeight").value=TRIANGLE.itemStyles.fontWeight;var w=document.getElementById("fontType");for(var x=0;x<w.options.length;x++){if(w.options[x].text==TRIANGLE.itemStyles.fontFamily.split(",")[0].replace(/'|"/g,"")){w.selectedIndex=x;break}}}function u(){if(TRIANGLE.item.userID){document.getElementById("userID").value=TRIANGLE.item.userID}else{document.getElementById("userID").value=""}}function a(){if(TRIANGLE.item.userClass){document.getElementById("userClass").value=TRIANGLE.item.userClass;TRIANGLE.importItem.currentUserClass=TRIANGLE.item.objRef}else{document.getElementById("userClass").value="";TRIANGLE.importItem.currentUserClass=false}}function v(){if(TRIANGLE.text.importedHyperlink===null){var x=TRIANGLE.item.objRef.firstChild?TRIANGLE.item.objRef.firstChild.tagName:null;if(TRIANGLE.item.linkTo||x==="A"){var w;if(TRIANGLE.item.linkTo){w=TRIANGLE.item.linkTo}else{w=TRIANGLE.item.objRef.children[0].getAttribute("href")}if(w){document.getElementById("hrefHyperlink").disabled=false;document.getElementById("hrefHyperlink").value=w}else{document.getElementById("hrefHyperlink").disabled=true}}else{document.getElementById("hrefHyperlink").disabled=true}}}function p(){if(TRIANGLE.text.importedHyperlink===null){var z=TRIANGLE.item.objRef.firstChild?TRIANGLE.item.objRef.firstChild.tagName:null;var A=document.getElementById("hrefTarget");if(TRIANGLE.item.objRef.children.length===1&&z==="A"){var y=TRIANGLE.item.objRef.children[0].getAttribute("target");A.disabled=false;var w=0;for(var x=0;x<A.length;x++){if(y===A.options[x].text){w=x}}A.selectedIndex=w}else{if(TRIANGLE.item.linkTo){var y=TRIANGLE.item.objRef.getAttribute("target");A.disabled=false;var w=0;for(var x=0;x<A.length;x++){if(y===A.options[x].text){w=x}}A.selectedIndex=w}else{A.selectedIndex=0;A.disabled=true}}}}function l(){if(TRIANGLE.isType.snippetItem(TRIANGLE.item.objRef)){var w=TRIANGLE.item.objRef.innerHTML;document.getElementById("snippetInsertion").value=w;if(TRIANGLE.developer.currentCode==="snippetInsertion"){document.getElementById("codeEditor").value=w}}else{document.getElementById("snippetInsertion").value="";if(TRIANGLE.developer.currentCode==="snippetInsertion"){document.getElementById("codeEditor").value=""}}}function m(){if(TRIANGLE.item.tag.toLowerCase()==="form"&&TRIANGLE.item.objRef.getAttribute("form-email")){document.getElementById("formEmail").value=TRIANGLE.item.objRef.getAttribute("form-email")}else{document.getElementById("formEmail").value=""}}function j(){return;if(TRIANGLE.item){var x=TRIANGLE.item.objRef;while(x.parentNode.id!="template"){var w=document.createElement("span");w.className="treeBtn";w.innerText=x.tagName;document.getElementById("templateTree").appendChild(w);x=x.parentNode}}}function f(){var w=TRIANGLE.itemStyles.cssText.replace(/;\s*/g,";\n");document.getElementById("cssStyles").value=w;if(TRIANGLE.developer.currentCode==="cssStyles"){document.getElementById("codeEditor").value=w}}function e(){if(TRIANGLE.item.hover.cssText){var w=TRIANGLE.item.hover.cssText.replace(/;\s*/g,";\n");document.getElementById("hoverStyles").value=w;if(TRIANGLE.developer.currentCode==="hoverStyles"){document.getElementById("codeEditor").value=w}}}},importCodeSnippet:function(){if(TRIANGLE.item){if(TRIANGLE.isType.snippetItem(TRIANGLE.item.objRef)){var a=TRIANGLE.item.objRef.innerHTML;document.getElementById("snippetInsertion").value=a;TRIANGLE.developer.sessions.codeSnippet.setValue(a)}else{document.getElementById("snippetInsertion").value="";TRIANGLE.developer.sessions.codeSnippet.setValue("")}}},importInnerHTML:function(){console.log("yo");if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){console.log("hey");TRIANGLE.developer.sessions.innerHTML.setValue(TRIANGLE.item.objRef.innerHTML);TRIANGLE.developer.sessions.innerHTML.on("change",TRIANGLE.saveItem.innerHTML)}},importOuterHTML:function(){if(TRIANGLE.item){TRIANGLE.developer.sessions.outerHTML.setValue(TRIANGLE.item.objRef.outerHTML);TRIANGLE.developer.sessions.outerHTML.on("change",TRIANGLE.saveItem.outerHTML)}},importCSSText:function importCSSText(){if(TRIANGLE.item){var a=TRIANGLE.itemStyles.cssText.replace(/;\s*/g,";\n")||"";TRIANGLE.developer.sessions.css.setValue(a);TRIANGLE.developer.sessions.css.on("change",TRIANGLE.saveItem.cssStyles)}},importHoverCSSText:function(){if(TRIANGLE.item){var a=TRIANGLE.item.hover.cssText.replace(/;\s*/g,";\n")||"";a=a.match(/[^:]+:[^;]+;/g)?a:"";TRIANGLE.developer.sessions.hover.setValue(a);TRIANGLE.developer.sessions.hover.on("change",TRIANGLE.saveItem.hoverStyles)}},importColors:function importColors(){var a=document.getElementById("colorListBorderL");var e=document.getElementById("colorListBorderR");var b=document.getElementById("colorListBorderT");var h=document.getElementById("colorListBorderB");if(TRIANGLE.itemStyles.backgroundColor!==""){if(TRIANGLE.itemStyles.backgroundColor=="inherit"){document.getElementById("colorElementBg").style.backgroundColor=TRIANGLE.item.parent.style.backgroundColor}else{document.getElementById("colorElementBg").style.backgroundColor=TRIANGLE.itemStyles.backgroundColor}}if(TRIANGLE.itemStyles.borderLeftColor!==""||TRIANGLE.itemStyles.borderRightColor!==""||TRIANGLE.itemStyles.borderTopColor!==""||TRIANGLE.itemStyles.borderBottomColor!==""){if(TRIANGLE.itemStyles.borderLeftColor!==""&&TRIANGLE.itemStyles.borderLeftWidth!==""&&TRIANGLE.itemStyles.borderLeftColor!==""){if(f(TRIANGLE.item.borderLeftColor)){TRIANGLE.item.objRef.style.borderLeftColor="black";TRIANGLE.itemStyles.borderLeftColor="black"}a.style.backgroundColor=TRIANGLE.itemStyles.borderLeftColor}if(TRIANGLE.itemStyles.borderRightColor!==""&&TRIANGLE.itemStyles.borderRightWidth!==""&&TRIANGLE.itemStyles.borderRightColor!==""){if(f(TRIANGLE.item.borderRightColor)){TRIANGLE.item.objRef.style.borderRightColor="black";TRIANGLE.itemStyles.borderRightColor="black"}e.style.backgroundColor=TRIANGLE.itemStyles.borderRightColor}if(TRIANGLE.itemStyles.borderTopColor!==""&&TRIANGLE.itemStyles.borderTopWidth!==""&&TRIANGLE.itemStyles.borderTopColor!==""){if(f(TRIANGLE.item.borderTopColor)){TRIANGLE.item.objRef.style.borderTopColor="black";TRIANGLE.itemStyles.borderTopColor="black"}b.style.backgroundColor=TRIANGLE.itemStyles.borderTopColor}if(TRIANGLE.itemStyles.borderBottomColor!==""&&TRIANGLE.itemStyles.borderBottomWidth!==""&&TRIANGLE.itemStyles.borderBottomColor!==""){if(f(TRIANGLE.item.borderBottomColor)){TRIANGLE.item.objRef.style.borderBottomColor="black";TRIANGLE.itemStyles.borderBottomColor="black"}h.style.backgroundColor=TRIANGLE.itemStyles.borderBottomColor}}function f(i){if(i=="initial"||(/-/g).test(i)||i=="currentColor"){return true}else{return false}}if(TRIANGLE.itemStyles.boxShadow!==""){var g=document.getElementById("colorBoxShadow");var d=TRIANGLE.itemStyles.boxShadow.split(" ");for(var c=0;c<d.length;c++){if((/rgb/).test(d[c])){g.style.backgroundColor=TRIANGLE.colors.rgbToHex(d[c]+" "+d[c+1]+" "+d[c+2])}else{if((/#/).test(d[c])){g.style.backgroundColor=d[c]}else{if(!(/\d+/g).test(d[c])){g.style.backgroundColor=d[c]}else{continue}}}}}if(TRIANGLE.isType.textBox(TRIANGLE.item.objRef)&&TRIANGLE.itemStyles.color!==""){if(TRIANGLE.itemStyles.color=="inherit"){document.getElementById("colorFont").style.backgroundColor=TRIANGLE.item.parent.style.color}else{document.getElementById("colorFont").style.backgroundColor=TRIANGLE.itemStyles.color}}}};TRIANGLE.saveItem={applyChanges:function applyChanges(){TRIANGLE.selectionBorder.remove();TRIANGLE.hoverBorder.hide();f();if(this&&this.id==="height"){TRIANGLE.item.objRef.classList.contains("imageItem")?e():m()}else{if(this&&this.id==="width"){TRIANGLE.item.objRef.classList.contains("imageItem")?b():i()}else{TRIANGLE.item.objRef.classList.contains("imageItem")?e():m();TRIANGLE.item.objRef.classList.contains("imageItem")?b():i()}}c();o();d();a();n();k();g();l();TRIANGLE.selectItem(TRIANGLE.item.index);TRIANGLE.importItem.importColors();TRIANGLE.importItem.importCSSText();TRIANGLE.importItem.importHoverCSSText();TRIANGLE.updateTemplateItems();function f(){var q=document.getElementById("bgColor");if((/#*(\d[a-f]*|[a-f]\d*){3,6}/g).test(q.value)&&!(/rgb/).test(q.value)){var p=q.value=q.value.replace(/#+/g,"#");TRIANGLE.saveItem.createAnimation("background-color",TRIANGLE.itemStyles.backgroundColor,p,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.backgroundColor=p;document.getElementById("colorElementBg").style.backgroundColor=p}else{TRIANGLE.saveItem.createAnimation("background-color",TRIANGLE.itemStyles.backgroundColor,q.value,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.backgroundColor=q.value;document.getElementById("colorElementBg").style.backgroundColor=q.value}}function m(){var p=document.getElementById("height");if(p.value==""){TRIANGLE.saveItem.createAnimation("height",TRIANGLE.itemStyles.height,"auto",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.height="auto"}else{if(!TRIANGLE.getUnit(p.value)){TRIANGLE.saveItem.createAnimation("height",TRIANGLE.itemStyles.height,p.value+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.height=p.value+"px"}else{TRIANGLE.saveItem.createAnimation("height",TRIANGLE.itemStyles.height,p.value,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.height=p.value}}}function i(){var p=document.getElementById("width");if(parseInt(p.value)==0){TRIANGLE.item.objRef.style.width="3px"}else{if(!TRIANGLE.getUnit(p.value)){TRIANGLE.saveItem.createAnimation("width",TRIANGLE.itemStyles.width,p.value+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.width=p.value+"px"}else{TRIANGLE.saveItem.createAnimation("width",TRIANGLE.itemStyles.width,p.value,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.width=p.value}}}function e(){var p=document.getElementById("height");if(p.value=="auto"){TRIANGLE.item.objRef.style.height="auto"}if(parseInt(p.value)===0){TRIANGLE.item.objRef.style.minHeight="3px"}else{if(!TRIANGLE.getUnit(p.value)){TRIANGLE.saveItem.createAnimation("min-height",TRIANGLE.itemStyles.minHeight,p.value+"px");TRIANGLE.item.objRef.style.minHeight=p.value+"px";if(parseFloat(p.value)<TRIANGLE.item.objRef.getBoundingClientRect().height){TRIANGLE.item.objRef.style.height=p.value+"px"}}else{if(TRIANGLE.getUnit(p.value)!="%"){TRIANGLE.saveItem.createAnimation("min-height",TRIANGLE.itemStyles.minHeight,p.value);TRIANGLE.item.objRef.style.minHeight=p.value;if(parseFloat(p.value)<parseFloat(TRIANGLE.item.objRef.style.height)){TRIANGLE.item.objRef.style.height=p.value}}}}var r=TRIANGLE.item.cropRatio;if(r){setTimeout(q,325)}function q(){TRIANGLE.selectionBorder.remove();var s=TRIANGLE.item.objRef.getBoundingClientRect().height;var u=TRIANGLE.item.objRef.getBoundingClientRect().width;var t=Math.round(s*r);document.getElementById("width").value=t+"px";TRIANGLE.saveItem.createAnimation("width",u+"px",t+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.width=t+"px"}}function b(){var q=document.getElementById("width");if(parseInt(q.value)===0){TRIANGLE.item.objRef.style.width="3px"}else{if(!TRIANGLE.getUnit(q.value)){TRIANGLE.saveItem.createAnimation("width",TRIANGLE.itemStyles.width,q.value+"px");TRIANGLE.item.objRef.style.width=q.value+"px"}else{TRIANGLE.saveItem.createAnimation("width",TRIANGLE.itemStyles.width,q.value);TRIANGLE.item.objRef.style.width=q.value}}var r=TRIANGLE.item.cropRatio;if(r){setTimeout(p,325)}function p(){TRIANGLE.selectionBorder.remove();var s=TRIANGLE.item.objRef.getBoundingClientRect().width;var t=TRIANGLE.item.objRef.getBoundingClientRect().height;var u=Math.round(s/r);document.getElementById("height").value=u+"px";if(u<t){TRIANGLE.item.objRef.style.height="1px";TRIANGLE.saveItem.createAnimation("min-height",t+"px",u+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.height=TRIANGLE.item.objRef.style.minHeight=u+"px"}else{TRIANGLE.saveItem.createAnimation("height",t+"px",u+"px",function(){TRIANGLE.item.objRef.style.minHeight=u+"px";TRIANGLE.selectionBorder.create()});TRIANGLE.item.objRef.style.height=u+"px"}}}function c(){var p=document.getElementById("display");TRIANGLE.item.objRef.style.display=p.value;if(p.value=="none"){p.value="block"}}function o(){var q=document.getElementById("paddingSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");var r=q?"-":"";var p=document.getElementById("padding").value;if(parseInt(p)==0){TRIANGLE.saveItem.createAnimation("padding"+r+q,TRIANGLE.itemStyles["padding"+q],0,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["padding"+q]=""}else{if(!TRIANGLE.getUnit(p)&&p!==""){TRIANGLE.saveItem.createAnimation("padding"+r+q,TRIANGLE.itemStyles["padding"+q],p+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["padding"+q]=p+"px"}else{TRIANGLE.saveItem.createAnimation("padding"+r+q,TRIANGLE.itemStyles["padding"+q],p,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["padding"+q]=p}}}function j(){var p=document.getElementById("marginSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");var q=p?"-":"";var r=document.getElementById("margin").value;if(parseInt(r)==0){TRIANGLE.saveItem.createAnimation("margin"+q+p,TRIANGLE.itemStyles["margin"+p],0,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["margin"+p]=""}else{if(!TRIANGLE.getUnit(r)&&r!==""){TRIANGLE.saveItem.createAnimation("margin"+q+p,TRIANGLE.itemStyles["margin"+p],r+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["margin"+p]=r+"px"}else{TRIANGLE.saveItem.createAnimation("margin"+q+p,TRIANGLE.itemStyles["margin"+p],r,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["margin"+p]=r}}}function h(){var s=document.getElementById("borderSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");var v=s?"-":"";var r=document.getElementById("borderWidth").value;var u=document.getElementById("borderStyle");var t=u.selectedIndex>=0?u.options[u.selectedIndex].text:"";var p=document.getElementById("borderColor").value;if(parseInt(r)==0||r==""){TRIANGLE.saveItem.createAnimation("border"+v+s,TRIANGLE.itemStyles["border"+s],"",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["border"+s]=""}else{var q=parseInt(r)+"px "+t+" "+p;TRIANGLE.saveItem.createAnimation("border"+v+s,TRIANGLE.item["border"+s],q,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["border"+s]=q;document.getElementById("colorListBorder").style.backgroundColor=p}}function d(){var s=TRIANGLE.item;var t=document.getElementById("boxShadowH");var q=document.getElementById("boxShadowV");var p=document.getElementById("boxShadowBlur");var r=document.getElementById("boxShadowColor");if((parseInt(t.value)==0&&parseInt(q.value)==0&&parseInt(p.value)==0)||(t.value==""&&q.value==""&&p.value=="")){TRIANGLE.saveItem.createAnimation("box-shadow",TRIANGLE.itemStyles.boxShadow,"",TRIANGLE.selectionBorder.create);s.objRef.style.boxShadow=""}else{var u=parseInt(t.value)+"px "+parseInt(q.value)+"px "+parseInt(p.value)+"px "+r.value;TRIANGLE.saveItem.createAnimation("box-shadow",TRIANGLE.itemStyles.boxShadow,u,TRIANGLE.selectionBorder.create);s.objRef.style.boxShadow=u}}function a(){var r=document.getElementById("fontColor");var q=document.getElementById("fontSize");var p=document.getElementById("fontLineHeight");var s=document.getElementById("fontWeight");TRIANGLE.saveItem.createAnimation("color",TRIANGLE.itemStyles.color,r.value,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.color=r.value;if((/\D/g).test(q.value)){TRIANGLE.saveItem.createAnimation("font-size",TRIANGLE.itemStyles.fontSize,q.value,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.fontSize=q.value}else{TRIANGLE.saveItem.createAnimation("font-size",TRIANGLE.itemStyles.fontSize,q.value+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style.fontSize=q.value+"px"}TRIANGLE.item.objRef.style.lineHeight=p.value;TRIANGLE.item.objRef.style.fontWeight=s.value}function n(){var p=document.getElementById("userID").value.replace(/ /g,"-");if(p!==""){p=TRIANGLE.library.removeDuplicateUserIDs(p);TRIANGLE.item.objRef.setAttribute("user-id",p);setTimeout(TRIANGLE.selectionBorder.create,TRIANGLE.saveItem.animationTime)}else{TRIANGLE.item.objRef.removeAttribute("user-id")}}function l(){var r=document.getElementById("userClass").value.replace(/ /g,"-");if(r!==""&&document.getElementById("userClass")===document.activeElement){TRIANGLE.item.objRef.setAttribute("user-class",r);setTimeout(TRIANGLE.selectionBorder.create,TRIANGLE.saveItem.animationTime);var q=TRIANGLE.template();var p=q.querySelectorAll("[user-class~="+r+"]");if(p.length>1){if(p[0]!=TRIANGLE.item.objRef){TRIANGLE.item.objRef.style.cssText=p[0].style.cssText}else{TRIANGLE.item.objRef.style.cssText=p[1].style.cssText}}else{if(TRIANGLE.userClasses&&TRIANGLE.userClasses[r]){TRIANGLE.item.objRef.style.cssText=TRIANGLE.userClasses[r]}}}else{if(r!==""&&document.getElementById("userClass")!=document.activeElement){TRIANGLE.saveItem.equalizeUserClasses(r)}else{TRIANGLE.item.objRef.removeAttribute("user-class")}}}function k(){var p=document.getElementById("hrefHyperlink").value;if(p!==""){if(TRIANGLE.text.importedHyperlink!=null){TRIANGLE.text.importedHyperlink.setAttribute("href",p)}else{if(!TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){TRIANGLE.item.objRef.setAttribute("link-to",p)}else{TRIANGLE.item.objRef.children[0].setAttribute("href",p)}}setTimeout(TRIANGLE.selectionBorder.create,TRIANGLE.saveItem.animationTime)}}function g(){if(TRIANGLE.item.tag.toLowerCase()==="form"){var p=document.getElementById("formEmail");TRIANGLE.item.objRef.setAttribute("form-email",p.value);setTimeout(TRIANGLE.selectionBorder.create,TRIANGLE.saveItem.animationTime)}}},saveMargin:function saveMargin(){if(TRIANGLE.item){TRIANGLE.selectionBorder.remove();TRIANGLE.hoverBorder.hide();var a=document.getElementById("marginSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");var b=a?"-":"";var c=document.getElementById("margin").value;if(parseInt(c)==0){TRIANGLE.saveItem.createAnimation("margin"+b+a,TRIANGLE.itemStyles["margin"+a],0,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["margin"+a]=0}else{if(!TRIANGLE.getUnit(c)&&c!==""){TRIANGLE.saveItem.createAnimation("margin"+b+a,TRIANGLE.itemStyles["margin"+a],c+"px",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["margin"+a]=c+"px"}else{TRIANGLE.saveItem.createAnimation("margin"+b+a,TRIANGLE.itemStyles["margin"+a],c,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["margin"+a]=c}}TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass);TRIANGLE.selectItem(TRIANGLE.item.index)}},saveBorder:function saveBorder(){if(TRIANGLE.item){TRIANGLE.selectionBorder.remove();TRIANGLE.hoverBorder.hide();var d=document.getElementById("borderSide").querySelector(".edgeOptionActive").getAttribute("data-triangle-side");var g=d?"-":"";var c=document.getElementById("borderWidth").value;var f=document.getElementById("borderStyle");var e=f.selectedIndex>=0?f.options[f.selectedIndex].text:"";var a=document.getElementById("borderColor").value;if(parseInt(c)==0||c==""){TRIANGLE.saveItem.createAnimation("border"+g+d,TRIANGLE.itemStyles["border"+d],"",TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["border"+d]=""}else{var b=parseInt(c)+"px "+e+" "+a;TRIANGLE.saveItem.createAnimation("border"+g+d,TRIANGLE.item["border"+d],b,TRIANGLE.selectionBorder.create);TRIANGLE.item.objRef.style["border"+d]=b;document.getElementById("colorListBorder").style.backgroundColor=a}TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass);TRIANGLE.selectItem(TRIANGLE.item.index)}},applyAll:function(d,a){var c=document.getElementById(d[0]).value;for(var b=1;b<d.length;b++){document.getElementById(d[b]).value=c}if(!a){TRIANGLE.saveItem.applyChanges()}},codeSnippet:function(a){if(TRIANGLE.item&&TRIANGLE.isType.snippetItem(TRIANGLE.item.objRef)){TRIANGLE.developer.insertSnippet()}},innerHTML:function(){var b=TRIANGLE.developer.sessions.innerHTML.getValue();if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){var a=TRIANGLE.item.index;TRIANGLE.item.objRef.innerHTML=b;TRIANGLE.updateTemplateItems();TRIANGLE.selectItem(a);TRIANGLE.selectionBorder.update()}},outerHTML:function(){var b=TRIANGLE.developer.sessions.outerHTML.getValue();if(TRIANGLE.item&&b!==""&&b!==TRIANGLE.item.objRef.outerHTML){var a=TRIANGLE.item.index;TRIANGLE.item.objRef.outerHTML=b;TRIANGLE.updateTemplateItems();TRIANGLE.selectItem(a);TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass);TRIANGLE.selectionBorder.update()}},cssStyles:function(){if(TRIANGLE.item){var a=TRIANGLE.developer.sessions.css.getValue().match(/[^:]+:\s*[^;]+;\s*/g);if(a!=null){TRIANGLE.item.objRef.style.cssText=a.reduce(function(b,c){return b+c})}TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass);TRIANGLE.selectionBorder.update()}},hoverStyles:function(){if(TRIANGLE.item){var a=TRIANGLE.developer.sessions.hover.getValue().match(/[^:]+:\s*[^;]+;\s*/g);if(a!=null){TRIANGLE.item.objRef.setAttribute("hover-style",a.reduce(function(b,c){return b+c}))}else{TRIANGLE.item.objRef.removeAttribute("hover-style")}TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass)}},equalizeUserClasses:function(a){if(TRIANGLE.item){var c=TRIANGLE.template().querySelectorAll("[user-class="+a+"]");for(var b=0;b<c.length;b++){if(c[b]!=TRIANGLE.item.objRef){c[b].style.cssText=TRIANGLE.itemStyles.cssText;c[b].setAttribute("hover-style",TRIANGLE.item.objRef.getAttribute("hover-style"))}}}},animationActive:false,animationTime:320,createAnimation:function createAnimation(c,e,a,d){if(TRIANGLE.enable.animations){var b="@keyframes updateAnimation {from{"+c+":"+e+"}to{"+c+":"+a+"}}[triangle-index='"+TRIANGLE.item.index+"']{"+c+":"+a+";animation-name:updateAnimation;animation-duration:300ms}";if(e!==a){TRIANGLE.iframe().getElementById("updateAnimation").innerHTML=b;TRIANGLE.saveItem.animationActive=true;setTimeout(function(){TRIANGLE.iframe().getElementById("updateAnimation").innerHTML="";TRIANGLE.saveItem.animationActive=false;if(d&&typeof d=="function"){d()}},TRIANGLE.saveItem.animationTime)}}else{if(e!==a&&d&&typeof d=="function"){d()}}},exportLibraryItemCode:function exportLibraryItemCode(){if(TRIANGLE.item){TRIANGLE.notify.info.show(TRIANGLE.item.objRef.outerHTML);console.log(TRIANGLE.item.objRef.outerHTML)}}};TRIANGLE.saveTemplate={getSaveName:function getSaveName(){TRIANGLE.popUp.open("getSaveNameCell");document.getElementById("saveTemplateName").focus();TRIANGLE.menu.closeSideMenu()},getPageName:function getPageName(){TRIANGLE.popUp.open("getPageNameCell");document.getElementById("savePageName").focus();TRIANGLE.menu.closeSideMenu()},saveTemplate:function saveTemplate(b,a){TRIANGLE.notify.saving.show();TRIANGLE.text.deleteUnusedFonts();b=encodeURIComponent(b);a=a||"index";a=encodeURIComponent(a);var d=TRIANGLE.json.encode();d=encodeURIComponent(d);var c=encodeURIComponent(TRIANGLE.developer.globalStyleTagContent);var f=encodeURIComponent(TRIANGLE.developer.globalScriptTagContent);var e="templateName="+b+"&pageName="+a+"&instance="+TRIANGLE.instance+"&content="+d+"&globalStyle="+c+"&globalScript="+f;AJAX.post("php/save_template.php",e,function(g){TRIANGLE.clearSelection();TRIANGLE.updateTemplateItems();TRIANGLE.saveTemplate.saveUserIDs();TRIANGLE.saveTemplate.saveUserClasses();if(b){TRIANGLE.currentTemplate=b}TRIANGLE.currentPage=a;TRIANGLE.unsaved=false;TRIANGLE.notify.saving.hide();TRIANGLE.notify.saved.show();if(TRIANGLE.exportTemplate.callbackAfterSave){TRIANGLE.exportTemplate.callbackAfterSave();TRIANGLE.exportTemplate.callbackAfterSave=false}else{TRIANGLE.loadTemplate.openURL(TRIANGLE.currentTemplate,TRIANGLE.currentPage)}})},cancelSave:function cancelSave(){TRIANGLE.popUp.close();document.getElementById("saveTemplateName").value="";TRIANGLE.notify.loading.hide()},saveCurrent:function saveCurrent(e){TRIANGLE.notify.saving.show();TRIANGLE.text.deleteUnusedFonts();var b=TRIANGLE.json.encode();b=encodeURIComponent(b);var a=encodeURIComponent(TRIANGLE.developer.globalStyleTagContent);var d=encodeURIComponent(TRIANGLE.developer.globalScriptTagContent);var c="instance="+TRIANGLE.instance+"&content="+b+"&globalStyle="+a+"&globalScript="+d+"&changesMade="+TRIANGLE.changesMade;AJAX.post("php/save_current.php",c,function(f){TRIANGLE.clearSelection();TRIANGLE.updateTemplateItems();TRIANGLE.menu.closeSideMenu();TRIANGLE.saveTemplate.saveUserIDs();TRIANGLE.saveTemplate.saveUserClasses();TRIANGLE.unsaved=false;TRIANGLE.notify.saving.hide();TRIANGLE.notify.saved.show();if(TRIANGLE.exportTemplate.callbackAfterSave){TRIANGLE.exportTemplate.callbackAfterSave();TRIANGLE.exportTemplate.callbackAfterSave=false}})},saveUserIDs:function(){var f=TRIANGLE.template().querySelectorAll("*[user-id]");var c={};for(var k=0;k<f.length;k++){var b=f[k].getAttribute("user-id");if(!b||b=="null"||b=="undefined"){continue}var a=f[k].nextSibling;var e=f[k].previousSibling;c[b]={};var m={};c[b]["user-id"]=f[k].getAttribute("user-id");c[b]["user-class"]=f[k].getAttribute("user-class");c[b]["tagName"]=f[k].tagName;c[b]["id"]=b;m[f[k].getAttribute("triangle-index")]=b;c[b]["className"]=f[k].className;c[b]["triangle-index"]=f[k].getAttribute("triangle-index");c[b]["triangle-class"]=f[k].getAttribute("triangle-class");c[b]["name"]=f[k].getAttribute("name");c[b]["style"]=f[k].style.cssText;c[b]["clearFloat"]=TRIANGLE.isType.clearFloat(e)?1:0;if(TRIANGLE.isType.textBox(f[k])||TRIANGLE.isType.imageItem(f[k])||TRIANGLE.isType.formBtn(f[k])||TRIANGLE.isType.snippetItem(f[k])){c[b]["innerHTML"]=f[k].innerHTML.replace(/&/g,encodeURIComponent("&"))}c[b]["src"]=f[k].src;if(a&&TRIANGLE.isType.templateItem(a)){c[b]["nextSib"]=a.id}else{if(a&&TRIANGLE.isType.clearFloat(a)){c[b]["nextSib"]=a.nextSibling&&TRIANGLE.isType.templateItem(a.nextSibling)?a.nextSibling.id:0}else{c[b]["nextSib"]=0}}if(e&&TRIANGLE.isType.templateItem(e)){c[b]["prevSib"]=e.id}else{if(e&&TRIANGLE.isType.clearFloat(e)){c[b]["prevSib"]=e.previousSibling&&TRIANGLE.isType.templateItem(e.previousSibling)?e.previousSibling.id:0}else{c[b]["prevSib"]=0}}if(!a){c[b]["isLastChild"]=1}else{if(a&&TRIANGLE.isType.clearFloat(a)){c[b]["isLastChild"]=a.nextSibling&&TRIANGLE.isType.templateItem(a.nextSibling)?0:1}else{c[b]["isLastChild"]=0}}c[b]["item-align"]=f[k].getAttribute("item-align")||"";c[b]["hover-style"]=f[k].getAttribute("hover-style")||"";c[b]["link-to"]=f[k].getAttribute("link-to");c[b]["onClick"]=f[k].getAttribute("onclick");c[b]["crop-map"]=f[k].getAttribute("crop-map");c[b]["crop-ratio"]=f[k].getAttribute("crop-ratio");c[b]["target"]=f[k].getAttribute("target");c[b]["form-email"]=f[k].getAttribute("form-email");c[b]["responsive"]=[f[k].style.width,f[k].getBoundingClientRect().width,f[k].getBoundingClientRect().top];c[b]["children"]={};var l=f[k].querySelector("*[user-id]");var h=f[k].querySelectorAll("[triangle-class~=templateItem]");for(var n=0;n<h.length;n++){a=h[n].nextSibling;e=h[n].previousSibling;var g=b+n;m[h[n].getAttribute("triangle-index")]=g;c[b]["children"][g]={};c[b]["children"][g]["user-id"]=h[n].getAttribute("user-id");c[b]["children"][g]["user-class"]=h[n].getAttribute("user-class");c[b]["children"][g]["triangle-index"]=h[n].getAttribute("triangle-index");c[b]["children"][g]["triangle-class"]=h[n].getAttribute("triangle-class");c[b]["children"][g]["tagName"]=h[n].tagName;c[b]["children"][g]["className"]=h[n].className;c[b]["children"][g]["name"]=h[n].getAttribute("name");c[b]["children"][g]["style"]=h[n].style.cssText;c[b]["children"][g]["clearFloat"]=TRIANGLE.isType.clearFloat(a)?1:0;if(TRIANGLE.isType.textBox(h[n])||TRIANGLE.isType.imageItem(h[n])||TRIANGLE.isType.formBtn(h[n])||TRIANGLE.isType.snippetItem(h[n])){c[b]["children"][g]["innerHTML"]=h[n].innerHTML.replace(/&/g,encodeURIComponent("&"))}c[b]["children"][g]["src"]=h[n].src;c[b]["children"][g]["children"]=h[n].querySelector("[triangle-class~=templateItem]")?1:0;c[b]["children"][g]["triangle-childof"]=m[h[n].getAttribute("triangle-childof")];if(a&&TRIANGLE.isType.templateItem(a)){c[b]["children"][g]["nextSib"]=b+(n+1)}else{if(a&&TRIANGLE.isType.clearFloat(a)){c[b]["children"][g]["nextSib"]=a.nextSibling&&TRIANGLE.isType.templateItem(a.nextSibling)?b+(n+1):0}else{c[b]["children"][g]["nextSib"]=0}}if(e&&TRIANGLE.isType.templateItem(e)){c[b]["children"][g]["prevSib"]=m[e.getAttribute("triangle-index")]}else{if(e&&TRIANGLE.isType.clearFloat(e)){c[b]["children"][g]["prevSib"]=e.previousSibling&&TRIANGLE.isType.templateItem(e.previousSibling)?m[e.getAttribute("triangle-index")]:0}else{c[b]["children"][g]["prevSib"]=0}}c[b]["isLastChild"]=!a||(a&&!TRIANGLE.isType.templateItem(a))?1:0;if(!a){c[b]["children"][g]["isLastChild"]=1}else{if(a&&TRIANGLE.isType.clearFloat(a)){c[b]["children"][g]["isLastChild"]=a.nextSibling&&TRIANGLE.isType.templateItem(a.nextSibling)?0:1}else{c[b]["children"][g]["isLastChild"]=0}}c[b]["children"][g]["item-align"]=h[n].getAttribute("item-align")||"";c[b]["children"][g]["hover-style"]=h[n].getAttribute("hover-style")||"";c[b]["children"][g]["link-to"]=h[n].getAttribute("link-to");c[b]["children"][g]["onClick"]=h[n].getAttribute("onclick");c[b]["children"][g]["crop-map"]=h[n].getAttribute("crop-map");c[b]["children"][g]["crop-ratio"]=h[n].getAttribute("crop-ratio");c[b]["children"][g]["target"]=h[n].getAttribute("target");c[b]["children"][g]["form-email"]=h[n].getAttribute("form-email");c[b]["children"][g]["responsive"]=[h[n].style.width,h[n].getBoundingClientRect().width,h[n].getBoundingClientRect().top]}}var j=JSON.stringify(c);var d="instance="+TRIANGLE.instance+"&content="+j;AJAX.post("php/save_user_ids.php",d,function(i){})},saveUserClasses:function(){var g=TRIANGLE.template().querySelectorAll("[user-class]");if(g){var j=[];for(var d=0,c=0;d<g.length;d++){var e=g[d].getAttribute("user-class");if(e&&j.indexOf(e)===-1){j[c]=e;c++}}var h={};for(var d=0;d<j.length;d++){var f=TRIANGLE.template().querySelector("[user-class="+j[d]+"]").style.cssText;h[j[d]]=f}var a=JSON.stringify(h);var b="instance="+TRIANGLE.instance+"&content="+a;AJAX.post("php/save_user_classes.php",b,function(i){})}},saveAll:function(){console.log("saving all...");var a=document.getElementById("echoPageList").querySelectorAll(".pageThumbnail");for(var c=0;c<a.length;c++){var b=a[c].innerHTML;setTimeout(function(d){TRIANGLE.loadTemplate.loadTemplate(TRIANGLE.currentTemplate,d);console.log(d);setTimeout(TRIANGLE.saveTemplate.saveCurrent,1000)},c*3000,b)}},createNewPage:function(b){var a=document.getElementById("newPageNameInput");if(a.value!==""){b=a.value}else{TRIANGLE.error("Please enter a page name");a.focus();return}TRIANGLE.saveTemplate.saveCurrent();AJAX.get("php/create_page.php","instance="+TRIANGLE.instance+"&pageName="+b,function(c){document.getElementById("createNewPage").style.display="none";a.value="";TRIANGLE.menu.closeSideMenu();var d=b;TRIANGLE.loadTemplate.openURL(TRIANGLE.currentTemplate,d)})}};TRIANGLE.loadTemplate={hide:function hideTemplate(){var a=TRIANGLE.template();a.style.opacity=0;a.style.visibility="hidden"},show:function showTemplate(){var a=TRIANGLE.template();a.style.visibility="visible";a.style.opacity=1},getLoadList:function getLoadList(){AJAX.get("php/load_list.php","",function(c){document.getElementById("echoLoadList").innerHTML=c.responseText;var b=document.getElementById("echoLoadList").querySelectorAll(".loadListItem");for(var a=0;a<b.length;a++){if(TRIANGLE.currentTemplate!==""&&b[a].innerHTML==TRIANGLE.currentTemplate){b[a].style.backgroundColor="#DAF0FD"}else{b[a].style.backgroundColor=""}}})},openURL:function(b,a){window.location.href="index.php?template="+b+"&page="+a},loadTemplate:function loadTemplate(b,a){var d="";if(a&&typeof a=="string"){var d="&pageName="+a}else{if(typeof a=="object"){var c=a}else{a=""}}var e="templateName="+b+d+"&instance="+TRIANGLE.instance;AJAX.post("php/load_template.php",e,function(f){if(document.getElementById("loadingCell").style.display==="none"){TRIANGLE.popUp.close()}document.getElementById("loadTemplatesCell").style.display="none";TRIANGLE.options.blankTemplate();var g=TRIANGLE.json.decompress(f.responseText);TRIANGLE.json.decode(g);TRIANGLE.library.loadUserIDs();TRIANGLE.updateTemplateItems();TRIANGLE.loadTemplate.updateUserIDs();TRIANGLE.loadTemplate.updateUserClasses();TRIANGLE.clearSelection();TRIANGLE.colors.updateBodyBg();TRIANGLE.pages.loadPages(b);TRIANGLE.dragDrop.updateItemMap();document.getElementById("saveCurrentTemplate").parentNode.style.display="";document.getElementById("saveNewPage").parentNode.style.display="";TRIANGLE.currentTemplate=b;TRIANGLE.currentPage=a;document.getElementById("FTPselect").selectedIndex=0;TRIANGLE.updateTemplateItems();TRIANGLE.options.compareUndoList()})},updateUserIDs:function(){var a="instance="+TRIANGLE.instance;AJAX.post("php/read_user_ids.php",a,function(d){if(!d.responseText){TRIANGLE.loadTemplate.show();return}var h=JSON.parse(d.responseText);var m=TRIANGLE.template().querySelectorAll("[update-user-id]");var g={};for(var j=0;j<m.length;j++){g[m[j].getAttribute("update-user-id")]=j}for(var c in h){var k=false;if(!isNaN(g[c])){k=m[parseInt(g[c])]}else{if(TRIANGLE.iframe().getElementByUserId(c)){k=TRIANGLE.iframe().getElementByUserId(c)}else{continue}}var l=document.createElement(h[c]["tagName"]);l.id=h[c]["id"];l.setAttribute("user-id",c);l=TRIANGLE.json.convertItem(h[c],l);k.parentNode.insertBefore(l,k);k.parentNode.removeChild(k);var f=h[c]["children"];for(var e in f){var n=document.createElement(f[e]["tagName"]);n=TRIANGLE.json.convertItem(f[e],n);n.id=e;f[e]["user-id"]?n.setAttribute("user-id",f[e]["user-id"]):null;var b=f[e]["triangle-childof"];if(b){TRIANGLE.iframe().getElementById(b).appendChild(n)}else{n=null}}TRIANGLE.updateTemplateItems()}TRIANGLE.updateTemplateItems();TRIANGLE.loadTemplate.show()})},updateUserClasses:function(){var a="instance="+TRIANGLE.instance;AJAX.post("php/read_user_classes.php",a,function(c){if(!c.responseText){return}var f=JSON.parse(c.responseText);TRIANGLE.userClasses=f;for(var d in f){var e=TRIANGLE.template().querySelectorAll("[user-class="+d+"]");for(var b=0;b<e.length;b++){e[b].style.cssText=f[d]}}})},importWebsite:function(a){TRIANGLE.popUp.close();if(!a||(a&&typeof a!=="string")){a=document.getElementById("importWebsiteURL").value}TRIANGLE.importWebsiteURL=a;AJAX.get("php/import_website.php","url="+encodeURIComponent(a),function(f){if(f.responseText){var g=f.responseText;var c=document.getElementById("importWebsite");c.innerHTML=g;var h=c.querySelector("title");document.getElementById("metaTitle").value=TRIANGLE.metaData.title=h.innerHTML;var j=c.querySelectorAll("link");for(var e=0;e<j.length;e++){if(j[e].getAttribute("defer")){j[e].setAttribute("href",j[e].getAttribute("defer"));j[e].removeAttribute("defer")}}var b=c.querySelectorAll("img");for(var e=0;e<b.length;e++){if(b[e].getAttribute("lazyload")){b[e].src=b[e].getAttribute("lazyload");b[e].removeAttribute("lazyload")}var d=b[e].getAttribute("src")[0]==="/"?"":"/";b[e].src=a+d+b[e].getAttribute("src")}}})}};TRIANGLE.json={encode:function(){var h={};h.hoverData=TRIANGLE.iframe().getElementById("hoverData").innerHTML;h.hoverItems=TRIANGLE.iframe().getElementById("hoverItems").innerHTML;h.animationData=TRIANGLE.iframe().getElementById("animationData").innerHTML;h.bodyBgData=TRIANGLE.iframe().getElementById("bodyBgData").style.cssText;h.fontData=TRIANGLE.iframe().getElementById("fontData").innerHTML;h.fontFamily=TRIANGLE.template().style.fontFamily;h.metaTitle=TRIANGLE.metaData.title;h.metaKeywords=TRIANGLE.metaData.keywords;h.metaDescription=TRIANGLE.metaData.description;h.fixedWidth=TRIANGLE.template().style.width;h.exportCompress=document.getElementById("exportCompress").checked;h.importWebsiteURL=TRIANGLE.importWebsiteURL;h.styleTag=TRIANGLE.developer.styleTagContent;h.scriptTag=TRIANGLE.developer.scriptTagContent;h.imageList={itemNums:[],paths:[],dimensions:[]};h.items=[];var a=[];for(var d=0;d<TRIANGLE.templateItems.length;d++){var c=new TRIANGLE.TemplateItem(d);if(a.indexOf(c.index)>-1){continue}var e=c.index;if(c.userID){h.items[e]={masterItem:true,masterID:c.userID,masterIndex:c.index,masterParent:false};if(c.parent.id!=="template"){h.items[e].masterParent=c.parent.getAttribute("triangle-index")}var b=c.objRef.querySelectorAll("[triangle-class~=templateItem]");for(var g=0;g<b.length;g++){a.push(parseInt(b[g].getAttribute("triangle-index")))}continue}h.items[e]={};h.items[e]["triangle-index"]=c.index;h.items[e]["user-class"]=c.userClass;h.items[e]["triangle-class"]=c.triangleClass;h.items[e]["className"]=c.className;h.items[e]["id"]=c.id;h.items[e]["tagName"]=c.tag;h.items[e]["name"]=c.objRef.getAttribute("name");h.items[e]["style"]=c.objRef.style.cssText;h.items[e]["clearFloat"]=TRIANGLE.isType.clearFloat(c.objRef.nextSibling)?1:0;if(TRIANGLE.isType.textBox(c.objRef)||TRIANGLE.isType.imageItem(c.objRef)||TRIANGLE.isType.formBtn(c.objRef)||TRIANGLE.isType.snippetItem(c.objRef)){h.items[e]["innerHTML"]=c.objRef.innerHTML.replace(/&/g,encodeURIComponent("&"))}h.items[e]["src"]=c.objRef.src;h.items[e]["children"]=c.objRef.querySelector("[triangle-class~=templateItem]")?1:0;h.items[e]["triangle-childof"]=c.childOf;h.items[e]["nextSib"]=c.nextSibling()?c.nextSibling().getAttribute("triangle-index"):0;h.items[e]["prevSib"]=c.prevSibling()?c.prevSibling().getAttribute("triangle-index"):0;h.items[e]["isLastChild"]=c.isLastChild;h.items[e]["item-align"]=c.align||"";h.items[e]["hover-style"]=c.hover.cssText||"";h.items[e]["link-to"]=c.linkTo;h.items[e]["onClick"]=c.objRef.getAttribute("onclick");h.items[e]["target"]=c.objRef.getAttribute("target");h.items[e]["form-email"]=c.objRef.getAttribute("form-email")}h.responsiveItems=j();var f=JSON.stringify(h);return f;function j(){var o={};for(var l=0;l<TRIANGLE.templateItems.length;l++){var n=TRIANGLE.templateItems[l];var m=n.getBoundingClientRect();var k=[n.style.width,Math.round(m.width*10000)/10000,m.top];o[n.getAttribute("triangle-index")]=k}return o}},decode:function(c){var b=JSON.parse(c);TRIANGLE.json.convertTemplateData(b);var a=b.items;for(var g in a){if(typeof a[g]=="string"){var d=a[g].split(" ");var f=document.createElement("div");f.setAttribute("update-user-id",d[0]);if(d[1]){TRIANGLE.iframe().getTriangleIndex(d[1]).appendChild(f)}else{TRIANGLE.template().appendChild(f)}continue}else{if(a[g].masterItem){var f=document.createElement("div");f.setAttribute("update-user-id",a[g].masterID);if(a[g].masterParent){TRIANGLE.iframe().getTriangleIndex(a[g].masterParent).appendChild(f)}else{TRIANGLE.template().appendChild(f)}continue}}var f=document.createElement(a[g]["tagName"]);f.setAttribute("triangle-index",g);if(a[g]["user-id"]){f.setAttribute("user-id",a[g]["user-id"])}f=TRIANGLE.json.convertItem(a[g],f);var e=a[g]["triangle-childof"];if(e&&TRIANGLE.iframe().getTriangleIndex(e)){TRIANGLE.iframe().getTriangleIndex(e).appendChild(f)}else{if(e&&!TRIANGLE.iframe().getTriangleIndex(e)){continue}else{TRIANGLE.template().appendChild(f)}}}},toHTML:function(f){document.getElementById("JSONtoHTML").innerHTML="";var b=JSON.parse(f);for(var h in b){var e=document.createElement(b[h]["tagName"]);e.id=b[h]["id"];e.setAttribute("user-id",h);e=TRIANGLE.json.convertItem(b[h],e);document.getElementById("JSONtoHTML").appendChild(e);var c=b[h]["children"];for(var g in c){var a=document.createElement(c[g]["tagName"]);a.id=g;c[g]["user-id"]?a.setAttribute("user-id",c[g]["user-id"]):null;a=TRIANGLE.json.convertItem(c[g],a);var d=c[g]["triangle-childof"];if(d){document.getElementById("JSONtoHTML").querySelector("#"+d).appendChild(a)}else{a=null}}}return document.getElementById("JSONtoHTML").innerHTML},convertTemplateData:function(a){TRIANGLE.iframe().getElementById("hoverData").innerHTML=a.hoverData;TRIANGLE.iframe().getElementById("hoverItems").innerHTML=a.hoverItems;TRIANGLE.iframe().getElementById("animationData").innerHTML=a.hoverItems;TRIANGLE.iframe().getElementById("bodyBgData").style.cssText=a.bodyBgData;TRIANGLE.iframe().getElementById("fontData").innerHTML=a.fontData;TRIANGLE.template().style.fontFamily=a.fontFamily;TRIANGLE.template().style.width=a.fixedWidth;if(TRIANGLE.getUnit(a.fixedWidth)==="px"){TRIANGLE.template().style.margin="0 auto"}document.getElementById("metaTitle").value=a.metaTitle||"";TRIANGLE.metaData.title=document.getElementById("metaTitle").value;document.getElementById("metaKeywords").value=a.metaKeywords||"";TRIANGLE.metaData.keywords=document.getElementById("metaKeywords").value;document.getElementById("metaDescription").value=a.metaDescription||"";TRIANGLE.metaData.description=document.getElementById("metaDescription").value;document.getElementById("exportCompress").checked=a.exportCompress;if(a.importWebsiteURL){TRIANGLE.loadTemplate.importWebsite(a.importWebsiteURL)}TRIANGLE.developer.styleTagContent=a.styleTag||"";TRIANGLE.developer.sessions.styleTag.setValue(TRIANGLE.developer.styleTagContent);TRIANGLE.developer.globalStyleTagContent=a.globalStyleTag||"";TRIANGLE.developer.sessions.globalStyleTag.setValue(TRIANGLE.developer.globalStyleTagContent);TRIANGLE.developer.scriptTagContent=a.scriptTag||"";TRIANGLE.developer.sessions.scriptTag.setValue(TRIANGLE.developer.scriptTagContent);TRIANGLE.developer.globalScriptTagContent=a.globalScriptTag||"";TRIANGLE.developer.sessions.globalScriptTag.setValue(TRIANGLE.developer.globalScriptTagContent)},convertItem:function(a,b){b.style.cssText=a.style;b.innerHTML=a.innerHTML?a.innerHTML.replace(/\%26amp;/g,"&"):"";b.src=a.src||"";if(a.className!==""){b.className=a.className}if(a.id!==""){b.id=a.id}a["user-class"]?b.setAttribute("user-class",a["user-class"]):null;a.name?b.setAttribute("name",a.name):null;a["triangle-index"]?b.setAttribute("triangle-index",a["triangle-index"]):null;a["triangle-class"]?b.setAttribute("triangle-class",a["triangle-class"]):null;a["item-align"]?b.setAttribute("item-align",a["item-align"]):null;a["hover-style"]?b.setAttribute("hover-style",a["hover-style"]):null;a["link-to"]?b.setAttribute("link-to",a["link-to"]):null;a.onClick?b.setAttribute("onClick",a.onClick):null;a["crop-map"]?b.setAttribute("crop-map",a["crop-map"]):null;a["crop-ratio"]?b.setAttribute("crop-ratio",a["crop-ratio"]):null;a.target?b.setAttribute("target",a.target):null;a["form-email"]?b.setAttribute("form-email",a["form-email"]):null;return b},toNVP:function(c){var a=JSON.parse(c);var b="";for(var d in a){b+=d+":"+a[d]+";"}return b},readNVP:function(f){var e=f.split(";");var b={};for(var d=0;d<e.length;d++){var a=e[d].split(":");b[a[0]]=a[1]}var c=JSON.stringify(b);return c},compress:function(l){l=JSON.parse(l);for(var b in l.items){if(typeof l.items[b]=="string"){continue}for(var j in TRIANGLE.json.compressionMap){l.items[b]["style"]=l.items[b]["style"].replace(j+":","%"+TRIANGLE.json.compressionMap[j])}var g=l.items[b]["style"];var c=g.split(";");for(var f=0;f<c.length;f++){c[f]=c[f].trim()}for(var a in l.items){if(l.items[b]===l.items[a]){break}var h=l.items[a]["style"];if(h){var d=h.split(";");for(var f=0;f<d.length;f++){d[f]=d[f].trim()}if(c.sort().toString()===d.sort().toString()){g=a;break}}}l.items[b]["style"]=g}for(var b in l.responsiveItems){var e=l.responsiveItems[b];for(var a in l.responsiveItems){if(l.responsiveItems[b]===l.responsiveItems[a]){break}var k=l.responsiveItems[a];if(JSON.stringify(e)===JSON.stringify(k)){e=a;break}}l.responsiveItems[b]=e}return JSON.stringify(l)},decompress:function(a){a=JSON.parse(a);for(var c in a.items){if(typeof a.items[c]=="string"||a.items[c].masterItem){continue}var b=a.items[c]["style"];if(a.items[b]){a.items[c]["style"]=a.items[b]["style"]}for(var d in TRIANGLE.json.compressionMap){a.items[c]["style"]=a.items[c]["style"].replace("%"+TRIANGLE.json.compressionMap[d],d+":")}}return JSON.stringify(a)},compressionMap:{"background-color":"bC","background-image":"bI","background-size":"bSz",background:"bg","min-height":"mH",height:"h","max-width":"mW",width:"w",display:"d",position:"po","float":"cF",overflow:"o","vertical-align":"vA",padding:"p",margin:"m","box-shadow":"bS","border-radius":"bR","border-width":"bW",border:"b",left:"L",right:"R",top:"T",bottom:"B",color:"c","font-size":"fS","line-height":"lH","text-align":"tA","font-family":"fF","font-weight":"fW","text-decoration":"tD","text-decoration-color":"tDc"}};TRIANGLE.exportTemplate={callbackAfterSave:false,publish:{prompt:function(){TRIANGLE.popUp.open("FTPprofileCell")},cancel:function(){TRIANGLE.popUp.close()},send:function(){var c=document.getElementById("FTPselect");var b=c.options[c.selectedIndex];var a={instance:TRIANGLE.instance,ftpURL:b.innerHTML,ftpID:b.getAttribute("ftp")};TRIANGLE.exportTemplate.postTemplate("php/publish.php",a);TRIANGLE.popUp.close()}},zip:function(){TRIANGLE.exportTemplate.callbackAfterSave=function(){var a=document.getElementById("exportCompress").checked?1:0;var b="askZip="+1+"&instance="+TRIANGLE.instance+"&compress="+a;AJAX.post("php/export_zip.php",b,function(e){TRIANGLE.notify.loading.hide();var d=JSON.parse(e.responseText);var c=document.createElement("a");document.body.appendChild(c);c.style="display: none";c.href=d.url;c.download=d.filename;c.click();document.body.removeChild(c)})};TRIANGLE.saveTemplate.saveCurrent()},raw:function(){if(!TRIANGLE.unsavedPremade){TRIANGLE.exportTemplate.callbackAfterSave=function(){TRIANGLE.exportTemplate.postTemplate("php/export_raw.php",{instance:TRIANGLE.instance})};TRIANGLE.saveTemplate.saveCurrent()}else{TRIANGLE.exportTemplate.callbackAfterSave=function(){TRIANGLE.exportTemplate.raw();setTimeout(function(){TRIANGLE.popUp.close();TRIANGLE.loadTemplate.openURL(TRIANGLE.currentTemplate,TRIANGLE.currentPage)},500)};TRIANGLE.saveTemplate.getSaveName()}},preview:function(){if(!TRIANGLE.unsavedPremade){TRIANGLE.exportTemplate.callbackAfterSave=function(){var a=document.getElementById("exportCompress").checked?1:0;var b="askZip=0&instance="+TRIANGLE.instance+"&compress="+a;AJAX.post("php/export_zip.php",b,function(c){TRIANGLE.exportTemplate.postTemplate("php/preview_template.php",{instance:TRIANGLE.instance})})};TRIANGLE.saveTemplate.saveCurrent()}else{TRIANGLE.exportTemplate.callbackAfterSave=function(){TRIANGLE.exportTemplate.preview();setTimeout(function(){TRIANGLE.popUp.close();TRIANGLE.loadTemplate.openURL(TRIANGLE.currentTemplate,TRIANGLE.currentPage)},500)};TRIANGLE.saveTemplate.getSaveName()}},postTemplate:function(d,e){var c=document.getElementById("exportRawPost");c.innerHTML="";c.setAttribute("action",d);e.compress=document.getElementById("exportCompress").checked?1:0;for(var b in e){if(e.hasOwnProperty(b)){var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name",b);a.setAttribute("value",e[b]);c.appendChild(a)}}document.body.appendChild(c);c.submit();TRIANGLE.notify.loading.hide()},postTemplateAJAX:function(d,e){var a=document.getElementById("exportCompress").checked?1:0;e.compress=a;var b="";for(var c in e){if(e.hasOwnProperty(c)){b+=c+"="+e[c]+"&"}}b=b.slice(0,-1);AJAX.post("php/"+d+".php",b,function(f){TRIANGLE.notify.loading.hide()})},error:function(){TRIANGLE.notify.error.show()},clearZip:function(){AJAX.get("php/clear_zip.php","",function(a){})}};TRIANGLE.options={getFixedWidth:function getFixedWidth(){TRIANGLE.popUp.open("getFixedWidthCell");document.getElementById("customFixedWidth").value=TRIANGLE.template().style.width},templateWidthType:null,fixedWidth:function fixedWidth(){var a=document.getElementById("customFixedWidth").value;if((/\D/g).test(a)){TRIANGLE.template().style.width=a}else{TRIANGLE.template().style.width=a+"px"}TRIANGLE.template().style.margin="0 auto";TRIANGLE.options.templateWidthType="fixed";TRIANGLE.popUp.close();TRIANGLE.selectionBorder.update()},fluidWidth:function fluidWidth(){TRIANGLE.template().style.width="100%";TRIANGLE.template().style.margin="";TRIANGLE.options.templateWidthType="fluid";TRIANGLE.selectionBorder.update()},blankTemplate:function blankTemplate(){for(var a=0;a<TRIANGLE.templateItems.length;a++){TRIANGLE.templateItems[a].removeEventListener("mousedown",TRIANGLE.importItem.single,true);TRIANGLE.templateItems[a].removeEventListener("mouseover",TRIANGLE.hoverBorder.show,true);TRIANGLE.templateItems[a].removeEventListener("dblclick",TRIANGLE.text.editText)}TRIANGLE.template().innerHTML="";TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundColor="#FFFFFF";TRIANGLE.iframe().getElementById("hoverData").innerHTML="";TRIANGLE.iframe().getElementById("hoverItems").innerHTML="";TRIANGLE.iframe().getElementById("animationData").innerHTML="";TRIANGLE.iframe().getElementById("fontData").innerHTML="";TRIANGLE.template().style.fontFamily="";TRIANGLE.colors.updateBodyBg();TRIANGLE.clearSelection()},newRow:function(){TRIANGLE.selectionBorder.remove();var b=document.createElement("div");b.setAttribute("triangle-class","templateItem");b.style.backgroundColor="#f5f2f0";b.style.height="auto";b.style.width="100%";b.style.display="block";var a;if(TRIANGLE.item){TRIANGLE.item.insertAfterMe(b);TRIANGLE.updateTemplateItems();a=TRIANGLE.item.nextSibling().getAttribute("triangle-index")}else{TRIANGLE.template().appendChild(b);TRIANGLE.updateTemplateItems();window.scrollTo(0,TRIANGLE.templateItems[TRIANGLE.templateItems.length-1].getBoundingClientRect().top-83);a=TRIANGLE.templateItems.length-1}TRIANGLE.updateTemplateItems();TRIANGLE.clearSelection();TRIANGLE.selectItem(a);TRIANGLE.saveItem.createAnimation("min-height",0,"100px",function(){TRIANGLE.importItem.single(TRIANGLE.item.index)})},insertColumns:function insertColumns(g){if(TRIANGLE.item.objRef.children.length>0||TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){return}var e=Math.floor(parseFloat(TRIANGLE.itemStyles.width)*100/g)/100;var a=1;for(var c=0;c<g;c++){var d=document.createElement("div");d.style.backgroundColor=TRIANGLE.itemStyles.backgroundColor;d.style.minHeight=TRIANGLE.itemStyles.minHeight;d.style.height=TRIANGLE.itemStyles.height;d.style.width=e+TRIANGLE.getUnit(TRIANGLE.itemStyles.width);d.setAttribute("item-align",TRIANGLE.item.align);if(TRIANGLE.item.align!=="right"){d.style.cssFloat="left";var b="Right";var f="Left"}else{d.style.cssFloat="right";var b="Left";var f="Right"}d.style.paddingLeft=TRIANGLE.itemStyles.paddingLeft;d.style.paddingRight=TRIANGLE.itemStyles.paddingRight;d.style.paddingTop=TRIANGLE.itemStyles.paddingTop;d.style.paddingBottom=TRIANGLE.itemStyles.paddingBottom;if(a===1){d.style["margin"+b]=TRIANGLE.item["margin"+b];d.style["border"+b+"Width"]=TRIANGLE.item["border"+b+"Width"];d.style["border"+b+"Style"]=TRIANGLE.item["border"+b+"Style"];d.style["border"+b+"Color"]=TRIANGLE.item["border"+b+"Color"]}else{if(a===g){d.style["margin"+f]=TRIANGLE.item["margin"+f];d.style["border"+f+"Width"]=TRIANGLE.item["border"+f+"Width"];d.style["border"+f+"Style"]=TRIANGLE.item["border"+f+"Style"];d.style["border"+f+"Color"]=TRIANGLE.item["border"+f+"Color"]}}d.style.marginTop=TRIANGLE.itemStyles.marginTop;d.style.marginBottom=TRIANGLE.itemStyles.marginBottom;d.style.borderTopWidth=TRIANGLE.itemStyles.borderTopWidth;d.style.borderTopStyle=TRIANGLE.itemStyles.borderTopStyle;d.style.borderTopColor=TRIANGLE.itemStyles.borderTopColor;d.style.borderBottomWidth=TRIANGLE.itemStyles.borderBottomWidth;d.style.borderBottomStyle=TRIANGLE.itemStyles.borderBottomStyle;d.style.borderBottomColor=TRIANGLE.itemStyles.borderBottomColor;d.style.boxShadow=TRIANGLE.itemStyles.boxShadow;d.className=TRIANGLE.item.className;d.setAttribute("triangle-class",TRIANGLE.item.triangleClass);TRIANGLE.item.insertBeforeMe(d);a++}TRIANGLE.deleteItem(TRIANGLE.item.index);TRIANGLE.updateTemplateItems()},insertNewChild:function insertNewChild(){if(TRIANGLE.item&&TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){return}if(TRIANGLE.item.objRef.children[0]&&TRIANGLE.item.objRef.children[0].style.display=="table-cell"){return}if(TRIANGLE.isType.containsNbsp(TRIANGLE.item.objRef)){TRIANGLE.stripNbsp(TRIANGLE.item.objRef)}TRIANGLE.checkPadding(TRIANGLE.item.objRef);var a=document.createElement("div");a.setAttribute("triangle-class","templateItem childItem");a.style.backgroundColor="#BFD7EA";a.style.minHeight="100px";a.style.height="auto";a.style.width="100%";TRIANGLE.item.append(a);TRIANGLE.updateTemplateItems();TRIANGLE.selectionBorder.remove();var d=TRIANGLE.item.objRef.children.length;var c=TRIANGLE.item.objRef.children[d-1];var b=c.getAttribute("triangle-index");TRIANGLE.selectItem(b);TRIANGLE.saveItem.createAnimation("min-height",0,"100px",function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.updateTemplateItems()},selectParent:function selectParent(){if(TRIANGLE.item){var a=TRIANGLE.item.parent;if(a.id=="template"){return}else{var b=parseInt(a.getAttribute("triangle-index"));TRIANGLE.importItem.single(b)}}},shiftUp:function shiftUp(){if(!TRIANGLE.item){return}TRIANGLE.resetClearFloat();if(TRIANGLE.item.isFirstChild){TRIANGLE.updateTemplateItems();return}else{var b=TRIANGLE.item.objRef;var d=TRIANGLE.item.prevSibling();var g=d.getAttribute("triangle-index");var a=TRIANGLE.item.objRef.cloneNode(true);TRIANGLE.item.parent.insertBefore(a,d);TRIANGLE.item.remove();TRIANGLE.updateTemplateItems();TRIANGLE.importItem.single(g);TRIANGLE.item.objRef.click();var f=TRIANGLE.item.objRef.getBoundingClientRect();var e=window.innerHeight;var c=document.getElementById("menu").getBoundingClientRect().bottom;if(f.top<c){TRIANGLE.item.objRef.scrollIntoView();window.scrollBy(0,-250)}else{if(f.bottom>e){TRIANGLE.item.objRef.scrollIntoView();window.scrollBy(0,200)}}}},shiftDown:function shiftDown(){if(!TRIANGLE.item){return}TRIANGLE.resetClearFloat();if(TRIANGLE.item.isLastChild){TRIANGLE.updateTemplateItems();return}else{var b=TRIANGLE.item.objRef;var g=TRIANGLE.item.index;var a=TRIANGLE.item.objRef.cloneNode(true);var d=TRIANGLE.item.nextSibling()?new TRIANGLE.TemplateItem(TRIANGLE.item.nextSibling().getAttribute("triangle-index")):false;if(d){d.insertAfterMe(a)}else{TRIANGLE.item.parent.appendChild(a)}TRIANGLE.item.remove();TRIANGLE.updateTemplateItems();TRIANGLE.selectItem(g);TRIANGLE.importItem.single(TRIANGLE.item.nextSibling().getAttribute("triangle-index"));var f=TRIANGLE.item.objRef.getBoundingClientRect();var e=window.innerHeight;var c=document.getElementById("menu").getBoundingClientRect().bottom;if(f.top<c){TRIANGLE.item.objRef.scrollIntoView();window.scrollBy(0,-250)}else{if(f.bottom>e){TRIANGLE.item.objRef.scrollIntoView();window.scrollBy(0,200)}}}},duplicate:function duplicate(){var d=TRIANGLE.item;var a=d.parent;var b="";for(var c=0;c<a.childNodes.length;c++){if(a.childNodes[c]==d.objRef){b=c}else{continue}}var e=d.objRef.cloneNode(true);e.removeAttribute("user-id");if(a.childNodes.length===1){a.appendChild(e)}else{a.insertBefore(e,a.childNodes[b+1])}TRIANGLE.updateTemplateItems();TRIANGLE.clearSelection();TRIANGLE.selectItem(a.childNodes[b+1].getAttribute("triangle-index"));if(TRIANGLE.itemStyles.width!=="100%"&&((d.align&&d.align!=="center")||(TRIANGLE.itemStyles.cssFloat))){TRIANGLE.saveItem.createAnimation("width",0,TRIANGLE.itemStyles.width,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)})}else{TRIANGLE.saveItem.createAnimation("min-height",0,TRIANGLE.itemStyles.minHeight,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)})}},clipboard:{},isClipboardFull:false,itemStyles:null,copyStyles:function(){if(!TRIANGLE.item){return}TRIANGLE.options.clipboard.tag=TRIANGLE.item.tag;TRIANGLE.options.clipboard.src=TRIANGLE.item.objRef.src;TRIANGLE.options.clipboard.itemStyles=TRIANGLE.getStyles(TRIANGLE.item.objRef);TRIANGLE.options.clipboard.itemCopy=TRIANGLE.item.objRef.cloneNode(true);TRIANGLE.options.isClipboardFull=true},pasteStyles:function(){var a=TRIANGLE.options.clipboard.itemCopy.cloneNode(true);if(!a){return}a.removeAttribute("user-id");a.innerHTML=a.innerHTML.replace(/user\-class="[^"]*"/g,"");if(TRIANGLE.item){TRIANGLE.checkPadding(TRIANGLE.item.objRef);TRIANGLE.item.append(a)}else{TRIANGLE.template().appendChild(a)}TRIANGLE.selectionBorder.update();TRIANGLE.updateTemplateItems()},undoList:[],undoIndex:false,maxUndo:20,compareUndoList:function(){var b=TRIANGLE.templateWrapper().innerHTML.trim();b=b.replace(/\r|\n/g,"");b=b.replace(/&nbsp;/g," ");b=b.replace(/(\s)+/g,"$1");b=b.replace(/((<div[^>]+id="selectionBorder"[^>]*>)|(<div[^>]+id="noClickThru"[^>]*>[^<]*<\/div>)|(<div[^>]+class="resizeHandle"[^>]*>[^<]*<\/div>))(<\/div>)?/gi,"");b=b.replace(/<div[^>]+id="showHoverBorder"[^>]*>[^<]*<\/div>?/gi,"");var a=TRIANGLE.options.undoList[TRIANGLE.options.undoList.length-1];if(TRIANGLE.options.undoList.length===0){TRIANGLE.options.undoList[0]=b}else{if(b!=a){TRIANGLE.options.undoList[TRIANGLE.options.undoList.length]=b;TRIANGLE.options.undoIndex=TRIANGLE.options.undoList.length-1}}},undo:function(){TRIANGLE.clearSelection();if(TRIANGLE.options.undoList.length===0){return}if(TRIANGLE.options.undoIndex>0){TRIANGLE.options.undoIndex--}TRIANGLE.options.undoList.splice(TRIANGLE.options.undoIndex+1,TRIANGLE.options.undoList.length-TRIANGLE.options.undoIndex-1);TRIANGLE.templateWrapper().innerHTML=TRIANGLE.options.undoList[TRIANGLE.options.undoIndex];TRIANGLE.colors.updateBodyBg();TRIANGLE.updateTemplateItems();TRIANGLE.resize.removeHandles()},redo:function(b){var a=[0,1,2,3,4,5,6,7,8,9];a.splice(b+1,a.length-b-1)},increaseOpacity:function(){var a=TRIANGLE.template();if(a.style.opacity){a.style.opacity=parseFloat(a.style.opacity)+parseFloat(a.style.opacity)/10;if(parseFloat(a.style.opacity)>0.9){a.style.opacity=""}}},decreaseOpacity:function(){var a=TRIANGLE.template();if(a.style.opacity){a.style.opacity=parseFloat(a.style.opacity)-parseFloat(a.style.opacity)/10;if(parseFloat(a.style.opacity)<0.1){a.style.opacity=0.1}}else{a.style.opacity=0.9}}};TRIANGLE.style={convertWidth:function convertWidth(b){if(b.style.display=="inline"||b.style.display=="inline-block"||b.style.display=="inline-table"){var a=b.getBoundingClientRect();if(b.style.width=="auto"){b.style.width=a.width+"px"}}},itemAlignLeft:function itemAlignLeft(){if(TRIANGLE.item.parent.style.display=="flex"){TRIANGLE.item.parent.style.alignItems="left"}else{TRIANGLE.item.objRef.style.cssFloat="left"}TRIANGLE.item.objRef.setAttribute("item-align","left");TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.selectionBorder.update()},itemAlignCenter:function itemAlignCenter(){if(TRIANGLE.itemStyles.cssFloat){TRIANGLE.item.objRef.style.cssFloat=""}if(TRIANGLE.item.parent.style.display==="flex"){TRIANGLE.item.parent.style.justifyContent="center"}else{if(TRIANGLE.item.display=="inline"||TRIANGLE.item.display=="inline-block"||TRIANGLE.item.display=="inline-table"||!TRIANGLE.item.display){TRIANGLE.style.convertWidth(TRIANGLE.item.objRef);TRIANGLE.item.objRef.style.display="block";TRIANGLE.item.objRef.style.marginLeft="auto";TRIANGLE.item.objRef.style.marginRight="auto"}else{TRIANGLE.item.objRef.style.marginLeft="auto";TRIANGLE.item.objRef.style.marginRight="auto"}}TRIANGLE.item.objRef.setAttribute("item-align","center");TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.selectionBorder.update()},itemAlignRight:function itemAlignRight(){if(TRIANGLE.item.parent.style.display=="flex"){TRIANGLE.item.parent.style.alignItems="right"}else{TRIANGLE.item.objRef.style.cssFloat="right"}TRIANGLE.item.objRef.setAttribute("item-align","right");TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.selectionBorder.update()},verticalMiddle:function verticalMiddle(){var a=TRIANGLE.item;if(a.parent.getAttribute("id")=="template"){return}TRIANGLE.selectionBorder.remove();TRIANGLE.checkPadding(a.parent);a.parent.style.display="flex";a.parent.style.alignItems="center";a.parent.style.flexFlow="row wrap";TRIANGLE.updateTemplateItems();TRIANGLE.clearSelection()},itemAlignDefault:function(){TRIANGLE.item.objRef.style.cssFloat="";if(TRIANGLE.item.marginLeft==="auto"){TRIANGLE.item.objRef.style.marginLeft=""}if(TRIANGLE.item.marginRight==="auto"){TRIANGLE.item.objRef.style.marginRight=""}if(TRIANGLE.item.parent.style.display==="flex"){TRIANGLE.item.parent.style.alignItems=""}TRIANGLE.item.objRef.removeAttribute("item-align");TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.selectionBorder.update()}};TRIANGLE.colors={setColorBoxEvents:function setColorBoxEvents(){document.getElementById("colorMainBg").addEventListener("click",function(){TRIANGLE.colors.fillCanvas(this.style.backgroundColor);TRIANGLE.colors.showCanvasMenu(this,function(){TRIANGLE.iframe().contentDocument.body.style.backgroundColor=TRIANGLE.colors.canvasColorChoice;TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundColor=TRIANGLE.colors.canvasColorChoice});TRIANGLE.colors.canvasPaletteTarget="bodyBg"});document.getElementById("colorElementBg").addEventListener("click",function(){if(!TRIANGLE.item){return}TRIANGLE.colors.fillCanvas(this.style.backgroundColor);TRIANGLE.colors.showCanvasMenu(this,function(){TRIANGLE.saveItem.createAnimation("background-color",TRIANGLE.itemStyles.backgroundColor,TRIANGLE.colors.canvasColorChoice,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.backgroundColor=TRIANGLE.colors.canvasColorChoice});TRIANGLE.colors.canvasPaletteTarget="backgroundColor"});document.getElementById("colorListBorderL").addEventListener("click",function(){if(!TRIANGLE.item){return}TRIANGLE.colors.fillCanvas(this.style.backgroundColor);TRIANGLE.colors.showCanvasMenu(this,function(){TRIANGLE.saveItem.createAnimation("border-left-color",TRIANGLE.item.borderLeftColor,TRIANGLE.colors.canvasColorChoice,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.borderLeftColor=TRIANGLE.colors.canvasColorChoice;TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.colors.canvasPaletteTarget="borderLeftColor"});document.getElementById("colorListBorderR").addEventListener("click",function(){if(!TRIANGLE.item){return}TRIANGLE.colors.fillCanvas(this.style.backgroundColor);TRIANGLE.colors.showCanvasMenu(this,function(){TRIANGLE.saveItem.createAnimation("border-right-color",TRIANGLE.item.borderRightColor,TRIANGLE.colors.canvasColorChoice,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.borderRightColor=TRIANGLE.colors.canvasColorChoice;TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.colors.canvasPaletteTarget="borderRightColor"});document.getElementById("colorListBorderT").addEventListener("click",function(){if(!TRIANGLE.item){return}TRIANGLE.colors.fillCanvas(this.style.backgroundColor);TRIANGLE.colors.showCanvasMenu(this,function(){TRIANGLE.saveItem.createAnimation("border-top-color",TRIANGLE.item.borderTopColor,TRIANGLE.colors.canvasColorChoice,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.borderTopColor=TRIANGLE.colors.canvasColorChoice;TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.colors.canvasPaletteTarget="borderTopColor"});document.getElementById("colorListBorderB").addEventListener("click",function(){if(!TRIANGLE.item){return}TRIANGLE.colors.fillCanvas(this.style.backgroundColor);TRIANGLE.colors.showCanvasMenu(this,function(){TRIANGLE.saveItem.createAnimation("border-bottom-color",TRIANGLE.item.borderBottomColor,TRIANGLE.colors.canvasColorChoice,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.borderBottomColor=TRIANGLE.colors.canvasColorChoice;TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.colors.canvasPaletteTarget="borderBottomColor"});document.getElementById("colorBoxShadow").addEventListener("click",function(){if(!TRIANGLE.item){return}TRIANGLE.colors.fillCanvas(TRIANGLE.colors.getBoxShadowColor(TRIANGLE.item.objRef));TRIANGLE.colors.showCanvasMenu(this,function(){var c=document.getElementById("boxShadowH");var b=document.getElementById("boxShadowV");var a=document.getElementById("boxShadowBlur");if(c.value==0&&b.value==0&&a.value==0){TRIANGLE.saveItem.createAnimation("box-shadow",TRIANGLE.itemStyles.boxShadow,"",function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.boxShadow=""}else{var d=parseInt(c.value)+"px "+parseInt(b.value)+"px "+parseInt(a.value)+"px "+TRIANGLE.colors.canvasColorChoice;TRIANGLE.saveItem.createAnimation("box-shadow",TRIANGLE.itemStyles.boxShadow,d,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.boxShadow=d}});TRIANGLE.colors.canvasPaletteTarget="boxShadow"});document.getElementById("colorFont").addEventListener("click",function(){if(!TRIANGLE.item){return}TRIANGLE.colors.showCanvasMenu(this,function(){TRIANGLE.saveItem.createAnimation("color",TRIANGLE.itemStyles.color,TRIANGLE.colors.canvasColorChoice,function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.item.objRef.style.color=TRIANGLE.colors.canvasColorChoice});TRIANGLE.colors.canvasPaletteTarget="color"});document.getElementById("canvasBlack").addEventListener("mouseover",function(){document.getElementById("canvasPreviewColor").style.backgroundColor="black"});document.getElementById("canvasWhite").addEventListener("mouseover",function(){document.getElementById("canvasPreviewColor").style.backgroundColor="white"})},objectReference:"",styleCallback:null,canvasColorChoice:document.getElementById("canvasColorChoice").style.backgroundColor,showCanvasMenu:function showCanvasMenu(d,c){TRIANGLE.colors.objectReference=d;var a=document.getElementById("canvasWrapper");var b=d.getBoundingClientRect();TRIANGLE.colors.styleCallback=c;a.style.top=b.bottom+"px";a.style.left=b.left+"px";a.style.display="inline-block"},applyCanvasColor:function applyCanvasColor(){TRIANGLE.colors.objectReference.style.backgroundColor=TRIANGLE.colors.canvasColorChoice;if(TRIANGLE.colors.styleCallback&&typeof TRIANGLE.colors.styleCallback=="function"){TRIANGLE.colors.styleCallback()}TRIANGLE.colors.cancelCanvasMenu();TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass)},cancelCanvasMenu:function cancelCanvasMenu(){document.getElementById("canvasPalette").style.display="none";document.getElementById("canvasWrapper").style.display="none"},fillCanvas:function fillCanvas(g){if(g==="inherit"||!g){g="white"}document.getElementById("canvasCrosshair").style.top="8px";document.getElementById("canvasCrosshair").style.left="202px";document.getElementById("saturationMarker").style.top="207px";TRIANGLE.colors.canvasColorChoice=g;document.getElementById("canvasPreviewColor").style.backgroundColor=g;document.getElementById("canvasColorChoice").style.backgroundColor=g;var b=document.getElementById("canvasHueBar");var e=document.getElementById("canvasSaturationBar");var a=document.getElementById("canvasColorMenu");if(b.getContext){b.addEventListener("mousemove",TRIANGLE.colors.canvasPreviewColor);b.addEventListener("click",TRIANGLE.colors.canvasChooseColor);e.addEventListener("mousemove",TRIANGLE.colors.canvasPreviewColor);e.addEventListener("click",TRIANGLE.colors.canvasChooseColor);a.addEventListener("mousemove",TRIANGLE.colors.canvasPreviewColor);a.addEventListener("click",TRIANGLE.colors.canvasChooseColor);var i=b.getContext("2d");var j=i.createLinearGradient(0,0,20,200);j.addColorStop(0,"red");j.addColorStop(0.2,"orange");j.addColorStop(0.4,"yellow");j.addColorStop(0.6,"green");j.addColorStop(0.8,"blue");j.addColorStop(1,"purple");i.fillStyle=j;i.fillRect(0,0,20,200);var d=e.getContext("2d");var h=d.createLinearGradient(0,0,20,200);h.addColorStop(0,"#ffffff");h.addColorStop(1,g);d.fillStyle=h;d.fillRect(0,0,20,200);var c=a.getContext("2d");var f=c.createLinearGradient(0,200,200,0);f.addColorStop(0,"#000000");f.addColorStop(1,g);c.fillStyle=f;c.fillRect(0,0,200,200)}},canvasPreviewColor:function canvasPreviewColor(g){var e=this;var f=e.getBoundingClientRect();var d=g.clientX-f.left;var c=g.clientY-f.top;var b=e.getContext("2d");var a=b.getImageData(d,c,1,1).data;var a="#"+("000000"+TRIANGLE.colors.convertCanvasData(a)).slice(-6);document.getElementById("canvasPreviewColor").style.backgroundColor=a},canvasChooseColor:function canvasChooseColor(a){var b=this;var g=b.getBoundingClientRect();var f=a.clientX-g.left;var e=a.clientY-g.top;var i=b.getContext("2d");var h=i.getImageData(f,e,1,1).data;var h="#"+("000000"+TRIANGLE.colors.convertCanvasData(h)).slice(-6);TRIANGLE.colors.canvasColorChoice=h;document.getElementById("canvasColorChoice").style.backgroundColor=h;if(this.getAttribute("id")=="canvasColorMenu"){document.getElementById("canvasCrosshair").style.left=f+5+"px";document.getElementById("canvasCrosshair").style.top=e+5+"px";var c=document.getElementById("canvasSaturationBar");var i=c.getContext("2d");var d=i.createLinearGradient(0,0,20,200);d.addColorStop(0,"#ffffff");d.addColorStop(1,h);i.fillStyle=d;i.fillRect(0,0,20,200);document.getElementById("saturationMarker").style.top="207px"}else{if(this.getAttribute("id")=="canvasSaturationBar"){document.getElementById("saturationMarker").style.top=e+8+"px"}else{if(this.getAttribute("id")=="canvasHueBar"){TRIANGLE.colors.fillCanvas(h)}}}},canvasPaletteTarget:null,toggleCanvasPalette:function(){var c=document.getElementById("canvasPalette");if(c.style.display==="none"){c.innerHTML="";TRIANGLE.colors.createPalette(true,true);var b=document.getElementById("colorPalette").getElementsByClassName("colorPaletteItem");for(var a=0;a<b.length;a++){var d=b[a].cloneNode(true);d.setAttribute("onClick","TRIANGLE.colors.fillCanvas(this.style.backgroundColor)");c.appendChild(d);if((a+1)%10===0){c.innerHTML+="<br>"}}c.style.display="block"}else{c.style.display="none"}},applyCanvasPaletteColor:function(c){var d=TRIANGLE.colors.canvasPaletteTarget;var a=c.style.backgroundColor;if(d==="bodyBg"){TRIANGLE.iframe().contentDocument.body.style.backgroundColor=a;TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundColor=a}else{if(d==="boxShadow"){var b=TRIANGLE.itemStyles.boxShadow.split(" ");if(isNaN(parseFloat(b[0]))){b[0]=a;TRIANGLE.item.objRef.style.boxShadow=b.join(" ")}else{if(isNaN(parseFloat(b[1]))){b[1]=a;TRIANGLE.item.objRef.style.boxShadow=b.join(" ")}else{if(isNaN(parseFloat(b[2]))){b[2]=a;TRIANGLE.item.objRef.style.boxShadow=b.join(" ")}else{if(isNaN(parseFloat(b[3]))){b[3]=a;TRIANGLE.item.objRef.style.boxShadow=b.join(" ")}}}}}else{TRIANGLE.item.objRef.style[d]=a}}TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass)},convertCanvasData:function convertCanvasData(a){return((a[0]<<16)|(a[1]<<8)|a[2]).toString(16)},colorDropIndex:-1,colorDropper:function colorDropper(){if(!TRIANGLE.item){return}TRIANGLE.colors.colorDropIndex=TRIANGLE.item.index;for(var a=0;a<TRIANGLE.templateItems.length;a++){if(!TRIANGLE.isType.imageItem(TRIANGLE.templateItems[a])){TRIANGLE.templateItems[a].addEventListener("mousedown",TRIANGLE.colors.colorDropChoose)}TRIANGLE.templateItems[a].style.cursor="crosshair"}var b=document.getElementsByClassName("colorPaletteItem");for(var a=0;a<b.length;a++){b[a].addEventListener("mousedown",TRIANGLE.colors.colorDropChoose);b[a].style.cursor="crosshair"}document.getElementById("colorDropper").style.cursor="crosshair"},colorDropChoose:function chooseColor(){if(this.style.backgroundColor==="inherit"){TRIANGLE.iframe().getTriangleIndex(TRIANGLE.colors.colorDropIndex).style.backgroundColor=this.parentNode.style.backgroundColor}else{TRIANGLE.iframe().getTriangleIndex(TRIANGLE.colors.colorDropIndex).style.backgroundColor=this.style.backgroundColor}for(var a=0;a<TRIANGLE.templateItems.length;a++){TRIANGLE.templateItems[a].removeEventListener("mousedown",TRIANGLE.colors.colorDropChoose);TRIANGLE.templateItems[a].style.cursor=""}var b=document.getElementsByClassName("colorPaletteItem");for(var a=0;a<b.length;a++){b[a].removeEventListener("mousedown",TRIANGLE.colors.colorDropChoose);b[a].style.cursor=""}document.getElementById("colorDropper").style.cursor="";TRIANGLE.importItem.single(TRIANGLE.colors.colorDropIndex);TRIANGLE.colors.colorDropIndex=-1;TRIANGLE.selectionBorder.update()},cancelColorDropper:function cancelColorDropper(){for(var a=0;a<TRIANGLE.templateItems.length;a++){TRIANGLE.templateItems[a].removeEventListener("mousedown",TRIANGLE.colors.colorDropChoose);TRIANGLE.templateItems[a].style.cursor=""}document.getElementById("colorDropper").style.cursor="";TRIANGLE.colors.colorDropIndex=-1},createPalette:function(g,e){a();var h=document.getElementById("colorPalette");var b={paletteItemsBg:[],paletteItemsFont:[],paletteItemsBorder:[],paletteItemsShadow:[]};for(var f=0;f<TRIANGLE.templateItems.length;f++){k(document.body.style.backgroundColor,"paletteItemsBg");k(TRIANGLE.templateItems[f].style.backgroundColor,"paletteItemsBg");k(TRIANGLE.templateItems[f].style.color,"paletteItemsFont");k(TRIANGLE.templateItems[f].style.borderLeftColor,"paletteItemsBorder");k(TRIANGLE.templateItems[f].style.borderRightColor,"paletteItemsBorder");k(TRIANGLE.templateItems[f].style.borderTopColor,"paletteItemsBorder");k(TRIANGLE.templateItems[f].style.borderBottomColor,"paletteItemsBorder");var j=TRIANGLE.templateItems[f].style.boxShadow;j=j.replace(/rgb\((\d+), (\d+), (\d+)\)/g,"rgb($1,$2,$3)");j=j.split(" ");if(isNaN(parseFloat(j[0]))){k(j[0],"paletteItemsShadow")}else{if(isNaN(parseFloat(j[1]))){k(j[1],"paletteItemsShadow")}else{if(isNaN(parseFloat(j[2]))){k(j[2],"paletteItemsShadow")}else{if(isNaN(parseFloat(j[3]))){k(j[3],"paletteItemsShadow")}}}}}c();if(document.getElementById("paletteItemsBg").innerHTML!==""){document.getElementById("paletteItemsBg").innerHTML="Background<br><hr>"+document.getElementById("paletteItemsBg").innerHTML+"<div class='clear'></div><hr>"}if(document.getElementById("paletteItemsFont").innerHTML!==""){document.getElementById("paletteItemsFont").innerHTML="Font<br><hr>"+document.getElementById("paletteItemsFont").innerHTML+"<div class='clear'></div><hr>"}if(document.getElementById("paletteItemsBorder").innerHTML!==""){document.getElementById("paletteItemsBorder").innerHTML="Border<br><hr>"+document.getElementById("paletteItemsBorder").innerHTML+"<div class='clear'></div><hr>"}if(document.getElementById("paletteItemsShadow").innerHTML!==""){document.getElementById("paletteItemsShadow").innerHTML="Box Shadow<br><hr>"+document.getElementById("paletteItemsShadow").innerHTML+"<div class='clear'></div><hr>"}if(!g){h.style.display="block"}if(!e){h.style.left=document.getElementById("createPalette").getBoundingClientRect().left+"px";h.style.top=document.getElementById("createPalette").getBoundingClientRect().bottom+12+"px"}function k(l,m){var i=0;if(l&&l!="inherit"&&b[m].indexOf(l)===-1){b[m][i]=l;d(b[m][i],m);i++}}function d(i,l){var m=document.createElement("div");m.className="colorPaletteItem";m.style.backgroundColor=i;document.getElementById(l).appendChild(m,document.getElementById("paletteFloat"))}function a(){document.getElementById("paletteItemsBg").innerHTML="";document.getElementById("paletteItemsFont").innerHTML="";document.getElementById("paletteItemsBorder").innerHTML="";document.getElementById("paletteItemsShadow").innerHTML=""}function c(){var l=document.getElementById("paletteItemsBg").getElementsByClassName("colorPaletteItem");for(var o=0;o<l.length;o++){l[o].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'backgroundColor')");l[o].setAttribute("onMouseOver","TRIANGLE.tooltip.show(TRIANGLE.colors.rgbToHex(this.style.backgroundColor));");l[o].setAttribute("onMouseOut","TRIANGLE.tooltip.hide();");l[o].setAttribute("onMouseMove","TRIANGLE.tooltip.update(event);")}var p=document.getElementById("paletteItemsFont").getElementsByClassName("colorPaletteItem");for(var o=0;o<p.length;o++){p[o].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'color')");p[o].setAttribute("onMouseOver","TRIANGLE.tooltip.show(TRIANGLE.colors.rgbToHex(this.style.backgroundColor));");p[o].setAttribute("onMouseOut","TRIANGLE.tooltip.hide();");p[o].setAttribute("onMouseMove","TRIANGLE.tooltip.update(event);")}var n=document.getElementById("paletteItemsBorder").getElementsByClassName("colorPaletteItem");for(var o=0;o<n.length;o++){n[o].setAttribute("onMouseOver","TRIANGLE.colors.askBorderSide(this);TRIANGLE.tooltip.show(TRIANGLE.colors.rgbToHex(this.style.backgroundColor));");n[o].setAttribute("onMouseOut","document.getElementById('askBorderSide').style.display = 'none';TRIANGLE.tooltip.hide();");n[o].setAttribute("onMouseMove","TRIANGLE.tooltip.update(event);")}var m=document.getElementById("paletteItemsShadow").getElementsByClassName("colorPaletteItem");for(var o=0;o<m.length;o++){m[o].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'shadow')");m[o].setAttribute("onMouseOver","TRIANGLE.tooltip.show(TRIANGLE.colors.rgbToHex(this.style.backgroundColor));");m[o].setAttribute("onMouseOut","TRIANGLE.tooltip.hide();");m[o].setAttribute("onMouseMove","TRIANGLE.tooltip.update(event);")}}if(TRIANGLE.templateItems.length===0){document.getElementById("paletteItemsBg").innerHTML="No colors to display"}},closePalette:function(){document.getElementById("colorPalette").style.display="none"},askBorderColorChoice:null,askBorderSide:function(a){var b=document.getElementById("askBorderSide");TRIANGLE.colors.askBorderColorChoice=a.style.backgroundColor;b.style.left=a.getBoundingClientRect().left+"px";b.style.top=a.getBoundingClientRect().bottom+"px";b.children[0].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'border', 'left');");b.children[1].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'border', 'right');");b.children[2].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'border', 'top');");b.children[3].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'border', 'bottom');");b.children[4].setAttribute("onClick","TRIANGLE.colors.applyPaletteColor(this, 'border', 'all');");b.style.display="block"},applyPaletteColor:function(c,d,b){if(TRIANGLE.item){var a=c.style.backgroundColor;if(d=="border"&&b){if(b=="left"||b=="all"){if(TRIANGLE.item.borderLeft){TRIANGLE.item.objRef.style.borderLeftColor=TRIANGLE.colors.askBorderColorChoice}else{TRIANGLE.item.objRef.style.borderLeft="2px solid "+TRIANGLE.colors.askBorderColorChoice}}if(b=="right"||b=="all"){if(TRIANGLE.item.borderRight){TRIANGLE.item.objRef.style.borderRightColor=TRIANGLE.colors.askBorderColorChoice}else{TRIANGLE.item.objRef.style.borderRight="2px solid "+TRIANGLE.colors.askBorderColorChoice}}if(b=="top"||b=="all"){if(TRIANGLE.item.borderTop){TRIANGLE.item.objRef.style.borderTopColor=TRIANGLE.colors.askBorderColorChoice}else{TRIANGLE.item.objRef.style.borderTop="2px solid "+TRIANGLE.colors.askBorderColorChoice}}if(b=="bottom"||b=="all"){if(TRIANGLE.item.borderBottom){TRIANGLE.item.objRef.style.borderBottomColor=TRIANGLE.colors.askBorderColorChoice}else{TRIANGLE.item.objRef.style.borderBottom="2px solid "+TRIANGLE.colors.askBorderColorChoice}}}else{if(d=="shadow"){TRIANGLE.colors.setBoxShadowColor(TRIANGLE.item.objRef,a)}else{TRIANGLE.item.objRef.style[d]=a}}TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass)}},dragPalette:{xInitial:null,yInitial:null,active:false,initiate:function(b){var a=document.getElementById("colorPalette");TRIANGLE.colors.dragPalette.active=true;document.addEventListener("mousemove",TRIANGLE.colors.dragPalette.start);document.addEventListener("mouseup",TRIANGLE.colors.dragPalette.stop);TRIANGLE.colors.dragPalette.xInitial=b.clientX-a.getBoundingClientRect().left;TRIANGLE.colors.dragPalette.yInitial=b.clientY-a.getBoundingClientRect().top},start:function(c){if(TRIANGLE.colors.dragPalette.active){var a=document.getElementById("colorPalette");var b=a.getBoundingClientRect();a.style.left=c.clientX-TRIANGLE.colors.dragPalette.xInitial+"px";a.style.top=c.clientY-TRIANGLE.colors.dragPalette.yInitial+"px"}},stop:function(){TRIANGLE.colors.dragPalette.active=false;document.removeEventListener("mousemove",TRIANGLE.colors.dragPalette.start);document.removeEventListener("mouseup",TRIANGLE.colors.dragPalette.stop)}},getBoxShadowColor:function(b){var a=b.style.boxShadow;a=a.replace(/rgb\((\d+), (\d+), (\d+)\)/g,"rgb($1,$2,$3)");a=a.split(" ");if(isNaN(parseFloat(a[0]))){return a[0]}else{if(isNaN(parseFloat(a[1]))){return a[1]}else{if(isNaN(parseFloat(a[2]))){return a[2]}else{if(isNaN(parseFloat(a[3]))){return a[3]}}}}},setBoxShadowColor:function(c,a){var b=c.style.boxShadow;if(b===""){c.style.boxShadow="5px 5px 5px "+a;return}else{b=b.replace(/rgb\((\d+), (\d+), (\d+)\)/g,"rgb($1,$2,$3)");b=b.split(" ");if(isNaN(parseFloat(b[0]))){b[0]=a;c.style.boxShadow=b.join(" ")}else{if(isNaN(parseFloat(b[1]))){b[1]=a;c.style.boxShadow=b.join(" ")}else{if(isNaN(parseFloat(b[2]))){b[2]=a;c.style.boxShadow=b.join(" ")}else{if(isNaN(parseFloat(b[3]))){b[3]=a;c.style.boxShadow=b.join(" ")}}}}}},rgbToHex:function rgbToHex(c){if((/rgb/).test(c)){var d=c.replace(/[^\d,]/g,"").split(",");var f=parseInt(d[0]);var e=parseInt(d[1]);var a=parseInt(d[2]);return"#"+((1<<24)+(f<<16)+(e<<8)+a).toString(16).slice(1)}else{return c}},hexToRgb:function hexToRgb(b){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null},updateBodyBg:function updateBodyBg(){var a=TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundColor;TRIANGLE.iframe().contentDocument.body.style.backgroundColor=a;TRIANGLE.iframe().contentDocument.body.style.backgroundImage=a;document.getElementById("colorMainBg").style.backgroundColor=a},oppositeColor:function oppositeColor(a){a=a.replace(/#/g,"");var b=("000000"+(("0xffffff"^("0x"+a)).toString(16))).slice(-6);return"#"+b},randomColor:function randomColor(){var d=Math.floor(Math.random()*255);var c=Math.floor(Math.random()*255);var a=Math.floor(Math.random()*255);return"rgb("+d+","+c+","+a+")"},colorToRGBA:function(b){var c,a;c=document.createElement("canvas");c.height=1;c.width=1;a=c.getContext("2d");a.fillStyle=b;a.fillRect(0,0,1,1);return a.getImageData(0,0,1,1).data},isColorLight:function(c){var d=TRIANGLE.colors.colorToRGBA(c);var h=d[0];var f=d[1];var a=d[2];var e=1-(0.299*h+0.587*f+0.114*a)/255;return(e<0.5)}};TRIANGLE.text={insertTextBox:function insertTextBox(b){var a=document.createElement("p");a.style.backgroundColor="";a.style.marginTop="1em";a.style.marginBottom="1em";a.style.height="auto";a.style.width="100%";a.style.padding="15px";a.style.fontSize="inherit";a.style.lineHeight=1;a.style.fontFamily="inherit";a.style.display="block";a.setAttribute("triangle-class","templateItem textbox");a.innerHTML=b||"New text box";if(TRIANGLE.item&&!TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){if(TRIANGLE.item.objRef.style.backgroundColor=="inherit"||TRIANGLE.item.objRef.style.backgroundColor==""){a.style.color="#333333"}else{a.style.color=TRIANGLE.colors.isColorLight(TRIANGLE.item.objRef.style.backgroundColor)?"#333333":"white"}if(TRIANGLE.isType.containsNbsp(TRIANGLE.item.objRef)){TRIANGLE.stripNbsp(TRIANGLE.item.objRef)}TRIANGLE.checkPadding(TRIANGLE.item.objRef);TRIANGLE.item.objRef.appendChild(a);TRIANGLE.selectionBorder.update();TRIANGLE.updateTemplateItems(true)}else{if(!TRIANGLE.item){a.style.color=TRIANGLE.colors.isColorLight(TRIANGLE.template().style.backgroundColor)?"#333333":"white";TRIANGLE.template().appendChild(a);window.scrollTo(0,document.body.scrollHeight);TRIANGLE.selectionBorder.update();TRIANGLE.updateTemplateItems(true)}}},originalTextPosition:null,clearPastedStyles:function(a){if(TRIANGLE.item&&TRIANGLE.item.objRef.isContentEditable){setTimeout(function(){var c=TRIANGLE.text.getSelectionCoords().r;var b=document.createRange();b.setStart(TRIANGLE.text.originalTextPosition.startContainer,TRIANGLE.text.originalTextPosition.startOffset);b.setEnd(c.endContainer,c.endOffset);var d=window.getSelection();d.removeAllRanges();d.addRange(b);document.execCommand("removeFormat");b.setStart(c.startContainer,c.startOffset);b.setEnd(c.endContainer,c.endOffset);d.removeAllRanges();d.addRange(b);TRIANGLE.selectionBorder.update()},20)}},editText:function editText(){TRIANGLE.item.objRef.removeEventListener("dblclick",TRIANGLE.text.editText);TRIANGLE.item.objRef.addEventListener("keyup",TRIANGLE.selectionBorder.update);TRIANGLE.item.objRef.addEventListener("paste",TRIANGLE.text.clearPastedStyles);TRIANGLE.item.objRef.contentEditable="true";TRIANGLE.item.objRef.focus();TRIANGLE.item.objRef.style.cursor="text";if(TRIANGLE.item.objRef.innerHTML=="New text box"||TRIANGLE.item.objRef.innerHTML=="Field Label"){TRIANGLE.item.objRef.innerHTML=""}document.getElementById("selectionBorder").style.border="1px dashed black";TRIANGLE.resize.removeHandles();TRIANGLE.menu.displaySubMenu("displayTextStyles");TRIANGLE.menu.menuBtnActive(document.getElementById("opTextStyles"))},checkTextEditing:function checkTextEditing(d){var c=TRIANGLE.item;var b=TRIANGLE.iframe().querySelectorAll("[triangle-class~=textbox]");for(var a=0;a<b.length;a++){if(b[a].isContentEditable&&b[a]!==TRIANGLE.iframe().contentDocument.activeElement){TRIANGLE.text.clearTextSelection();b[a].contentEditable="false";b[a].style.cursor="";b[a].removeEventListener("keyup",TRIANGLE.selectionBorder.update);b[a].removeEventListener("paste",TRIANGLE.text.clearPastedStyles);b[a].innerHTML=b[a].innerHTML.replace(/<br>$/gm,"");if(b[a].innerHTML.length===0||b[a].innerHTML=="<br>"||b[a].innerHTML=="&nbsp;"||e(b[a])===0){b[a].innerHTML="New text box"}}}function e(g){var h=0;if(g.nodeType==3){h=1}for(var f=0;f<g.childNodes.length;++f){h+=e(g.childNodes[f])}return h}},preventTextSelect:function preventTextSelect(){for(var a=0;a<TRIANGLE.templateItems.length;a++){TRIANGLE.templateItems[a].style.cssText+="-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;"}},allowTextSelect:function allowTextSelect(){for(var a=0;a<TRIANGLE.templateItems.length;a++){TRIANGLE.templateItems[a].style.cssText=TRIANGLE.templateItems[a].style.cssText.replace(/-webkit-touch-callout: none;|-webkit-user-select: none;|-khtml-user-select: none;|-moz-user-select: none;|-ms-user-select: none;|user-select: none;/g,"")}},clearTextSelection:function clearTextSelection(){if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else{if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}}else{if(document.selection){document.selection.empty()}}},bold:function boldText(){var a=TRIANGLE.item;if(a&&TRIANGLE.isType.textBox(a.objRef)){if(a.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("bold")}else{if((/<\/*(b|strong)>/g).test(a.objRef.innerHTML)){a.objRef.innerHTML=a.objRef.innerHTML.replace(/<\/*(b|strong)>/g,"")}else{a.objRef.innerHTML="<strong>"+a.objRef.innerHTML+"</strong>"}}}else{return}},italic:function italicText(){var a=TRIANGLE.item;if(a&&TRIANGLE.isType.textBox(a.objRef)){if(a.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("italic")}else{if((/<\/*(i|em)>/g).test(a.objRef.innerHTML)){a.objRef.innerHTML=a.objRef.innerHTML.replace(/<\/*(i|em)>/g,"")}else{a.objRef.innerHTML="<em>"+a.objRef.innerHTML+"</em>"}}}else{return}},underline:function underlineText(){if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){if(TRIANGLE.item.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("underline")}else{if((/<\/*u>/g).test(TRIANGLE.item.objRef.innerHTML)){TRIANGLE.item.objRef.innerHTML=TRIANGLE.item.objRef.innerHTML.replace(/<\/*u>/g,"")}else{TRIANGLE.item.objRef.innerHTML="<u>"+TRIANGLE.item.objRef.innerHTML+"</u>"}}}else{return}},align:function alignText(a){if(TRIANGLE.item){if(TRIANGLE.item.objRef.isContentEditable){switch(a){case"left":TRIANGLE.iframe().contentDocument.execCommand("justifyLeft");break;case"center":TRIANGLE.iframe().contentDocument.execCommand("justifyCenter");break;case"right":TRIANGLE.iframe().contentDocument.execCommand("justifyRight");break;default:break}}else{TRIANGLE.item.objRef.style.textAlign=a}}},importedHyperlink:null,savedTextRange:null,createHyperlink:function createHyperlink(){if(TRIANGLE.item){if(TRIANGLE.isType.textBox(TRIANGLE.item.objRef)&&TRIANGLE.item.objRef.isContentEditable){var c=TRIANGLE.text.getSelectionCoords();var a=document.getElementById("hyperlinkMenu");a.style.display="inline-block";a.style.left=c.x+"px";if(a.getBoundingClientRect().right>window.innerWidth){a.style.left="auto";a.style.right=0}else{a.style.right="auto"}a.style.top=c.y+"px";TRIANGLE.text.savedTextRange=c.r;document.getElementById("hyperlinkURL").focus()}else{TRIANGLE.pages.loadPages("","select");var b=TRIANGLE.item.objRef.getBoundingClientRect();var a=document.getElementById("hyperlinkMenu");a.style.display="inline-block";a.style.left=b.left+"px";if(a.getBoundingClientRect().right>window.innerWidth){a.style.left="auto";a.style.right=0}else{a.style.right="auto"}a.style.top=b.bottom+"px";if(a.getBoundingClientRect().bottom>window.innerHeight){a.style.top="auto";a.style.bottom=0}else{a.style.bottom="auto"}document.getElementById("hyperlinkURL").focus()}}else{return}},applyHyperlink:function applyHyperlink(){if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.text.replaceTextSelection();var c=document.getElementById("hyperlinkPage");if(c.selectedIndex!==0){var b=c.options[c.selectedIndex].value+".php";if(TRIANGLE.isType.textBox(TRIANGLE.item.objRef)&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("createLink",null,b)}else{TRIANGLE.item.objRef.setAttribute("link-to",b)}}else{if(document.getElementById("hyperlinkURL").value!==""){var a=document.getElementById("hyperlinkURL").value;if(TRIANGLE.isType.textBox(TRIANGLE.item.objRef)&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("createLink",null,a)}else{TRIANGLE.item.objRef.setAttribute("link-to",a)}}}TRIANGLE.text.underline();TRIANGLE.text.cancelHyperlink()}else{if(TRIANGLE.item){var c=document.getElementById("hyperlinkPage");if(c.selectedIndex!==0){var b=c.options[c.selectedIndex].value+".php";TRIANGLE.item.objRef.setAttribute("link-to",b)}else{if(document.getElementById("hyperlinkURL").value!==""){var a=document.getElementById("hyperlinkURL").value;TRIANGLE.item.objRef.setAttribute("link-to",a)}}TRIANGLE.text.cancelHyperlink()}else{TRIANGLE.text.cancelHyperlink()}}TRIANGLE.importItem.single(TRIANGLE.item.index)},cancelHyperlink:function cancelHyperlink(){document.getElementById("hyperlinkURL").value="";document.getElementById("hyperlinkPage").selectedIndex=0;document.getElementById("hyperlinkMenu").style.display="none"},deleteHyperlink:function deleteHyperlink(){if(TRIANGLE.item){if(TRIANGLE.isType.textBox(TRIANGLE.item.objRef)&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("unlink")}else{var a=TRIANGLE.item.objRef.firstChild;var b=a?a.tagName:null;if(TRIANGLE.isType.textBox(TRIANGLE.item.objRef)&&TRIANGLE.item.objRef.children.length===1&&b==="A"){TRIANGLE.item.objRef.innerHTML=a.innerHTML}else{if(TRIANGLE.item.objRef.getAttribute("link-to")){TRIANGLE.item.objRef.removeAttribute("link-to");TRIANGLE.item.objRef.removeAttribute("target")}}}if((/<u>/).test(TRIANGLE.item.objRef.innerHTML)){TRIANGLE.text.underline()}document.getElementById("hrefHyperlink").value="";document.getElementById("hrefTarget").value=0}},changeLinkTarget:function(b){if(b.selectedIndex===0){if(TRIANGLE.text.importedHyperlink!=null){TRIANGLE.text.importedHyperlink.removeAttribute("target")}else{if(!TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){TRIANGLE.item.objRef.removeAttribute("target")}else{TRIANGLE.item.objRef.firstChild.removeAttribute("target")}}}else{var a=b.options[b.selectedIndex].text;if(TRIANGLE.text.importedHyperlink){TRIANGLE.text.importedHyperlink.setAttribute("target",a)}else{if(!TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){TRIANGLE.item.objRef.setAttribute("target",a)}else{TRIANGLE.item.objRef.firstChild.setAttribute("target",a)}}}},insertUnorderedList:function insertUnorderedList(){if(TRIANGLE.item&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("insertUnorderedList");TRIANGLE.selectionBorder.update()}else{return}},insertOrderedList:function insertOrderedList(){if(TRIANGLE.item&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("insertOrderedList");TRIANGLE.selectionBorder.update()}else{return}},insertHorizontalRule:function insertHorizontalRule(){if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){if(TRIANGLE.item.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("insertHorizontalRule")}else{TRIANGLE.item.objRef.innerHTML+="<hr>"}TRIANGLE.selectionBorder.update()}else{return}},changeFont:function changeFont(d){var c=d.options[d.selectedIndex];var f=c.text;var e=c.getAttribute("triangle-font-category");var g=TRIANGLE.iframe().getElementById("fontData");if(c.getAttribute("google-font")=="true"){var b=g.querySelector("[triangle-font-family='"+f+"']")||false;if(!b){var a=document.createElement("link");a.setAttribute("href","https://fonts.googleapis.com/css2?family="+f.replace(/ /g,"+")+":wght@100;300;400;500;700&display=swap");a.setAttribute("triangle-font-family",f);a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");g.appendChild(a)}}if(TRIANGLE.item&&TRIANGLE.item.objRef.isContentEditable){document.execCommand("styleWithCSS",null,true);document.execCommand("fontName",null,f);document.execCommand("styleWithCSS",null,false)}else{if(TRIANGLE.item){TRIANGLE.item.objRef.style.fontFamily="'"+f+"', "+e}else{TRIANGLE.template().style.fontFamily="'"+f+"', "+e}}TRIANGLE.selectionBorder.update()},deleteUnusedFonts:function(){var c=[TRIANGLE.template().style.fontFamily.split(",")[0].replace(/'|"/g,"")];for(var d=0;d<TRIANGLE.templateItems.length;d++){var a=TRIANGLE.templateItems[d].style.fontFamily.split(",")[0].replace(/'|"/g,"");if(a&&!c.includes(a)){c[c.length]=a}}var e=TRIANGLE.iframe().getElementById("fontData");var b=e.querySelectorAll("[triangle-font-family]");for(var d=0;d<b.length;d++){if(!c.includes(b[d].getAttribute("triangle-font-family"))){e.removeChild(b[d])}}},changeFontColor:function changeFontColor(b){var a=TRIANGLE.item;if(!TRIANGLE.isType.textBox(a.objRef)){return}TRIANGLE.text.replaceTextSelection();if(a.objRef.isContentEditable){TRIANGLE.iframe().contentDocument.execCommand("styleWithCSS",null,true);TRIANGLE.iframe().contentDocument.execCommand("foreColor",null,b);TRIANGLE.iframe().contentDocument.execCommand("styleWithCSS",null,false)}else{a.objRef.style.color=b}},increaseFontSize:function increaseFontSize(){if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){var b=document.getElementById("fontSize").value;var c=TRIANGLE.getUnit(b);var a=parseFloat(b)+1;TRIANGLE.item.objRef.style.fontSize=a+c;document.getElementById("fontSize").value=a;TRIANGLE.selectionBorder.update()}else{return}},decreaseFontSize:function decreaseFontSize(){if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){var b=document.getElementById("fontSize").value;var c=TRIANGLE.getUnit(TRIANGLE.itemStyles.fontSize);var a=(parseFloat(b)-1);a=a>0?a:b;TRIANGLE.item.objRef.style.fontSize=a+c;document.getElementById("fontSize").value=a;TRIANGLE.selectionBorder.update()}else{return}},changeFontSize:function(){if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){var b=document.getElementById("fontSize").value;var c=TRIANGLE.getUnit(TRIANGLE.itemStyles.fontSize);var a=parseFloat(b)+c;TRIANGLE.item.objRef.style.fontSize=a;TRIANGLE.selectionBorder.update()}else{return}},changeFontWeight:function(a){},getSelectionCoords:function getSelectionCoords(d){d=d||TRIANGLE.iframe().contentWindow;var i=d.document;var a=i.selection,b,j,g;var e=0,c=0;var f;if(a){if(a.type!="Control"){b=a.createRange();b.collapse(true);e=b.boundingRight;c=b.boundingTop}}else{if(d.getSelection){a=d.getSelection();if(a.rangeCount){b=a.getRangeAt(0).cloneRange();if(b.getClientRects){b.collapse(false);j=b.getClientRects();if(j.length>0){g=j[0];e=g.right;c=g.top}}if(e==0&&c==0){var h=i.createElement("span");if(h.getClientRects){h.appendChild(i.createTextNode("\u200b"));b.insertNode(h);g=h.getClientRects()[0];e=g.right;c=g.top;var k=h.parentNode;k.removeChild(h);k.normalize()}}}}}return{x:e,y:c,r:TRIANGLE.text.saveTextSelection()}},saveTextSelection:function saveTextSelection(){if(TRIANGLE.iframe().contentWindow.getSelection&&TRIANGLE.iframe().contentDocument.createRange){var b=TRIANGLE.iframe().contentWindow.getSelection();var a=b.getRangeAt(0).cloneRange();TRIANGLE.text.savedTextRange=a;return a}},replaceTextSelection:function replaceTextSelection(){var a=TRIANGLE.iframe().contentWindow.getSelection();a.removeAllRanges();a.addRange(TRIANGLE.text.savedTextRange)}};TRIANGLE.images={load:function loadImages(){AJAX.get("php/image_list.php","",function(a){document.getElementById("echoImageList").innerHTML=a.responseText})},upload:function(){TRIANGLE.popUp.open("uploadImagesCell");TRIANGLE.menu.closeSideMenu()},insert:function insertImage(d){if(TRIANGLE.item){if(TRIANGLE.isType.imageItem(TRIANGLE.item.objRef)){TRIANGLE.item.image.src=d.replace(/http(s?):\/\//g,"//");TRIANGLE.item.image.style.width="100%";TRIANGLE.item.image.style.height="auto";TRIANGLE.item.image.style.margin="";TRIANGLE.item.objRef.style.overflow="";TRIANGLE.item.objRef.style.height="auto";TRIANGLE.item.objRef.removeAttribute("crop-map");TRIANGLE.item.objRef.removeAttribute("crop-ratio");TRIANGLE.selectionBorder.update();TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.menu.closeSideMenu();return}else{if(!TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){if(TRIANGLE.images.setBackground){TRIANGLE.item.objRef.style.backgroundImage="url('"+d+"')";TRIANGLE.item.objRef.style.backgroundSize="cover";TRIANGLE.item.objRef.style.backgroundRepeat="no-repeat";TRIANGLE.item.objRef.style.backgroundPosition="center top";TRIANGLE.images.setBackground=false;TRIANGLE.updateTemplateItems()}else{if(TRIANGLE.isType.containsNbsp(TRIANGLE.item.objRef)){TRIANGLE.stripNbsp(TRIANGLE.item.objRef)}var a=document.createElement("div");a.setAttribute("triangle-class","templateItem childItem imageItem");a.style.display="inline-block";a.style.height="auto";a.style.width="100%";a.style.maxWidth="100%";var f=document.createElement("img");f.src=d;f.style.width="100%";f.style.height="auto";TRIANGLE.checkPadding(TRIANGLE.item.objRef);a.appendChild(f);TRIANGLE.item.append(a);TRIANGLE.selectionBorder.update();TRIANGLE.updateTemplateItems();var e=TRIANGLE.item.objRef.children.length;var c=TRIANGLE.item.objRef.children[e-1];var b=c.getAttribute("triangle-index");TRIANGLE.importItem.single(b)}}}}else{if(TRIANGLE.images.setBackground){TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundImage=TRIANGLE.iframe().contentDocument.body.style.backgroundImage="url('"+d+"')";TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundRepeat=TRIANGLE.iframe().contentDocument.body.style.backgroundRepeat="repeat";TRIANGLE.updateTemplateItems()}else{var a=document.createElement("div");a.setAttribute("triangle-class","templateItem childItem imageItem");a.style.display="inline-block";a.style.height="auto";a.style.width="auto";a.style.maxWidth="100%";var f=document.createElement("img");f.src=d;f.style.width="100%";f.style.height="100%";a.appendChild(f);TRIANGLE.template().appendChild(a);TRIANGLE.updateTemplateItems();TRIANGLE.importItem.single(TRIANGLE.templateItems.length-1)}}TRIANGLE.menu.closeSideMenu()},setBackground:false,removeBackground:function(){if(TRIANGLE.item){TRIANGLE.item.objRef.style.backgroundImage="";TRIANGLE.item.objRef.style.backgroundSize=""}else{TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundImage=TRIANGLE.iframe().contentDocument.body.style.backgroundImage=TRIANGLE.iframe().getElementById("bodyBgData").style.backgroundRepeat=TRIANGLE.iframe().contentDocument.body.style.backgroundRepeat=""}},crop:{toggleMenu:function(){var a=document.getElementById("cropImageMenu");if(a.style.display==="none"){a.style.display="block"}else{a.style.display="none"}},active:false,transferImage:function(){var m=TRIANGLE.item.objRef.getBoundingClientRect();var k=TRIANGLE.item.image;var g=k.cloneNode();var j=TRIANGLE.item.image.getBoundingClientRect();var c=document.getElementById("cropImageContainer");var o=document.getElementById("cropImageHandles");var p=2;var b=window.innerWidth-TRIANGLE.scrollbarWidth;var d=window.innerHeight;if(TRIANGLE.item.cropMap){var h=TRIANGLE.item.cropMap.split(",")[0];var e=TRIANGLE.item.cropMap.split(",")[1];var q=TRIANGLE.item.cropMap.split(",")[2];var l=TRIANGLE.item.cropMap.split(",")[3]}c.style.marginTop=(d-504)/2+"px";document.getElementById("cropImageBg").style.backgroundImage="url('"+k.src+"')";o.innerHTML="";o.appendChild(g);g=o.children[0];var i=500;var a=500;var f=m.width/j.width;var n=m.height/j.height;if(j.width>j.height){a*=j.height/j.width;g.style.marginLeft=q?q:"";g.style.marginTop=l?l:"";g.style.width=i+"px";g.style.height=a+"px";o.style.width=f*i+p+"px";o.style.maxWidth=i+p+"px";o.style.height=n*a+p+"px";o.style.maxHeight=a+p+"px";o.style.left=h?h:"";o.style.top=e?e:d/2-a/2-p/2+"px"}else{if(j.width<j.height){i*=j.width/j.height;g.style.marginLeft=q?q:"";g.style.marginTop=l?l:"";g.style.width=i+"px";g.style.height=a+"px";o.style.width=f*i+p+"px";o.style.maxWidth=i+p+"px";o.style.height=n*a+p+"px";o.style.maxHeight=a+p+"px";o.style.top=e?e:"";o.style.left=h?h:b/2-i/2-p/2+"px"}else{g.style.marginLeft=q?q:"";g.style.marginTop=l?l:"";g.style.width=i+"px";g.style.height=a+"px";o.style.width=f*i+p+"px";o.style.maxWidth=i+p+"px";o.style.height=n*a+p+"px";o.style.maxHeight=a+p+"px";o.style.top=e?e:"";o.style.left=h?h:""}}},showHandles:function(){var k=8;var j=8;var o=2;var e="cropHandle";var b=document.getElementById("cropImageContainer");var m=document.getElementById("cropImageHandles");var l=m.getBoundingClientRect();var a=window.innerWidth-TRIANGLE.scrollbarWidth;var c=window.innerHeight;var n=document.getElementsByClassName("cropHandle");for(var g=0;g<n.length;g++){n[g].style.display="block"}document.getElementById("cropTopLeft").style.left=l.left-k/2-o/2+"px";document.getElementById("cropTopLeft").style.top=l.top-k/2-o+"px";document.getElementById("cropTopMid").style.left=l.left+l.width/2-k/2+"px";document.getElementById("cropTopMid").style.top=document.getElementById("cropTopLeft").style.top;document.getElementById("cropTopRight").style.left=l.right-k/2+o/2+"px";document.getElementById("cropTopRight").style.top=document.getElementById("cropTopMid").style.top;var f=document.getElementById("cropTopLeft").style.left;var d=document.getElementById("cropTopMid").style.left;var h=document.getElementById("cropTopRight").style.left;document.getElementById("cropLeftMid").style.left=f;document.getElementById("cropLeftMid").style.top=l.top+l.height/2-j/2+o/2+"px";document.getElementById("cropRightMid").style.left=h;document.getElementById("cropRightMid").style.top=document.getElementById("cropLeftMid").style.top;document.getElementById("cropBotLeft").style.left=f;document.getElementById("cropBotLeft").style.top=l.top+l.height-k/2+"px";document.getElementById("cropBotMid").style.left=d;document.getElementById("cropBotMid").style.top=document.getElementById("cropBotLeft").style.top;document.getElementById("cropBotRight").style.left=h;document.getElementById("cropBotRight").style.top=document.getElementById("cropBotLeft").style.top},addHandleEventListeners:function(){document.getElementById("cropTopLeft").addEventListener("mouseover",TRIANGLE.images.crop.XY);document.getElementById("cropTopLeft").addEventListener("mousedown",TRIANGLE.images.crop.initiate);document.getElementById("cropTopMid").addEventListener("mouseover",TRIANGLE.images.crop.Y);document.getElementById("cropTopMid").addEventListener("mousedown",TRIANGLE.images.crop.initiate);document.getElementById("cropTopRight").addEventListener("mouseover",TRIANGLE.images.crop.XY);document.getElementById("cropTopRight").addEventListener("mousedown",TRIANGLE.images.crop.initiate);document.getElementById("cropLeftMid").addEventListener("mouseover",TRIANGLE.images.crop.X);document.getElementById("cropLeftMid").addEventListener("mousedown",TRIANGLE.images.crop.initiate);document.getElementById("cropRightMid").addEventListener("mouseover",TRIANGLE.images.crop.X);document.getElementById("cropRightMid").addEventListener("mousedown",TRIANGLE.images.crop.initiate);document.getElementById("cropBotLeft").addEventListener("mouseover",TRIANGLE.images.crop.XY);document.getElementById("cropBotLeft").addEventListener("mousedown",TRIANGLE.images.crop.initiate);document.getElementById("cropBotMid").addEventListener("mouseover",TRIANGLE.images.crop.Y);document.getElementById("cropBotMid").addEventListener("mousedown",TRIANGLE.images.crop.initiate);document.getElementById("cropBotRight").addEventListener("mouseover",TRIANGLE.images.crop.XY);document.getElementById("cropBotRight").addEventListener("mousedown",TRIANGLE.images.crop.initiate)},itemIndex:-1,direction:null,X:function(){TRIANGLE.images.crop.direction="X"},Y:function(){TRIANGLE.images.crop.direction="Y"},XY:function(){TRIANGLE.images.crop.direction="XY"},handleID:null,createBorder:function(){if(TRIANGLE.isType.imageItem(TRIANGLE.item.objRef)){TRIANGLE.images.crop.active=true;TRIANGLE.images.crop.itemIndex=TRIANGLE.item.index;TRIANGLE.images.crop.transferImage();TRIANGLE.images.crop.toggleMenu();TRIANGLE.images.crop.showHandles()}},initiate:function(){document.body.addEventListener("mousemove",TRIANGLE.images.crop.start);document.body.addEventListener("mouseup",TRIANGLE.images.crop.stop);TRIANGLE.images.crop.handleID=this.id},start:function(d){if(TRIANGLE.images.crop.active){TRIANGLE.images.crop.removeHandles();var c=d.clientX;var a=d.clientY;var n=2;var f=2;var e=document.getElementById("cropImageContainer");var m=e.getBoundingClientRect();var g=document.getElementById("cropImageHandles");var l=g.getBoundingClientRect();var i=g.children[0];var h=i.getBoundingClientRect();var k=m.right-(504-h.width)/2+n;var b=m.left+(504-h.width)/2-n/2;var j=m.top+(504-h.height)/2-n/2;var o=m.bottom-(504-h.height)/2+n;if(TRIANGLE.images.crop.direction==="X"||TRIANGLE.images.crop.direction==="XY"){if((/Left/g).test(TRIANGLE.images.crop.handleID)){if(c>b&&c<k-f){g.style.width=l.right-c+"px";g.style.left=c+"px";i.style.marginLeft=b-c+"px"}else{if(c<b){g.style.width=l.right-b+"px";g.style.left=b+"px";i.style.marginLeft=""}}}else{if(c>b+f&&c<k){g.style.width=c-l.left+"px"}else{if(c>k){g.style.width=k-l.left-n/2+"px"}}}}if(TRIANGLE.images.crop.direction==="Y"||TRIANGLE.images.crop.direction==="XY"){if((/Top/g).test(TRIANGLE.images.crop.handleID)){if(a>j&&a<o-f){g.style.height=l.bottom-a+"px";g.style.top=a+"px";i.style.marginTop=j-a+"px"}else{if(a<j){g.style.height=l.bottom-j+"px";g.style.top=j+"px";i.style.marginTop=""}}}else{if(a>j+f&&a<o){g.style.height=a-l.top+"px"}else{if(a>o){g.style.height=o-l.top-n/2+"px"}}}}}},stop:function(){document.body.removeEventListener("mousemove",TRIANGLE.images.crop.start);document.body.removeEventListener("mouseup",TRIANGLE.images.crop.stop);TRIANGLE.images.crop.showHandles()},cancel:function(){TRIANGLE.images.crop.active=false;TRIANGLE.importItem.single(TRIANGLE.images.crop.itemIndex);TRIANGLE.images.crop.itemIndex=-1;TRIANGLE.images.crop.toggleMenu()},applyCrop:function(){var n=2;var a=document.getElementById("cropImageContainer");var k=a.getBoundingClientRect();var d=document.getElementById("cropImageHandles");var j=d.getBoundingClientRect();var g=d.children[0];var f=g.getBoundingClientRect();var i=d.getBoundingClientRect();TRIANGLE.selectItem(TRIANGLE.images.crop.itemIndex);var h=TRIANGLE.item.objRef.getBoundingClientRect();TRIANGLE.item.objRef.style.overflow="hidden";var c=f.width/(j.width-n)*100;var m=f.height/(j.height-n)*100;var b=(j.left+n/2-f.left)/(j.width-n)*100;if(b<0.5){b=0}var e=(j.top+n/2-f.top)/(j.width-n)*100;if(e<0.5){e=0}TRIANGLE.item.objRef.setAttribute("crop-map",d.style.left+","+d.style.top+","+g.style.marginLeft+","+g.style.marginTop);var l=(j.width-n)/(j.height-n);TRIANGLE.item.objRef.setAttribute("crop-ratio",l);TRIANGLE.item.objRef.style.height=TRIANGLE.item.objRef.style.minHeight=Math.round(h.width/l)+"px";TRIANGLE.item.image.style.width=c+"%";TRIANGLE.item.image.style.height="auto";TRIANGLE.item.image.style.marginLeft=b>0?-1*b+"%":"";TRIANGLE.item.image.style.marginTop=e>0?-1*e+"%":"";TRIANGLE.images.crop.cancel();TRIANGLE.selectItem(TRIANGLE.item.index)},removeHandles:function(){var b=document.getElementsByClassName("cropHandle");for(var a=0;a<b.length;a++){b[a].style.display="none"}}},autoSize:function(){if(TRIANGLE.item&&TRIANGLE.isType.imageItem(TRIANGLE.item.objRef)){TRIANGLE.item.objRef.style.width="100%";if(TRIANGLE.item.cropRatio){var a=TRIANGLE.item.cropRatio;var b=TRIANGLE.item.objRef.getBoundingClientRect().width;var c=TRIANGLE.item.objRef.getBoundingClientRect().height;var d=Math.round(b/a);TRIANGLE.item.objRef.style.height=TRIANGLE.item.objRef.style.minHeight=d+"px"}else{TRIANGLE.item.objRef.style.height="auto";TRIANGLE.item.objRef.style.minHeight="auto"}TRIANGLE.item.image.width="100%";TRIANGLE.item.image.height="auto";TRIANGLE.selectionBorder.update();TRIANGLE.updateTemplateItems();TRIANGLE.importItem.single(TRIANGLE.item.index)}}};TRIANGLE.pages={loadPages:function loadPages(b,a){if(!b){b=""}var c="templateName="+encodeURIComponent(b)+"&listType="+a+"&instance="+TRIANGLE.instance+"&premade="+TRIANGLE.unsavedPremade;AJAX.get("php/page_list.php",c,function(e){if(a=="menu"){document.getElementById("echoPageList").innerHTML=e.responseText;var f=document.getElementById("echoPageList").querySelectorAll(".pageThumbnail");for(var d=0;d<f.length;d++){if(TRIANGLE.currentPage!==""&&f[d].innerHTML==TRIANGLE.currentPage){f[d].style.backgroundColor="#DAF0FD"}else{f[d].style.backgroundColor=""}}}else{document.getElementById("hyperlinkPage").innerHTML='<option value="default" selected="selected">- Select a page -</option>'+e.responseText}})},confirmDeletePage:function(a){document.getElementById("confirmDeletePage").innerHTML=a;document.getElementById("confirmDeletePageBtn").setAttribute("onClick","TRIANGLE.pages.deletePage('"+a+"');");TRIANGLE.popUp.open("deletePageCell")},deletePage:function(a){AJAX.get("php/delete_page.php","instance="+TRIANGLE.instance+"&page="+a,function(c){if(parseInt(c.responseText)){var d=document.getElementsByClassName("pageThumbnail");for(var b=0;b<d.length;b++){if(d[b].innerHTML===a){d[b].className+=" fadeOut";d[b].nextSibling.className+=" fadeOut";var e=d[b];setTimeout(function(){e.parentNode.removeChild(e.nextSibling);e.parentNode.removeChild(e)},200);break}}if(TRIANGLE.currentPage=a){TRIANGLE.loadTemplate.openURL(TRIANGLE.currentTemplate,"index")}TRIANGLE.popUp.close()}else{TRIANGLE.error("Error deleting page")}})}};TRIANGLE.library={load:function loadLibrary(){AJAX.get("php/library_list.php","",function(a){document.getElementById("echoLibrary").innerHTML=a.responseText})},loadUserIDs:function(){var a="instance="+TRIANGLE.instance;AJAX.get("php/user_id_list.php",a,function(b){document.getElementById("echoUserIDs").innerHTML=b.responseText})},loadUserClasses:function(){var a="instance="+TRIANGLE.instance;AJAX.get("php/user_class_list.php",a,function(b){document.getElementById("echoUserClasses").innerHTML=b.responseText})},insertTemplate:function(a){var b="instance="+TRIANGLE.instance+"&templateName="+a;AJAX.get("php/insert_premade_template.php",b,function(c){TRIANGLE.options.blankTemplate();var d=TRIANGLE.json.decompress(c.responseText);TRIANGLE.json.decode(d);TRIANGLE.library.loadUserIDs();TRIANGLE.updateTemplateItems();TRIANGLE.loadTemplate.updateUserIDs();TRIANGLE.colors.updateBodyBg();TRIANGLE.dragDrop.updateItemMap();TRIANGLE.currentTemplate=TRIANGLE.currentPage=false;setTimeout(TRIANGLE.updateTemplateItems,100)});TRIANGLE.updateTemplateItems()},insert:function insertLibraryItem(b,a){if(TRIANGLE.item&&TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){return}var c="category="+encodeURIComponent(b)+"&name="+encodeURIComponent(a);AJAX.get("php/insert_library_item.php",c,function(e){var d=e.responseText;if(!TRIANGLE.item){TRIANGLE.template().innerHTML+=d;window.scrollTo(0,document.body.scrollHeight)}else{TRIANGLE.checkPadding(TRIANGLE.item.objRef);TRIANGLE.item.objRef.innerHTML=d+TRIANGLE.item.objRef.innerHTML}TRIANGLE.library.convertStandbyItems();setTimeout(function(){if(TRIANGLE.item){TRIANGLE.importItem.single(TRIANGLE.item.index)}},50);TRIANGLE.updateTemplateItems(true)})},convertStandbyItems:function convertStandbyItems(){var a=TRIANGLE.template().getElementsByClassName("standby");for(var b=0;b<a.length;b++){var c=a[b].className;a[b].setAttribute("triangle-class",a[b].getAttribute("triangle-class").replace("standby","templateItem"))}},insertUserID:function(a){if(TRIANGLE.item&&TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){return}var b="instance="+TRIANGLE.instance+"&name="+a;AJAX.get("php/insert_user_id.php",b,function(c){var d=TRIANGLE.json.toHTML(c.responseText);var e=TRIANGLE.iframe().getElementByUserId(a);if(!TRIANGLE.item){TRIANGLE.template().innerHTML+=d;if(e){TRIANGLE.template().lastChild.removeAttribute("user-id")}window.scrollTo(0,document.body.scrollHeight)}else{TRIANGLE.checkPadding(TRIANGLE.item.objRef);TRIANGLE.item.objRef.innerHTML+=d;if(e){TRIANGLE.item.objRef.lastChild.removeAttribute("user-id")}}setTimeout(TRIANGLE.selectionBorder.update,50);TRIANGLE.updateTemplateItems(true)})},insertUserClass:function(a){if(TRIANGLE.item&&TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){return}var b="instance="+TRIANGLE.instance+"&name="+a;AJAX.get("php/insert_user_class.php",b,function(d){var e=JSON.parse(d.responseText);var c=document.createElement("div");c.setAttribute("user-class",a);c.style.cssText=e[a];c.setAttribute("triangle-class","templateItem");if(TRIANGLE.item){TRIANGLE.item.append(c);setTimeout(TRIANGLE.selectionBorder.update,50)}else{TRIANGLE.template().appendChild(c);window.scrollTo(0,document.body.scrollHeight)}TRIANGLE.updateTemplateItems(true)})},removeDuplicateUserIDs:function removeDuplicate(e){if(!(/\w+/g).test(e)){return e}var d=TRIANGLE.iframe().getElementByUserId(e);if(!d){var c=document.getElementById("echoUserIDs");for(var b=0;b<c.children.length;b++){d=c.children[b].innerHTML;if(e===d){break}else{d=false}}}if(d&&d!=TRIANGLE.item.objRef){var a="1";if(e.replace(/\D+/g,"")!==""&&(/\d+/g).test(e.replace(/\D+/g,""))){a=parseInt(e.replace(/\D+/g,""));a++}e=e.replace(/\d+/g,"")+a.toString();if(TRIANGLE.iframe().getElementByUserId(e)){removeDuplicate(e)}else{document.getElementById("userID").value=e}}return e},previewItem:function previewLibraryItem(b){TRIANGLE.updateTemplateItems();var d=document.getElementById("library"+b);TRIANGLE.effects.hover.transferStyles(d.children[0]);var e=window.open();e.document.write('<title>Preview Library Item</title><link rel="stylesheet" href="index-style.css" type="text/css" media="screen"><style>*{cursor:auto}.templateItem{cursor:auto}.textBox a{pointer-events:auto}'+document.getElementById("hoverData").innerHTML+"</style>"+d.innerHTML);e.document.body.style.backgroundColor=document.body.style.backgroundColor;var a=e.document.getElementsByClassName("templateItem");for(var c=0;c<a.length;c++){if(a[c].getAttribute("hover-style")){a[c].removeAttribute("style")}}}};TRIANGLE.developer={editor:ace.edit("ace-editor"),sessions:{css:null,hover:null,styleTag:null,scriptTag:null},codeEditor:{show:function(){document.getElementById("codeEditorWrapper").style.display="inline-block"},hide:function(){document.getElementById("codeEditorWrapper").style.display="none"},title:function(a){document.getElementById("currentCode").innerHTML=a}},editInnerHTML:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.innerHTML);if(TRIANGLE.item){TRIANGLE.importItem.importInnerHTML()}TRIANGLE.developer.codeEditor.title("HTML for Textbox");TRIANGLE.developer.codeEditor.show()},editHTML:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.outerHTML);if(TRIANGLE.item){TRIANGLE.importItem.importOuterHTML()}TRIANGLE.developer.codeEditor.title("HTML for Current Item");TRIANGLE.developer.codeEditor.show()},editCSS:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.css);if(TRIANGLE.item){TRIANGLE.importItem.importCSSText()}TRIANGLE.developer.codeEditor.title("CSS for Current Item");TRIANGLE.developer.codeEditor.show()},editHover:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.hover);if(TRIANGLE.item){TRIANGLE.importItem.importHoverCSSText()}TRIANGLE.developer.codeEditor.title(":Hover CSS for Current Item");TRIANGLE.developer.codeEditor.show()},editStyleTag:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.styleTag);TRIANGLE.developer.codeEditor.title("CSS for Current Page");TRIANGLE.developer.codeEditor.show()},editGlobalStyleTag:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.globalStyleTag);TRIANGLE.developer.codeEditor.title("CSS for All Pages");TRIANGLE.developer.codeEditor.show()},editScriptTag:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.scriptTag);TRIANGLE.developer.codeEditor.title("JavaScript for Current Page");TRIANGLE.developer.codeEditor.show()},editGlobalScriptTag:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.globalScriptTag);TRIANGLE.developer.codeEditor.title("JavaScript for All Pages");TRIANGLE.developer.codeEditor.show()},editCodeSnippet:function(){TRIANGLE.developer.editor.setSession(TRIANGLE.developer.sessions.codeSnippet);if(TRIANGLE.item){TRIANGLE.importItem.importCodeSnippet()}TRIANGLE.developer.codeEditor.title("Code in Current Item");TRIANGLE.developer.codeEditor.show()},saveEdits:null,currentCode:null,editCode:function(d,b){TRIANGLE.developer.currentCode=d;var a=document.getElementById(d);var c=document.getElementById("codeEditor");document.getElementById("currentCode").innerHTML=b;c.value=a.value;TRIANGLE.developer.codeEditor.show();TRIANGLE.developer.saveEdits=function(){document.getElementById(d).value=c.value;document.getElementById(d).onchange()};TRIANGLE.selectionBorder.update()},insertSnippet:function(){var b=document.getElementById("snippetInsertion").value;if(b&&(/[^\s]+/g).test(b)){if(TRIANGLE.item&&!TRIANGLE.isType.bannedInsertion(TRIANGLE.item.objRef)){var a=document.createElement("div");a.setAttribute("triangle-class","templateItem childItem snippetItem");a.style.backgroundColor="inherit";a.style.minHeight="1px";a.style.height="auto";a.innerHTML=b;TRIANGLE.item.append(a);TRIANGLE.selectionBorder.update();TRIANGLE.updateTemplateItems(true)}else{if(TRIANGLE.item){TRIANGLE.item.objRef.innerHTML=b}else{var a=document.createElement("div");a.setAttribute("triangle-class","templateItem childItem snippetItem");a.style.backgroundColor="inherit";a.style.minHeight="1px";a.style.height="auto";a.innerHTML=b;TRIANGLE.template().appendChild(a);TRIANGLE.selectionBorder.update();TRIANGLE.updateTemplateItems(true)}}}},exitCodeEditor:function(){document.getElementById("codeEditorWrapper").style.display="none";TRIANGLE.developer.saveEdits=null;TRIANGLE.developer.currentCode=null;TRIANGLE.selectionBorder.update()},styleTagContent:"",saveStyleTag:function(){TRIANGLE.developer.styleTagContent=TRIANGLE.developer.sessions.styleTag.getValue()},globalStyleTagContent:"",saveGlobalStyleTag:function(){TRIANGLE.developer.globalStyleTagContent=TRIANGLE.developer.sessions.globalStyleTag.getValue()},scriptTagContent:"",saveScriptTag:function(){TRIANGLE.developer.scriptTagContent=TRIANGLE.developer.sessions.scriptTag.getValue()},globalScriptTagContent:"",saveGlobalScriptTag:function(){TRIANGLE.developer.globalScriptTagContent=TRIANGLE.developer.sessions.globalScriptTag.getValue()},saveCodeSnippet:function(){if(TRIANGLE.item){}}};TRIANGLE.dragDrop={eatClick:null,draggingElem:null,draggingCopy:null,active:false,applyDrag:function applyDrag(a){TRIANGLE.dragDrop.eatClick=setTimeout(TRIANGLE.dragDrop.start,200)},start:function startDragging(a){if(TRIANGLE.item.objRef.isContentEditable||TRIANGLE.item.tag==="BUTTON"||TRIANGLE.isType.formField(TRIANGLE.item.objRef)){return}TRIANGLE.dragDrop.active=true;TRIANGLE.dragDrop.draggingElem=TRIANGLE.item.objRef;TRIANGLE.dragDrop.draggingElem.style.opacity="0.5";TRIANGLE.dragDrop.draggingCopy=TRIANGLE.dragDrop.draggingElem.cloneNode(true);var b=TRIANGLE.dragDrop.draggingElem.getBoundingClientRect();TRIANGLE.dragDrop.draggingCopy.style.width=b.width+"px";TRIANGLE.dragDrop.draggingCopy.style.height=TRIANGLE.dragDrop.draggingCopy.style.minHeight=b.height+"px";TRIANGLE.dragDrop.draggingCopy.style.position="fixed";TRIANGLE.dragDrop.draggingCopy.style.opacity="0.7";TRIANGLE.dragDrop.draggingCopy.style.zIndex="2";TRIANGLE.dragDrop.draggingCopy.style.visibility="hidden";TRIANGLE.dragDrop.draggingCopy.style.pointerEvents="none";TRIANGLE.dragDrop.draggingCopy.style.transform="scale(0.5,0.5)";TRIANGLE.dragDrop.draggingCopy.id="draggingCopy";TRIANGLE.dragDrop.draggingCopy.className="draggingCopy";document.body.appendChild(TRIANGLE.dragDrop.draggingCopy);document.addEventListener("mousemove",TRIANGLE.dragDrop.updatePosition);document.addEventListener("mousemove",TRIANGLE.dragDrop.dragVis);TRIANGLE.text.preventTextSelect()},updatePosition:function updateDragPos(a){if(TRIANGLE.dragDrop.draggingCopy.style.visibility=="hidden"){TRIANGLE.dragDrop.draggingCopy.style.visibility="visible"}TRIANGLE.dragDrop.draggingCopy.style.top=(a.clientY-TRIANGLE.dragDrop.draggingCopy.getBoundingClientRect().height)+"px";TRIANGLE.dragDrop.draggingCopy.style.left=(a.clientX-TRIANGLE.dragDrop.draggingCopy.getBoundingClientRect().width)+"px"},stop:function stopDragging(b){var a=TRIANGLE.item;clearTimeout(TRIANGLE.dragDrop.eatClick);if(TRIANGLE.dragDrop.active){TRIANGLE.dragDrop.draggingElem.style.opacity="";if(TRIANGLE.dragDrop.draggingCopy){document.body.removeChild(TRIANGLE.dragDrop.draggingCopy)}if(document.getElementById("draggingCopy")){document.body.removeChild("draggingCopy")}if(TRIANGLE.hoveredElem!==TRIANGLE.dragDrop.draggingElem&&TRIANGLE.hoveredElem!==TRIANGLE.dragDrop.draggingElem.parentNode){var d=TRIANGLE.item.objRef.cloneNode(true);if(document.getElementById("visBox")){TRIANGLE.dragDrop.draggingElem.remove();if(document.getElementById("visBox").style.cssFloat){d.style.cssFloat=document.getElementById("visBox").style.cssFloat;d.setAttribute("item-align",d.style.cssFloat)}var c=document.getElementById("visBox").parentNode;if(c.getAttribute("id")!=="template"){TRIANGLE.checkPadding(c)}c.insertBefore(d,document.getElementById("visBox"));TRIANGLE.dragDrop.removeVisBox()}else{if(TRIANGLE.hoveredElem&&!TRIANGLE.isType.bannedInsertion(TRIANGLE.hoveredElem)){TRIANGLE.checkPadding(TRIANGLE.hoveredElem);TRIANGLE.hoveredElem.appendChild(d);TRIANGLE.dragDrop.draggingElem.remove()}}TRIANGLE.clearSelection();TRIANGLE.updateTemplateItems();TRIANGLE.text.clearTextSelection()}else{if(TRIANGLE.hoveredElem==TRIANGLE.dragDrop.draggingElem.parentNode&&document.getElementById("visBox")){var d=a.objRef.cloneNode(true);TRIANGLE.dragDrop.draggingElem.remove();if(document.getElementById("visBox").style.cssFloat){d.style.cssFloat=document.getElementById("visBox").style.cssFloat;d.setAttribute("item-align",d.style.cssFloat)}document.getElementById("visBox").parentNode.insertBefore(d,document.getElementById("visBox"));TRIANGLE.dragDrop.removeVisBox()}}}TRIANGLE.dragDrop.active=false;TRIANGLE.dragDrop.draggingElem=false;TRIANGLE.updateTemplateItems(true);document.removeEventListener("mousemove",TRIANGLE.dragDrop.updatePosition);document.removeEventListener("mousemove",TRIANGLE.dragDrop.dragVis);TRIANGLE.text.allowTextSelect();TRIANGLE.updateTemplateItems()},itemMap:{left:[],right:[],top:[],bottom:[],height:[],width:[],minY:[],maxY:[],minX:[],maxX:[],},updateItemMap:function updateItemMap(){for(var a=0;a<TRIANGLE.templateItems.length;a++){var c=TRIANGLE.templateItems[a].getBoundingClientRect();TRIANGLE.dragDrop.itemMap.left[a]=c.left;TRIANGLE.dragDrop.itemMap.right[a]=c.right;TRIANGLE.dragDrop.itemMap.top[a]=c.top;TRIANGLE.dragDrop.itemMap.bottom[a]=c.bottom;TRIANGLE.dragDrop.itemMap.height[a]=c.height;TRIANGLE.dragDrop.itemMap.width[a]=c.width;var b=(c.height/3);TRIANGLE.dragDrop.itemMap.minY[a]=c.top+b;TRIANGLE.dragDrop.itemMap.maxY[a]=c.bottom-b;TRIANGLE.dragDrop.itemMap.minX[a]=c.left+b;TRIANGLE.dragDrop.itemMap.maxX[a]=c.right-b}},prevHoverElem:null,dragVis:function dragVis(b){if(TRIANGLE.hoveredElem){var j=parseInt(TRIANGLE.hoveredElem.getAttribute("triangle-index"));if(TRIANGLE.hoveredElem.parentNode.id!="template"){var g=parseInt(TRIANGLE.hoveredElem.parentNode.getAttribute("triangle-index"))}var i=undefined;if(TRIANGLE.hoveredElem.nextSibling&&TRIANGLE.isType.templateItem(TRIANGLE.hoveredElem.nextSibling)){i=parseInt(TRIANGLE.hoveredElem.nextSibling.getAttribute("triangle-index"))}var f=undefined;if(TRIANGLE.hoveredElem.previousSibling&&TRIANGLE.isType.templateItem(TRIANGLE.hoveredElem.previousSibling)){f=parseInt(TRIANGLE.hoveredElem.previousSibling.getAttribute("triangle-index"))}var d=undefined;if(TRIANGLE.hoveredElem.children[0]&&TRIANGLE.hoveredElem.children[0].getAttribute("triangle-index")){d=parseInt(TRIANGLE.hoveredElem.children[0].getAttribute("triangle-index"))}var h=undefined;if(TRIANGLE.hoveredElem.children[0]&&TRIANGLE.isType.templateItem(TRIANGLE.hoveredElem.lastChild)){h=parseInt(TRIANGLE.hoveredElem.lastChild.getAttribute("triangle-index"))}}if(TRIANGLE.dragDrop.draggingElem){var e=parseInt(TRIANGLE.dragDrop.draggingElem.getAttribute("triangle-index"))}if(TRIANGLE.hoveredElem===TRIANGLE.dragDrop.draggingElem){return}var k=TRIANGLE.template();var a=TRIANGLE.templateItems.length-1;if(c(e).indexOf(parseInt(j))>-1){return}if(b.clientY<TRIANGLE.dragDrop.itemMap.top[0]&&e!=0){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.templateItems[0]);console.log("Drag and drop: before all")}else{if(b.clientY>TRIANGLE.dragDrop.itemMap.bottom[a]&&e!=a){TRIANGLE.dragDrop.createVisBox("inside",k);console.log("Drag and drop: after all")}else{if(d&&b.clientY>=TRIANGLE.dragDrop.itemMap.top[j]&&b.clientY<=TRIANGLE.dragDrop.itemMap.minY[d]&&e!=d){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.hoveredElem.children[0]);console.log("Drag and drop: first child")}else{if(b.clientY<=TRIANGLE.dragDrop.itemMap.minY[j]&&b.clientY>=TRIANGLE.dragDrop.itemMap.maxY[f]&&e!=j){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.hoveredElem);console.log("Drag and drop: before hovered, after previous row")}else{if(b.clientY>=TRIANGLE.dragDrop.itemMap.maxY[j]&&b.clientY<=TRIANGLE.dragDrop.itemMap.bottom[g]&&e!=h){TRIANGLE.dragDrop.createVisBox("after",TRIANGLE.hoveredElem);console.log("Drag and drop: last child")}else{if(b.clientY<TRIANGLE.dragDrop.itemMap.maxY[j]&&b.clientY>TRIANGLE.dragDrop.itemMap.minY[j]){if(e===j){TRIANGLE.dragDrop.removeVisBox();return}else{if(TRIANGLE.hoveredElem.children.length===1&&TRIANGLE.hoveredElem.children[0].getAttribute("triangle-index")==e){TRIANGLE.dragDrop.removeVisBox();return}}if(b.clientX<TRIANGLE.dragDrop.itemMap.maxX[j]&&b.clientX>TRIANGLE.dragDrop.itemMap.minX[j]){console.log("inside");TRIANGLE.dragDrop.createVisBox("inside",TRIANGLE.hoveredElem)}else{if(j-1<0&&b.clientX<TRIANGLE.dragDrop.itemMap.minX[j]+5){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.hoveredElem)}else{if(b.clientX>TRIANGLE.dragDrop.itemMap.right[j-1]&&b.clientX<=TRIANGLE.dragDrop.itemMap.minX[j]&&TRIANGLE.hoveredElem.style.cssFloat!="right"){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.hoveredElem)}else{if(b.clientX<=TRIANGLE.dragDrop.itemMap.minX[j]&&TRIANGLE.hoveredElem.style.cssFloat!="right"){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.hoveredElem)}else{if(b.clientX<TRIANGLE.dragDrop.itemMap.left[j-1]&&b.clientX>=TRIANGLE.dragDrop.itemMap.maxX[j]&&TRIANGLE.hoveredElem.style.cssFloat==="right"){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.hoveredElem)}else{if(b.clientX>=TRIANGLE.dragDrop.itemMap.maxX[j]&&TRIANGLE.hoveredElem.style.cssFloat==="right"){TRIANGLE.dragDrop.createVisBox("before",TRIANGLE.hoveredElem)}else{TRIANGLE.dragDrop.createVisBox("inside",TRIANGLE.hoveredElem)}}}}}}}}}}}}function c(l){var p=[];var o=TRIANGLE.iframe().getTriangleIndex(l);var n=o.querySelectorAll(".templateItem");for(var m=0;m<n.length;m++){p[m]=parseInt(n[m].getAttribute("triangle-index"))}return p}},createVisBox:function createVisBox(e,j,b){TRIANGLE.dragDrop.removeVisBox();if(!document.getElementById("visBox")&&j&&j.parentNode){var i=document.createElement("div");var g=TRIANGLE.dragDrop.draggingElem.getBoundingClientRect();i.style.height=g.height+"px";i.style.width=TRIANGLE.dragDrop.draggingElem.style.width;if(TRIANGLE.dragDrop.draggingElem.style.marginLeft==="auto"){i.style.marginLeft="auto"}if(TRIANGLE.dragDrop.draggingElem.style.marginRight==="auto"){i.style.marginRight="auto"}var f=false;var c=document.createElement("div");c.setAttribute("id","clearVisFloatBefore");var h=document.createElement("div");h.setAttribute("id","clearVisFloatAfter");if(TRIANGLE.dragDrop.draggingElem.style.cssFloat==="left"){i.style.cssFloat="left";f=true}else{if(TRIANGLE.dragDrop.draggingElem.style.cssFloat==="right"){i.style.cssFloat="right";f=true}}i.setAttribute("id","visBox");i.addEventListener("mouseover",TRIANGLE.dragDrop.maintainVisBox);i.addEventListener("mouseout",TRIANGLE.dragDrop.removeVisBox);var l=document.createElement("div");l.setAttribute("id","visBoxInner");i.appendChild(l);var k=document.createElement("div");if(e==="before"||!e){j.parentNode.insertBefore(i,j);if(f&&!j.style.cssFloat){j.parentNode.insertBefore(c,j)}}else{if(e==="after"){if(j.nextSibling){j.parentNode.insertBefore(i,j.nextSibling);if(f&&!i.nextSibling.style.cssFloat){j.parentNode.insertBefore(c,j.nextSibling.nextSibling)}}else{j.parentNode.appendChild(i);if(f){i.parentNode.appendChild(h)}}}else{if(e==="inside"&&!TRIANGLE.isType.bannedInsertion(j)){j.appendChild(i);if(f){i.parentNode.appendChild(h)}}}}if(!f){var a=i.nextSibling;var d=i.previousSibling;if(a){i.parentNode.insertBefore(h,a)}else{i.parentNode.appendChild(h)}if(d){i.parentNode.insertBefore(c,i)}}}TRIANGLE.dragDrop.updateItemMap();TRIANGLE.selectionBorder.remove();TRIANGLE.hoverBorder.hide();TRIANGLE.dragDrop.prevHoverElem=TRIANGLE.hoveredElem},removeVisBox:function removeVisBox(){if(document.getElementById("visBox")){document.getElementById("visBox").removeEventListener("mouseover",TRIANGLE.dragDrop.maintainVisBox);document.getElementById("visBox").removeEventListener("mouseout",TRIANGLE.dragDrop.removeVisBox);if(document.getElementById("clearVisFloat")){document.getElementById("clearVisFloat").remove()}if(document.getElementById("clearVisFloatBefore")){document.getElementById("clearVisFloatBefore").remove()}if(document.getElementById("clearVisFloatAfter")){document.getElementById("clearVisFloatAfter").remove()}document.getElementById("visBox").remove();TRIANGLE.dragDrop.updateItemMap();TRIANGLE.selectionBorder.remove()}},maintainVisBox:function maintainVisBox(a){TRIANGLE.hoveredElem=TRIANGLE.dragDrop.prevHoverElem}};TRIANGLE.generateBorder=function generateBorder(c){var b=6;var d=document.createElement("div");d.id="showHoverBorder";d.style.height=c.height+b+"px";d.style.width=c.width+b+"px";d.style.top=c.top-(b/2)+TRIANGLE.iframe().getBoundingClientRect().top+"px";d.style.left=c.left-(b/2)+TRIANGLE.iframe().getBoundingClientRect().left+"px";var a=document.createElement("div");a.id="noClickThru";d.appendChild(a);return d};TRIANGLE.hoveredElem=false;TRIANGLE.hoverBorder={show:function showHoverBorder(d){if(TRIANGLE.resize.active||TRIANGLE.saveItem.animationActive||TRIANGLE.images.crop.active){return}TRIANGLE.hoverBorder.hide();var c=this.getBoundingClientRect();document.getElementById("selectionBorderContainer").appendChild(TRIANGLE.generateBorder(c));TRIANGLE.hoveredElem=this;var b=TRIANGLE.isType.itemLabel(this);var a=this.getAttribute("user-id");var f=this.getAttribute("user-class");var e=this.getAttribute("href")||this.getAttribute("link-to");if(b){TRIANGLE.iframe().contentDocument.addEventListener("mousemove",TRIANGLE.tooltip.update);TRIANGLE.tooltip.show(b)}else{if(a){TRIANGLE.iframe().contentDocument.addEventListener("mousemove",TRIANGLE.tooltip.update);TRIANGLE.tooltip.show("#"+a)}else{if(f){TRIANGLE.iframe().contentDocument.addEventListener("mousemove",TRIANGLE.tooltip.update);TRIANGLE.tooltip.show("."+f)}else{if(e){TRIANGLE.iframe().contentDocument.addEventListener("mousemove",TRIANGLE.tooltip.update);if(e.length>30){e=e.slice(0,30)+"..."}TRIANGLE.tooltip.show("Link: "+e)}else{TRIANGLE.iframe().contentDocument.removeEventListener("mousemove",TRIANGLE.tooltip.update);TRIANGLE.tooltip.hide()}}}}},hide:function hideHoverBorder(){if(document.getElementById("showHoverBorder")){document.getElementById("selectionBorderContainer").removeChild(document.getElementById("showHoverBorder"));TRIANGLE.hoveredElem=false;TRIANGLE.tooltip.hide();TRIANGLE.iframe().contentDocument.removeEventListener("mousemove",TRIANGLE.tooltip.update)}}};TRIANGLE.selectionBorder={create:function createSelectionBorder(){var a;if(TRIANGLE.item){TRIANGLE.hoverBorder.hide();TRIANGLE.selectionBorder.remove();var b=TRIANGLE.item.objRef.getBoundingClientRect();document.getElementById("selectionBorderContainer").appendChild(TRIANGLE.generateBorder(b));document.getElementById("showHoverBorder").id="selectionBorder";a=document.getElementById("selectionBorder");if(TRIANGLE.item.objRef.isContentEditable){a.style.border="1px dashed black"}a.style.zIndex=2;TRIANGLE.resize.showHandles();TRIANGLE.selectedItemOptions.show()}else{if(document.getElementById("showHoverBorder")){document.getElementById("showHoverBorder").id="selectionBorder";a=document.getElementById("selectionBorder");TRIANGLE.resize.showHandles()}}TRIANGLE.unsaved=true},remove:function removeSelectionBorder(){if(document.getElementById("selectionBorder")){document.getElementById("selectionBorderContainer").removeChild(document.getElementById("selectionBorder"));TRIANGLE.resize.removeHandles();TRIANGLE.selectedItemOptions.hide()}},update:function updateSelectionBorder(){if(document.getElementById("selectionBorder")){TRIANGLE.selectionBorder.remove();TRIANGLE.selectionBorder.create()}}};TRIANGLE.selectedItemOptions={show:function(){if(TRIANGLE.item){var a=document.getElementById("selectedItemOptionsBar");a.style.display="initial";var b=TRIANGLE.item.objRef.getBoundingClientRect();a.style.top=b.bottom+20+TRIANGLE.iframe().getBoundingClientRect().top+"px";a.style.left=b.left+(b.width/2-a.getBoundingClientRect().width/2)+TRIANGLE.iframe().getBoundingClientRect().left+"px"}},hide:function(){document.getElementById("selectedItemOptionsBar").style.display="none"},update:function(){TRIANGLE.selectedItemOptions.hide();TRIANGLE.selectedItemOptions.show()}};TRIANGLE.resize={showHandles:function showResizeHandles(){if(TRIANGLE.item.display!=="table-cell"&&!TRIANGLE.item.objRef.isContentEditable){var l=8;var j=8;var e=TRIANGLE.scrollbarWidth+10;var n=TRIANGLE.item.objRef.getBoundingClientRect();var b=TRIANGLE.iframe().getBoundingClientRect();var i=document.getElementById("selectionBorder");var d="resizeHandle";var q="marginHandle";var c=TRIANGLE.isType.imageItem(TRIANGLE.item.objRef);var h=document.createElement("div");h.style.cursor="row-resize";h.className=q;h.style.top=n.top-j/2-2+b.top+"px";h.style.left=n.left+(n.width/2-l/2)+b.left+"px";i.appendChild(h);h.addEventListener("mouseover",TRIANGLE.resize.margin.top);h.addEventListener("mousedown",TRIANGLE.resize.margin.initiate);if(!c){var a=document.createElement("div");a.style.cursor="s-resize";a.className=d;a.style.top=n.bottom-2+b.top+"px";a.style.left=n.left+(n.width/2-l/2)+b.left+"px";i.appendChild(a);a.addEventListener("mouseover",TRIANGLE.resize.Y);a.addEventListener("mousedown",TRIANGLE.resize.initiate)}else{if(TRIANGLE.item.align!="right"){var f=document.createElement("div");f.style.cursor="ne-resize";f.className=d;f.style.top=n.top-j+2+b.top+"px";if(n.right>=window.innerWidth-e){f.style.left=window.innerWidth-e-l+b.left+"px"}else{f.style.left=n.right-2+b.left+"px"}i.appendChild(f);f.addEventListener("mouseover",TRIANGLE.resize.XY);f.addEventListener("mousedown",TRIANGLE.resize.initiate);var m=document.createElement("div");m.style.cursor="se-resize";m.className=d;m.style.top=n.bottom-2+b.top+"px";if(n.right>=window.innerWidth-e){m.style.left=window.innerWidth-e-l+b.left+"px"}else{m.style.left=n.right-2+b.left+"px"}i.appendChild(m);m.addEventListener("mouseover",TRIANGLE.resize.XY);m.addEventListener("mousedown",TRIANGLE.resize.initiate)}else{var p=document.createElement("div");p.style.cursor="nw-resize";p.className=d;p.style.top=n.top-j+2+b.top+"px";if(n.left<=0){p.style.left=5+b.left+"px"}else{p.style.left=n.left-l/2-2+b.left+"px"}i.appendChild(p);p.addEventListener("mouseover",TRIANGLE.resize.XY);p.addEventListener("mousedown",TRIANGLE.resize.initiate);var o=document.createElement("div");o.style.cursor="sw-resize";o.className=d;o.style.top=n.bottom-2+b.top+"px";if(n.left<=0){o.style.left=5+b.left+"px"}else{o.style.left=n.left-l/2-2+b.left+"px"}i.appendChild(o);o.addEventListener("mouseover",TRIANGLE.resize.XY);o.addEventListener("mousedown",TRIANGLE.resize.initiate)}}if(TRIANGLE.item.align!=="right"){var k=document.createElement("div");k.style.cursor="e-resize";k.className=d;k.style.top=n.top+(n.height/2-j/2)+b.top+"px";if(n.right>=window.innerWidth-e){k.style.left=window.innerWidth-e-l+b.left+"px"}else{k.style.left=n.right-2+b.left+"px"}i.appendChild(k);c?k.addEventListener("mouseover",TRIANGLE.resize.XY):k.addEventListener("mouseover",TRIANGLE.resize.X);k.addEventListener("mousedown",TRIANGLE.resize.initiate);var g=document.createElement("div");g.style.cursor="col-resize";g.className=q;g.style.top=n.top+(n.height/2-j/2)+b.top+"px";if(n.left<=0){g.style.left=5+b.left+"px"}else{g.style.left=n.left-l/2-2+b.left+"px"}i.appendChild(g);g.addEventListener("mouseover",TRIANGLE.resize.margin.left);g.addEventListener("mousedown",TRIANGLE.resize.margin.initiate)}else{var g=document.createElement("div");g.style.cursor="e-resize";g.className=d;g.style.top=n.top+(n.height/2-j/2)+b.top+"px";if(n.left<=0){g.style.left=5+b.left+"px"}else{g.style.left=n.left-l/2-2+b.left+"px"}i.appendChild(g);c?g.addEventListener("mouseover",TRIANGLE.resize.XY):g.addEventListener("mouseover",TRIANGLE.resize.X);g.addEventListener("mousedown",TRIANGLE.resize.initiate);var k=document.createElement("div");k.style.cursor="col-resize";k.className=q;k.style.top=n.top+(n.height/2-j/2)+b.top+"px";if(n.right>=window.innerWidth-e){k.style.left=window.innerWidth-e-l+b.left+"px"}else{k.style.left=n.right-2+b.left+"px"}i.appendChild(k);k.addEventListener("mouseover",TRIANGLE.resize.margin.right);k.addEventListener("mousedown",TRIANGLE.resize.margin.initiate)}}},activeElem:-1,active:false,direction:"X or Y or XY",XYratio:null,contentWidth:null,X:function resizeX(){if(!TRIANGLE.resize.active){TRIANGLE.resize.activeElem=TRIANGLE.item.index;TRIANGLE.resize.direction="X"}},Y:function resizeY(){if(!TRIANGLE.resize.active){TRIANGLE.resize.activeElem=TRIANGLE.item.index;TRIANGLE.resize.direction="Y"}},XY:function(){if(!TRIANGLE.resize.active){TRIANGLE.resize.activeElem=TRIANGLE.item.index;TRIANGLE.resize.direction="XY";var a=TRIANGLE.item.objRef.getBoundingClientRect();TRIANGLE.resize.XYratio=a.width/a.height}},initiate:function initiateResize(a){TRIANGLE.resize.active=true;TRIANGLE.selectItem(TRIANGLE.resize.activeElem);document.body.addEventListener("mouseup",TRIANGLE.resize.stop);TRIANGLE.iframe().contentDocument.body.addEventListener("mouseup",TRIANGLE.resize.stop);TRIANGLE.iframe().contentDocument.body.addEventListener("mousemove",TRIANGLE.resize.start);TRIANGLE.item.objRef.style.maxWidth="100%";document.getElementById("dimensionLabels").style.display="inline-block";document.getElementById("widthLabel").innerHTML="W: "+TRIANGLE.itemStyles.width;document.getElementById("heightLabel").innerHTML="H: "+TRIANGLE.itemStyles.minHeight;TRIANGLE.resize.contentWidth=TRIANGLE.contentWidth(TRIANGLE.item.parent);TRIANGLE.text.preventTextSelect()},stop:function removeResize(){TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.resize.activeElem=-1;TRIANGLE.resize.active=false;TRIANGLE.resize.direction=false;TRIANGLE.resize.contentWidth=null;TRIANGLE.iframe().getElementById("bottomMarker").style.marginTop=0;if(!TRIANGLE.isType.imageItem(TRIANGLE.item.objRef)){TRIANGLE.item.objRef.style.maxWidth=""}if(TRIANGLE.getUnit(TRIANGLE.itemStyles.width)==="%"&&parseFloat(TRIANGLE.itemStyles.width)>100){TRIANGLE.item.objRef.style.width="100%";TRIANGLE.updateTemplateItems();TRIANGLE.importItem.single(TRIANGLE.item.index)}else{if(TRIANGLE.getUnit(TRIANGLE.itemStyles.width)!=="%"&&parseFloat(TRIANGLE.itemStyles.width)>TRIANGLE.item.parent.getBoundingClientRect().width){TRIANGLE.item.objRef.style.width="100%";TRIANGLE.updateTemplateItems();TRIANGLE.importItem.single(TRIANGLE.item.index)}}TRIANGLE.item.objRef.style.width=document.getElementById("widthLabel").innerHTML.replace(/W: /g,"");document.body.removeEventListener("mouseup",TRIANGLE.resize.stop);TRIANGLE.iframe().contentDocument.body.removeEventListener("mouseup",TRIANGLE.resize.stop);TRIANGLE.iframe().contentDocument.body.removeEventListener("mousemove",TRIANGLE.resize.start);TRIANGLE.selectionBorder.create();TRIANGLE.text.clearTextSelection();TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass);TRIANGLE.text.allowTextSelect();TRIANGLE.tooltip.hide()},start:function resizeItem(p){TRIANGLE.locateColumns();var t=TRIANGLE.item;if(TRIANGLE.resize.active){var h=p.clientX;var g=p.clientY;var c=TRIANGLE.item.objRef.getBoundingClientRect();var s=TRIANGLE.item.parent.getBoundingClientRect();var f=TRIANGLE.iframe().getBoundingClientRect();var a=2;var k=document.getElementById("widthLabel");var j=document.getElementById("heightLabel");var m=p.shiftKey?30:3;if(TRIANGLE.resize.direction==="X"){if(t.align!=="right"&&h>(c.left+a)){r();var l=TRIANGLE.item.nextSibling()?TRIANGLE.item.nextSibling().getBoundingClientRect():null;var b=TRIANGLE.item.prevSibling()?TRIANGLE.item.prevSibling().getBoundingClientRect():null;if(l&&h>=l.left-3&&h<=l.left+3){h=l.left}if(TRIANGLE.getUnit(TRIANGLE.itemStyles.width)==="%"){if(h<=c.left+(TRIANGLE.resize.contentWidth/2)+m&&h>=c.left+(TRIANGLE.resize.contentWidth/2)-m){t.objRef.style.width="50%"}else{if(h<=c.left+(TRIANGLE.resize.contentWidth/3)+m&&h>=c.left+(TRIANGLE.resize.contentWidth/3)-m){t.objRef.style.width="33.33%"}else{if(h<=c.left+(2*TRIANGLE.resize.contentWidth/3)+m&&h>=c.left+(2*TRIANGLE.resize.contentWidth/3)-m){t.objRef.style.width="66.66%"}else{t.objRef.style.width=Math.ceil(((h-c.left)/TRIANGLE.resize.contentWidth)*10000)/100+"%"}}}if(parseFloat(t.objRef.style.width)>100){k.innerHTML="W: 100%"}else{k.innerHTML="W: "+t.objRef.style.width}}else{if(parseFloat(t.objRef.style.width)>s.width){t.objRef.style.width=Math.floor(h-c.left)+"px";k.innerHTML="W: 100%"}else{t.objRef.style.width=Math.floor(h-c.left)+"px";k.innerHTML="W: "+t.objRef.style.width}}}else{if(t.align==="right"&&h<(c.right-a)){r();var l=TRIANGLE.item.nextSibling()?TRIANGLE.item.nextSibling().getBoundingClientRect():null;var b=TRIANGLE.item.prevSibling()?TRIANGLE.item.prevSibling().getBoundingClientRect():null;if(b&&h<=b.right+3&&h>=b.right-3){h=b.right}else{for(var q=0;q<TRIANGLE.templateItems.length;q++){if(h<=TRIANGLE.columnMap.right[q]+3&&h>=TRIANGLE.columnMap.right[q]-3){h=TRIANGLE.columnMap.right[q]}}}if(TRIANGLE.getUnit(TRIANGLE.itemStyles.width)==="%"){if(h<=c.right-(TRIANGLE.resize.contentWidth/2)+m&&h>=c.right-(TRIANGLE.resize.contentWidth/2)-m){t.objRef.style.width="50%"}else{if(h<=c.right-(TRIANGLE.resize.contentWidth/3)+m&&h>=c.right-(TRIANGLE.resize.contentWidth/3)-m){t.objRef.style.width="33.33%"}else{if(h<=c.right-(2*TRIANGLE.resize.contentWidth/3)+m&&h>=c.right-(2*TRIANGLE.resize.contentWidth/3)-m){t.objRef.style.width="66.66%"}else{t.objRef.style.width=Math.ceil(((c.right-h)/TRIANGLE.resize.contentWidth)*10000)/100+"%"}}}if(parseFloat(t.objRef.style.width)>100){k.innerHTML="W: 100%"}else{k.innerHTML="W: "+t.objRef.style.width}}else{if(parseFloat(t.objRef.style.width)>s.width){t.objRef.style.width=Math.floor(c.right-h)+"px";k.innerHTML="W: 100%"}else{t.objRef.style.width=Math.floor(c.right-h)+"px";k.innerHTML="W: "+t.objRef.style.width}}}else{return}}TRIANGLE.selectionBorder.update();TRIANGLE.tooltip.update(p);TRIANGLE.tooltip.show(k.innerHTML)}else{if(TRIANGLE.resize.direction==="Y"){if(g>(c.top+a)){t.objRef.style.minHeight=Math.floor(g-c.top)+"px";if(TRIANGLE.isType.imageItem(TRIANGLE.item.objRef)){t.objRef.style.height=t.objRef.style.minHeight}if(t.transform||t.display=="table"){t.objRef.style.height=t.objRef.style.minHeight}if(t.isLastChild){TRIANGLE.iframe().getElementById("bottomMarker").style.marginTop=window.innerHeight+"px"}e()}else{return}TRIANGLE.selectionBorder.update();j.innerHTML="H: "+t.objRef.style.minHeight;TRIANGLE.selectionBorder.update();TRIANGLE.tooltip.update(p);TRIANGLE.tooltip.show(j.innerHTML)}else{if(TRIANGLE.resize.direction==="XY"){if(TRIANGLE.item.align!=="right"){if(h>c.left+a){var o=r();var d=Math.round(h-c.left);if(d>TRIANGLE.resize.contentWidth){return}t.objRef.style.width=d+"px";t.objRef.style.minHeight=Math.round(d/TRIANGLE.resize.XYratio)+"px";t.objRef.style.height=t.objRef.style.minHeight;var n=e();if(o||n){TRIANGLE.selectionBorder.update();return}}}else{if(h<c.right-a){var o=r();var d=Math.round(c.right-h);if(d>TRIANGLE.resize.contentWidth){return}t.objRef.style.width=d+"px";t.objRef.style.minHeight=Math.round(d/TRIANGLE.resize.XYratio)+"px";t.objRef.style.height=t.objRef.style.minHeight;var n=e();if(o||n()){TRIANGLE.selectionBorder.update();return}}}k.innerHTML="W: "+t.objRef.style.width;j.innerHTML="H: "+t.objRef.style.minHeight}}}TRIANGLE.selectionBorder.create();TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass)}TRIANGLE.text.clearTextSelection();function r(){var w=false;var u=TRIANGLE.templateItems.length;for(var v=0;v<u;v++){if(TRIANGLE.item.isAbove(v)||TRIANGLE.item.isBelow(v)){if(h>=TRIANGLE.columnMap.left[v]-3&&h<=TRIANGLE.columnMap.left[v]+3){h=TRIANGLE.columnMap.left[v];w=true}else{if(h>=TRIANGLE.columnMap.right[v]-3&&h<=TRIANGLE.columnMap.right[v]+3){h=TRIANGLE.columnMap.right[v];w=true}}}}return w}function e(){var u=false;var i=t.nextSibling()?t.nextSibling().getAttribute("triangle-index"):null;if(!TRIANGLE.item.isBelow(parseInt(i))){if(t.nextSibling()&&g>=t.nextSibling().getBoundingClientRect().bottom-3&&g<=t.nextSibling().getBoundingClientRect().bottom+3){t.objRef.style.minHeight=(t.nextSibling().getBoundingClientRect().bottom-c.top)+"px";u=true}else{if(t.prevSibling()&&g>=t.prevSibling().getBoundingClientRect().bottom-3&&g<=t.prevSibling().getBoundingClientRect().bottom+3){t.objRef.style.minHeight=(t.prevSibling().getBoundingClientRect().bottom-c.top)+"px";u=true}}}return u}},removeHandles:function removeResizeHandles(){while(document.getElementsByClassName("resizeHandle").length>0){var b=document.getElementsByClassName("resizeHandle");b[0].removeEventListener("mouseover",TRIANGLE.resize.Y);b[0].removeEventListener("mouseover",TRIANGLE.resize.X);b[0].removeEventListener("mouseover",TRIANGLE.resize.XY);b[0].remove()}while(document.getElementsByClassName("marginHandle").length>0){var a=document.getElementsByClassName("marginHandle");a[0].removeEventListener("mouseover",TRIANGLE.resize.margin.top);a[0].removeEventListener("mouseover",TRIANGLE.resize.margin.right);a[0].removeEventListener("mouseover",TRIANGLE.resize.margin.bottom);a[0].removeEventListener("mouseover",TRIANGLE.resize.margin.left);a[0].remove()}},margin:{top:function(){if(!TRIANGLE.resize.active){TRIANGLE.resize.activeElem=TRIANGLE.item.index;TRIANGLE.resize.direction="marginTop"}},bottom:function(){if(!TRIANGLE.resize.active){TRIANGLE.resize.activeElem=TRIANGLE.item.index;TRIANGLE.resize.direction="marginBottom"}},left:function(){if(!TRIANGLE.resize.active){TRIANGLE.resize.activeElem=TRIANGLE.item.index;TRIANGLE.resize.direction="marginLeft"}},right:function(){if(!TRIANGLE.resize.active){TRIANGLE.resize.activeElem=TRIANGLE.item.index;TRIANGLE.resize.direction="marginRight"}},side:null,currentMargin:null,initiate:function(){TRIANGLE.resize.active=true;TRIANGLE.selectItem(TRIANGLE.resize.activeElem);document.body.addEventListener("mouseup",TRIANGLE.resize.margin.stop);TRIANGLE.iframe().contentDocument.body.addEventListener("mouseup",TRIANGLE.resize.margin.stop);TRIANGLE.iframe().contentDocument.body.addEventListener("mousemove",TRIANGLE.resize.margin.start);document.getElementById("dimensionLabels").style.display="inline-block";document.getElementById("widthLabel").innerHTML="M: "+TRIANGLE.item[TRIANGLE.resize.direction];document.getElementById("heightLabel").innerHTML="";TRIANGLE.resize.margin.side=TRIANGLE.resize.direction.replace(/margin/,"").toLowerCase();TRIANGLE.resize.margin.currentMargin=TRIANGLE.item.objRef.getBoundingClientRect()[TRIANGLE.resize.margin.side]-parseFloat(window.getComputedStyle(TRIANGLE.item.objRef).getPropertyValue(TRIANGLE.resize.direction.replace(/([A-Z])/,"-$1").toLowerCase()));TRIANGLE.text.preventTextSelect()},stop:function removeResize(){TRIANGLE.importItem.single(TRIANGLE.item.index);TRIANGLE.resize.activeElem=-1;TRIANGLE.resize.active=false;TRIANGLE.resize.direction=false;TRIANGLE.iframe().getElementById("bottomMarker").style.marginTop=0;TRIANGLE.updateTemplateItems();TRIANGLE.importItem.single(TRIANGLE.item.index);document.body.removeEventListener("mouseup",TRIANGLE.resize.margin.stop);TRIANGLE.iframe().contentDocument.body.removeEventListener("mouseup",TRIANGLE.resize.margin.stop);TRIANGLE.iframe().contentDocument.body.removeEventListener("mousemove",TRIANGLE.resize.margin.start);TRIANGLE.selectionBorder.create();TRIANGLE.text.clearTextSelection();TRIANGLE.text.allowTextSelect();TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass);TRIANGLE.tooltip.hide()},start:function(a){var i=TRIANGLE.item;if(TRIANGLE.resize.active){var h;var d;var b;var f=i.objRef.getBoundingClientRect();var g=document.getElementById("widthLabel");var c=a.shiftKey?5:1;if(TRIANGLE.resize.direction==="marginTop"||TRIANGLE.resize.direction==="marginBottom"){d=TRIANGLE.resize.direction==="marginTop"?"marginBottom":"marginTop";h=a.clientY;b=h<TRIANGLE.resize.margin.currentMargin}else{if(TRIANGLE.resize.direction==="marginLeft"||TRIANGLE.resize.direction==="marginRight"){d=TRIANGLE.resize.direction==="marginLeft"?"marginRight":"marginLeft";h=a.clientX;if(TRIANGLE.resize.direction==="marginLeft"){b=h<TRIANGLE.resize.margin.currentMargin}else{b=h>TRIANGLE.resize.margin.currentMargin}}else{return}}if(TRIANGLE.getUnit(i[TRIANGLE.resize.direction])==="%"){i.objRef.style[TRIANGLE.resize.direction]=Math.abs((Math.ceil((h-TRIANGLE.resize.margin.currentMargin)/i.parent.getBoundingClientRect().width*10000)/100))+"%"}else{i.objRef.style[TRIANGLE.resize.direction]=(Math.floor(Math.abs(h-TRIANGLE.resize.margin.currentMargin)/4/c)*c)+"px"}if(b){i.objRef.style[TRIANGLE.resize.direction]=0}e();if(a.altKey){i.objRef.style[d]=i.objRef.style[TRIANGLE.resize.direction]}g.innerHTML="M: "+i.objRef.style[TRIANGLE.resize.direction];TRIANGLE.saveItem.equalizeUserClasses(TRIANGLE.item.userClass);TRIANGLE.selectionBorder.update();TRIANGLE.tooltip.update(a);TRIANGLE.tooltip.show(g.innerHTML)}function e(){var l=false;if(TRIANGLE.resize.margin.side==="top"||TRIANGLE.resize.margin.side==="bottom"){var j=i.nextSibling()?i.nextSibling().getBoundingClientRect():false;var k=i.prevSibling()?i.prevSibling().getBoundingClientRect():false;if(j&&h>=j[TRIANGLE.resize.margin.side]-3&&h<=j[TRIANGLE.resize.margin.side]+3){i.objRef.style[TRIANGLE.resize.direction]=i.nextSibling().style[TRIANGLE.resize.direction];l=true}else{if(k&&h>=k[TRIANGLE.resize.margin.side]-3&&h<=k[TRIANGLE.resize.margin.side]+3){i.objRef.style[TRIANGLE.resize.direction]=i.prevSibling().style[TRIANGLE.resize.direction];l=true}}}return l}}}};TRIANGLE.popUp={open:function(c){var b=document.getElementsByClassName("popUp");for(var a=0;a<b.length;a++){b[a].style.display="none"}document.getElementById("darkWrapper").style.display="table";document.getElementById(c).style.display="table-cell";document.getElementById("darkWrapper").className="fadeIn"},close:function(){document.getElementById("darkWrapper").style.display="none";var b=document.getElementsByClassName("popUp");for(var a=0;a<b.length;a++){b[a].style.display="none"}}};TRIANGLE.notify={toaster:document.getElementById("toaster"),saving:{show:function(){var a=document.getElementById("toastSaving").cloneNode(true);a.removeAttribute("id");TRIANGLE.notify.toaster.appendChild(a);TRIANGLE.notify.saving.toast=new bootstrap.Toast(a,{autohide:false});a.addEventListener("hidden.bs.toast",function(){TRIANGLE.notify.toaster.removeChild(this)});TRIANGLE.notify.saving.toast.show()},hide:function(){setTimeout(function(){if(TRIANGLE.notify.saving.toast){TRIANGLE.notify.saving.toast.hide()}},150)}},saved:{show:function(){var a=document.getElementById("toastSaved").cloneNode(true);a.removeAttribute("id");TRIANGLE.notify.toaster.appendChild(a);TRIANGLE.notify.saved.toast=new bootstrap.Toast(a,{});a.addEventListener("hidden.bs.toast",function(){TRIANGLE.notify.toaster.removeChild(this)});TRIANGLE.notify.saved.toast.show()},hide:function(){TRIANGLE.notify.saved.toast.hide()}},loading:{show:function(b){var a=document.getElementById("toastLoading").cloneNode(true);a.removeAttribute("id");TRIANGLE.notify.toaster.appendChild(a);TRIANGLE.notify.loading.toast=new bootstrap.Toast(a,{autohide:false});a.addEventListener("hidden.bs.toast",function(){TRIANGLE.notify.toaster.removeChild(this)});TRIANGLE.notify.loading.toast.show();if(typeof b=="function"){b()}},hide:function(){setTimeout(function(){if(TRIANGLE.notify.loading.toast){TRIANGLE.notify.loading.toast.hide()}},150)}},error:{show:function(){var a=document.getElementById("toastError").cloneNode(true);a.removeAttribute("id");TRIANGLE.notify.toaster.appendChild(a);TRIANGLE.notify.error.toast=new bootstrap.Toast(a,{});a.addEventListener("hidden.bs.toast",function(){TRIANGLE.notify.toaster.removeChild(this)});TRIANGLE.notify.error.toast.show()},hide:function(){TRIANGLE.notify.error.toast.hide()}},info:{show:function(b){var a=document.getElementById("toastInfo").cloneNode(true);a.removeAttribute("id");a.querySelector("#toastInfoBody").innerText=b;TRIANGLE.notify.toaster.appendChild(a);TRIANGLE.notify.info.toast=new bootstrap.Toast(a,{autohide:false});a.addEventListener("hidden.bs.toast",function(){TRIANGLE.notify.toaster.removeChild(this)});TRIANGLE.notify.info.toast.show()},hide:function(){TRIANGLE.notify.info.toast.hide()}},};TRIANGLE.draggable={xInitial:null,yInitial:null,active:false,initiate:function(c,b){TRIANGLE.draggable.active=true;function a(d){TRIANGLE.draggable.start(d,b)}document.addEventListener("mousemove",a);document.addEventListener("mouseup",TRIANGLE.draggable.stop);TRIANGLE.draggable.xInitial=c.clientX-b.getBoundingClientRect().left;TRIANGLE.draggable.yInitial=c.clientY-b.getBoundingClientRect().top},start:function(c,b){if(TRIANGLE.draggable.active){var a=b.getBoundingClientRect();b.style.left=c.clientX-TRIANGLE.draggable.xInitial+"px";b.style.top=c.clientY-TRIANGLE.draggable.yInitial+"px"}},stop:function(){TRIANGLE.draggable.active=false;document.removeEventListener("mousemove",TRIANGLE.draggable.start);document.removeEventListener("mouseup",TRIANGLE.draggable.stop)}};TRIANGLE.resetClearFloat=function resetClearFloat(){while(TRIANGLE.iframe().getElementsByClassName("clearFloat").length>0){var a=TRIANGLE.iframe().getElementsByClassName("clearFloat");a[0].parentElement.removeChild(a[0])}};TRIANGLE.insertClearFloats=function insertClearFloats(e){if(e.objRef.style.cssFloat){var b=document.createElement("div");b.className="clearFloat";b.style.clear="both";if(e.nextSibling()&&e.nextSibling().style.cssFloat){return}else{if(e.nextSibling()&&!e.nextSibling().style.cssFloat){e.parent.insertBefore(b,e.nextSibling())}else{if(!e.nextSibling()){e.parent.appendChild(b)}}}if(document.getElementById("visBox")&&!document.getElementById("visBox").style.cssFloat){document.getElementById("visBox").parentNode.insertBefore(b,document.getElementById("visBox"))}for(var a=0;a<e.parent.children.length;a++){var d=e.parent.children[a];var c=d.nextSibling;if(TRIANGLE.isType.clearFloat(d)&&c&&TRIANGLE.isType.clearFloat(c)){d.parentNode.removeChild(c)}}}};TRIANGLE.getOriginalIndex=function getOriginalIndex(a){var b=false;if(a&&!isNaN(a)&&isFinite(a)){b=parseInt(a)}return b};TRIANGLE.isType={templateItem:function(a){if(a){if((/templateItem/g).test(a.getAttribute("triangle-class"))){return true}else{return false}}},childItem:function isChildItem(a){if(a){if((/childItem/g).test(a.getAttribute("triangle-class"))){return true}else{return false}}},textBox:function isTextBox(a){if(a){if((/textbox/g).test(a.getAttribute("triangle-class"))){return true}else{return false}}},imageItem:function isImageItem(a){if(a){if((/img/ig).test(a.tagName)||(/imageItem/g).test(a.getAttribute("triangle-class"))){return true}else{return false}}},snippetItem:function(a){if(a){if((/snippetItem/g).test(a.getAttribute("triangle-class"))){return true}else{return false}}},verticalAlign:function(a){if(a){if((a.style.display==="table"&&(/style="[^"]*vertical-align:\s*middle;[^"]*"/).test(a.innerHTML))||(a.parentElement.style.display==="flex"&&a.parentElement.style.alignItems==="center")){return true}else{return false}}},bannedInsertion:function(a){if(!TRIANGLE.isType.textBox(a)&&!TRIANGLE.isType.imageItem(a)&&!TRIANGLE.isType.formField(a)&&!TRIANGLE.isType.formBtn(a)&&!TRIANGLE.isType.snippetItem(a)){return false}else{return true}},preventDrag:function(a){if(!TRIANGLE.isType.textBox(a)&&!TRIANGLE.isType.formField(a)&&!TRIANGLE.isType.imageItem(a)){return false}else{return true}},itemLabel:function(a){if(a){if(a.tagName.toLowerCase()==="form"){return"Form"}else{if(TRIANGLE.isType.snippetItem(a)){return"Code Snippet"}else{return false}}}else{return false}},clearFloat:function isClearFloat(a){if(a){if((/clearFloat/g).test(a.className)){return true}else{return false}}},formField:function isFormField(a){if(a){if((/formField/g).test(a.className)){return true}else{return false}}},formBtn:function(a){if(a){if(a.tagName.toUpperCase()==="BUTTON"){return true}else{return false}}},containsNbsp:function containsNbsp(a){if(a&&(a.innerHTML=="&nbsp;"||a.childNodes[0]=="&nbsp;")){return true}else{return false}}};TRIANGLE.stripNbsp=function stripNbsp(a){if(a.childNodes[0]=="&nbsp;"){a.removeChild(a.childNodes[0])}else{if(a.innerHTML=="&nbsp;"){a.innerHTML=""}}};TRIANGLE.contentWidth=function(d){var c;var a=document.createElement("div");a.id="measureContentWidth";d.appendChild(a);var b=TRIANGLE.iframe().getElementById("measureContentWidth").getBoundingClientRect();c=b.width;d.removeChild(TRIANGLE.iframe().getElementById("measureContentWidth"));return c};TRIANGLE.getUnit=function getUnit(b){if(b){var a=b.match(/\D+/g);if(a){return a[a.length-1]}else{return false}}else{return false}};TRIANGLE.checkPadding=function checkPadding(a){if((parseInt(a.style.paddingLeft)===0||!a.style.paddingLeft)&&(parseInt(a.style.paddingRight)===0||!a.style.paddingRight)&&(parseInt(a.style.paddingTop)===0||!a.style.paddingTop)&&(parseInt(a.style.paddingBottom)===0||!a.style.paddingBottom)){a.style.padding="15px"}};TRIANGLE.tooltip={show:function showTooltip(a){document.getElementById("tooltip").innerHTML=a;document.getElementById("tooltip").style.display="block"},update:function updateTooltipLocation(a){document.getElementById("tooltip").style.top=(a.clientY+15+TRIANGLE.iframe().getBoundingClientRect().top)+"px";document.getElementById("tooltip").style.left=(a.clientX+15+TRIANGLE.iframe().getBoundingClientRect().left)+"px"},hide:function hideTooltip(){document.getElementById("tooltip").style.display="none"}};TRIANGLE.metaData={title:"",keywords:"",description:"",commaSplit:function(a){var b=a.value;if(b.slice(-1)===" "&&b.slice(-2)!=", "){b=b.slice(0,-1)+", ";a.value=b}},fixCommas:function(a){var b=a.value;b=b.replace(/(\w+)(,+|\s+)(\w+)/g,"$1, $3");b=b.replace(/(\w+)(,+|\s+)(\w+)/g,"$1, $3");b=b.replace(/\s+/g," ");b=b.replace(/,+/g,",");b=b.replace(/\s+,+/g,"");if(b.slice(-1)===" "){b=b.slice(0,-1)}if(b.slice(-1)===","){b=b.slice(0,-1)}a.value=b}};TRIANGLE.keyEvents={shiftKey:false,whichKey:{document:function(b){var a=b.ctrlKey||b.metaKey;if(b.keyCode===27||b.charCode===27){TRIANGLE.menu.closeSideMenu()}if(TRIANGLE.keyEvents.countActiveInputs()>0){return}if(a&&b.keyCode===86){TRIANGLE.keyEvents.keyCtrlV()}if(a&&b.keyCode===83){TRIANGLE.keyEvents.keyCtrlS()}if(a&&b.keyCode===90){TRIANGLE.keyEvents.keyCtrlZ()}if(b.shiftKey&&b.keyCode===84){TRIANGLE.keyEvents.keyShiftT()}if(b.shiftKey&&b.keyCode===80){TRIANGLE.keyEvents.keyShiftP()}if(b.keyCode===76){TRIANGLE.keyEvents.keyL()}if(b.keyCode===77){TRIANGLE.keyEvents.keyM()}if(b.keyCode===78){TRIANGLE.options.newRow()}if(!a&&b.keyCode===72){TRIANGLE.keyEvents.keyH()}if(!a&&b.keyCode===88){TRIANGLE.keyEvents.keyX()}if(a&&(b.keyCode===37||b.charCode===37||b.keyCode===40||b.charCode===40)){TRIANGLE.options.decreaseOpacity()}if(a&&(b.keyCode===38||b.charCode===38||b.keyCode===39||b.charCode===39)){TRIANGLE.options.increaseOpacity()}},item:function(b){var a=b.ctrlKey||b.metaKey;if(b.keyCode===27||b.charCode===27){TRIANGLE.keyEvents.keyEsc()}if(TRIANGLE.keyEvents.countActiveInputs()>0){return}if(a&&b.keyCode===219){TRIANGLE.keyEvents.keyCtrlBracketLeft()}if(b.keyCode===13){TRIANGLE.keyEvents.keyEnter()}if(b.keyCode===46||b.charCode===46||b.keyCode===8||b.charCode===8){TRIANGLE.keyEvents.keyDelete()}if(!a&&(b.keyCode===38||b.charCode===38||b.keyCode===37||b.charCode===37)){TRIANGLE.keyEvents.keyUpArrow()}if(!a&&(b.keyCode===40||b.charCode===40||b.keyCode===39||b.charCode===39)){TRIANGLE.keyEvents.keyDownArrow()}if(b.keyCode===73||b.charCode===73){TRIANGLE.keyEvents.keyI()}if(a&&b.keyCode===67){TRIANGLE.keyEvents.keyCtrlC()}if(a&&b.keyCode===88){TRIANGLE.keyEvents.keyCtrlX()}if(b.keyCode===68){TRIANGLE.keyEvents.keyD()}}},paste:function(a){if((a.ctrlKey||a.metaKey)&&a.keyCode===86){TRIANGLE.keyEvents.keyCtrlV()}},keyDelete:function deleteKey(a){if(TRIANGLE.item){TRIANGLE.deleteItem(TRIANGLE.item.index);document.body.removeAttribute("onKeyUp")}},keyUpArrow:function upArrowKey(a){if(TRIANGLE.keyEvents.countActiveInputs()){return}TRIANGLE.options.shiftUp(TRIANGLE.item.index);TRIANGLE.updateTemplateItems()},keyDownArrow:function downArrowKey(a){if(TRIANGLE.keyEvents.countActiveInputs()){return}TRIANGLE.options.shiftDown(TRIANGLE.item.index);TRIANGLE.updateTemplateItems()},keyEsc:function escKey(a){if(TRIANGLE.item&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.item.objRef.blur();TRIANGLE.text.checkTextEditing()}if(document.getElementById("cropImgBorder")){TRIANGLE.images.crop.cancel()}if(TRIANGLE.colors.colorDropIndex>-1){TRIANGLE.colors.cancelColorDropper()}TRIANGLE.clearSelection()},keyEnter:function(a){if(TRIANGLE.images.crop.active){TRIANGLE.images.crop.applyCrop()}},keyI:function letterKeyI(a){TRIANGLE.colors.colorDropper()},keyCtrlC:function(){if(TRIANGLE.item){TRIANGLE.options.copyStyles(TRIANGLE.item.index)}},keyCtrlV:function(){TRIANGLE.options.pasteStyles()},keyCtrlS:function(){if(document.getElementById("saveCurrentTemplate").parentNode.style.display!="none"&&TRIANGLE.currentTemplate!="default"){TRIANGLE.saveTemplate.saveCurrent()}else{TRIANGLE.saveTemplate.getSaveName()}},keyCtrlZ:function(){if(!TRIANGLE.item||!TRIANGLE.item.objRef.isContentEditable){TRIANGLE.options.undo()}},keyCtrlX:function(){if(TRIANGLE.item){TRIANGLE.options.copyStyles(TRIANGLE.item.index);TRIANGLE.item.remove();TRIANGLE.updateTemplateItems()}},keyCtrlBracketLeft:function(){TRIANGLE.selectParent()},keyShiftT:function(){TRIANGLE.text.insertTextBox()},keyShiftP:function(){TRIANGLE.exportTemplate.preview()},keyL:function(){TRIANGLE.library.load();TRIANGLE.menu.openSideMenu("libraryMenu")},keyM:function(){TRIANGLE.images.load();TRIANGLE.menu.openSideMenu("imageLibraryMenu")},keyH:function(){TRIANGLE.menu.displaySubMenu("displayDeveloper");TRIANGLE.menu.menuBtnActive(document.getElementById("opDeveloper"));if(TRIANGLE.item&&TRIANGLE.isType.textBox(TRIANGLE.item.objRef)){TRIANGLE.developer.editInnerHTML()}},keyX:function(){TRIANGLE.menu.displaySubMenu("displayDeveloper");TRIANGLE.menu.menuBtnActive(document.getElementById("opDeveloper"));TRIANGLE.developer.editCSS()},keyD:function(){TRIANGLE.options.duplicate()},countActiveInputs:function countActiveInputs(){var e=document.getElementsByTagName("input");var b=document.getElementsByTagName("textarea");var f=document.getElementsByTagName("select");var a=TRIANGLE.iframe().querySelectorAll("[triangle-class~=textbox]");var d=0;for(var c=0;c<e.length;c++){if(e[c]===document.activeElement){d++}else{d+=0}}for(var c=0;c<b.length;c++){if(b[c]===document.activeElement){d++}else{d+=0}}for(var c=0;c<f.length;c++){if(f[c]===document.activeElement){d++}else{d+=0}}for(var c=0;c<a.length;c++){if(a[c].isContentEditable){d++}else{d+=0}}return d}};TRIANGLE.styleFunctions=[function(b,a){b.style.cssText=a},function(b,a){b.innerHTML=a},function(b,a){b.className=a},function(b,a){if(a){b.setAttribute("triangle-class",a)}},function(b,a){if(a){b.setAttribute("item-align",a)}},function(b,a){if(a){b.setAttribute("user-id",a)}},function(b,a){if(a){b.setAttribute("hover-style",a)}},function(b,a){if(a){b.setAttribute("link-to",a)}},function(b,a){if(a){b.setAttribute("name",a)}},function(b,a){if(a){b.setAttribute("onClick",a)}},function(b,a){if(a){b.setAttribute("crop-map",a)}},function(b,a){if(a){b.setAttribute("crop-ratio",a)}},function(b,a){if(a){b.setAttribute("target",a)}},function(b,a){if(a){b.setAttribute("user-class",a)}},function(b,a){if(a){b.setAttribute("form-email",a)}}];TRIANGLE.getStyles=function getStyles(b){var a=[b.style.cssText,b.innerHTML,b.className,b.getAttribute("triangle-class"),b.getAttribute("item-align"),b.getAttribute("user-id"),b.getAttribute("hover-style"),b.getAttribute("link-to"),b.getAttribute("name"),b.getAttribute("onClick"),b.getAttribute("crop-map"),b.getAttribute("crop-ratio"),b.getAttribute("target"),b.getAttribute("user-class"),b.getAttribute("form-email")];return a};TRIANGLE.iframe().getElementByUserId=function getElementByUserId(b){for(var a=0;a<TRIANGLE.templateItems.length;a++){if(TRIANGLE.templateItems[a].getAttribute("user-id")===b){return TRIANGLE.templateItems[a]}}};TRIANGLE.effects={enterStudio:function(){document.getElementById("effectStudioMenu").style.display="block"},exitStudio:function(){document.getElementById("effectStudioMenu").style.display="none"}};TRIANGLE.effects.hover={transferStyles:function hoverStyle(c){if(c.getAttribute("hover-style")){var a=new RegExp("#"+c.getAttribute("id")+"(:hover)*{[^}]}","g");var b=document.getElementById("hoverData");if((a).test(b.innerHTML)){b.innerHTML=b.innerHTML.replace(a,"")}b.innerHTML+="#"+c.getAttribute("id")+"{"+c.getAttribute("style")+"}#"+c.getAttribute("id")+":hover{"+c.getAttribute("hover-style")+"}"}},prepareStyles:function prepareHoverStyles(){var b=document.getElementById("hoverData");b.innerHTML="";for(var a=0;a<TRIANGLE.templateItems.length;a++){TRIANGLE.effects.hover.transferStyles(TRIANGLE.templateItems[a])}},createHoverVersion:function(b){var a=document.createElement(b.tagName);a.style.cssText=b.getAttribute("hover-style");a.setAttribute("id",b.getAttribute("id")+":hover");document.getElementById("hoverItems").appendChild(a)},addStyle:function(){if(!TRIANGLE.item.hoverVersion){TRIANGLE.effects.hover.createHoverVersion(TRIANGLE.item.objRef)}TRIANGLE.updateTemplateItems()}};TRIANGLE.forms={insertForm:function insertForm(){var d=TRIANGLE.item;if(d&&d.tag==="FORM"){return}if(d&&TRIANGLE.isType.bannedInsertion(d.objRef)){return}if(d&&d.objRef.children[0]&&d.objRef.children[0].style.display==="table-cell"){return}var a=document.createElement("form");a.setAttribute("triangle-class","templateItem childItem");a.style.backgroundColor="inherit";a.style.height="auto";a.style.width="100%";a.style.borderLeft="1px dashed gray";a.style.borderRight="1px dashed gray";a.style.borderTop="1px dashed gray";a.style.borderBottom="1px dashed gray";if(d){TRIANGLE.checkPadding(d.objRef);d.append(a)}else{TRIANGLE.options.newRow();TRIANGLE.updateTemplateItems();TRIANGLE.selectItem(TRIANGLE.templateItems[TRIANGLE.templateItems.length-1].getAttribute("triangle-index"));d=TRIANGLE.item;TRIANGLE.checkPadding(d.objRef);d.append(a)}TRIANGLE.updateTemplateItems();TRIANGLE.selectionBorder.remove();var e=d.objRef.children.length;var c=d.objRef.children[e-1];var b=c.getAttribute("triangle-index");TRIANGLE.selectItem(b);TRIANGLE.saveItem.createAnimation("min-height",0,"100px",function(){TRIANGLE.importItem.single(TRIANGLE.item.index)});TRIANGLE.updateTemplateItems()},insertField:function insertFormField(){for(var a=0;a<TRIANGLE.templateItems.length;a++){var b;if(a===0){b=new TRIANGLE.TemplateItem(TRIANGLE.item.index)}if(b.parent.getAttribute("id")==="template"){return}if(b.parent.tagName.toUpperCase()==="FORM"||TRIANGLE.item.tag.toUpperCase()==="FORM"){break}else{b=new TRIANGLE.TemplateItem(b.parent.getAttribute("triangle-index"))}}TRIANGLE.text.insertTextBox("Field Label");var c=document.createElement("div");c.setAttribute("triangle-class","templateItem childItem formField");c.style.backgroundColor="white";c.style.minHeight="24px";c.style.height="24px";c.style.width="100%";c.style.paddingLeft="2px";c.style.paddingRight="2px";c.style.paddingTop="2px";c.style.paddingBottom="2px";c.style.borderLeft="1px solid gray";c.style.borderRight="1px solid gray";c.style.borderTop="1px solid gray";c.style.borderBottom="1px solid gray";c.style.marginTop="3px";c.style.marginBottom="8px";c.style.font="inherit";TRIANGLE.item.append(c);TRIANGLE.updateTemplateItems();TRIANGLE.importItem.single(TRIANGLE.item.index)},insertButton:function insertFormBtn(){if(TRIANGLE.item&&TRIANGLE.item.tag!=="FORM"){return}for(var b=0;b<TRIANGLE.item.objRef.children.length;b++){if(TRIANGLE.item.objRef.children[b].tagName==="BUTTON"){return}}var a=document.createElement("button");a.setAttribute("triangle-class","templateItem childItem");a.innerHTML="Submit";a.style.display="block";a.style.margin="0 auto";a.setAttribute("onClick","event.preventDefault();");TRIANGLE.item.append(a);TRIANGLE.updateTemplateItems(true);TRIANGLE.importItem.single(TRIANGLE.item.index)}};TRIANGLE.columnMap={template:{left:null,right:null},left:[],right:[],leftRound:[],rightRound:[]};TRIANGLE.locateColumns=function locateColumns(){var b=TRIANGLE.template().getBoundingClientRect();TRIANGLE.columnMap.template.left=b.left;TRIANGLE.columnMap.template.right=b.right;for(var a=0,d=0;a<TRIANGLE.templateItems.length;a++){var c=TRIANGLE.templateItems[a].getBoundingClientRect();TRIANGLE.columnMap.left[a]=c.left;TRIANGLE.columnMap.right[a]=c.right;TRIANGLE.columnMap.leftRound[a]=Math.round(c.left);TRIANGLE.columnMap.rightRound[a]=Math.round(c.right)}return TRIANGLE.columnMap};TRIANGLE.defaultSettings=function defaultSettings(){TRIANGLE.styleSheets.xs=TRIANGLE.iframe().getElementById("templateStylesXS").sheet;TRIANGLE.styleSheets.xs.disabled=true;TRIANGLE.styleSheets.sm=TRIANGLE.iframe().getElementById("templateStylesSM").sheet;TRIANGLE.styleSheets.sm.disabled=true;TRIANGLE.styleSheets.md=TRIANGLE.iframe().getElementById("templateStylesMD").sheet;TRIANGLE.styleSheets.md.disabled=true;TRIANGLE.styleSheets.lg=TRIANGLE.iframe().getElementById("templateStylesLG").sheet;TRIANGLE.styleSheets.active=TRIANGLE.styleSheets.lg;TRIANGLE.maxAllowedItems=100;TRIANGLE.colors.updateBodyBg();TRIANGLE.menu.displaySubMenu("displayInsert");TRIANGLE.menu.addMenuBtnEvent();TRIANGLE.menu.menuBtnActive(document.getElementById("opInsert"));document.getElementById("colorMainBg").style.backgroundColor=document.body.style.backgroundColor;TRIANGLE.templateWrapper().addEventListener("mousedown",TRIANGLE.clearSelection,true);TRIANGLE.iframe().getElementById("bottomMarker").addEventListener("mousedown",TRIANGLE.clearSelection,true);TRIANGLE.templateWrapper().addEventListener("mouseup",TRIANGLE.text.checkTextEditing,true);TRIANGLE.iframe().getElementById("bottomMarker").addEventListener("mouseup",TRIANGLE.text.checkTextEditing,true);document.body.addEventListener("mouseover",TRIANGLE.hoverBorder.hide,true);TRIANGLE.iframe().contentDocument.addEventListener("mouseover",TRIANGLE.hoverBorder.hide,true);document.body.addEventListener("keydown",TRIANGLE.keyEvents.whichKey.item);TRIANGLE.iframe().contentDocument.body.addEventListener("keydown",TRIANGLE.keyEvents.whichKey.item);document.getElementById("exportPublish").addEventListener("click",TRIANGLE.exportTemplate.publish.prompt);document.getElementById("exportPublishSend").addEventListener("click",TRIANGLE.exportTemplate.publish.send);document.getElementById("exportPublishCancel").addEventListener("click",TRIANGLE.exportTemplate.publish.cancel);document.getElementById("exportZip").addEventListener("click",function(){TRIANGLE.notify.loading.show(TRIANGLE.exportTemplate.zip)});document.getElementById("exportRaw").addEventListener("click",function(){TRIANGLE.notify.loading.show(TRIANGLE.exportTemplate.raw)});document.getElementById("exportPreview").addEventListener("click",function(){TRIANGLE.notify.loading.show(TRIANGLE.exportTemplate.preview)});document.getElementById("fixedWidth").addEventListener("click",TRIANGLE.options.getFixedWidth);document.getElementById("fluidWidth").addEventListener("click",TRIANGLE.options.fluidWidth);document.getElementById("newRow").addEventListener("click",TRIANGLE.options.newRow);document.getElementById("blankTemplate").addEventListener("click",TRIANGLE.options.blankTemplate);document.getElementById("insert2columns").addEventListener("click",function(){TRIANGLE.options.insertColumns(2)});document.getElementById("insert3columns").addEventListener("click",function(){TRIANGLE.options.insertColumns(3)});document.getElementById("opDuplicateElement").addEventListener("click",TRIANGLE.options.duplicate);document.getElementById("opInsertNewChild").addEventListener("click",TRIANGLE.options.insertNewChild);document.getElementById("opSelectParent").addEventListener("click",TRIANGLE.options.selectParent);document.getElementById("opHyperlink").addEventListener("click",TRIANGLE.text.createHyperlink);document.getElementById("opUndo").addEventListener("click",TRIANGLE.options.undo);document.getElementById("opDeleteElement").addEventListener("click",TRIANGLE.deleteItem);document.getElementById("opShiftUp").addEventListener("click",TRIANGLE.options.shiftUp);document.getElementById("opShiftDown").addEventListener("click",TRIANGLE.options.shiftDown);document.getElementById("opCopyStyles").addEventListener("click",TRIANGLE.options.copyStyles);document.getElementById("opPasteStyles").addEventListener("click",TRIANGLE.options.pasteStyles);document.getElementById("opDeselect").addEventListener("click",TRIANGLE.clearSelection);document.getElementById("uploadImagesBtn").addEventListener("click",TRIANGLE.images.upload);var f=document.querySelectorAll(".edgeOptionBtn");for(var b=0;b<f.length;b++){f[b].addEventListener("click",function(){var k=this.parentNode.querySelectorAll(".edgeOptionActive");for(var l=0;l<k.length;l++){k[l].classList.remove("edgeOptionActive")}this.classList.add("edgeOptionActive");document.getElementById(this.parentNode.getAttribute("data-input")).focus();if(TRIANGLE.item){TRIANGLE.importItem.single(TRIANGLE.item.index)}})}TRIANGLE.developer.editor.setTheme("ace/theme/dracula");TRIANGLE.developer.editor.setOptions({fontFamily:"Roboto Mono",fontSize:"14px",useSoftTabs:true,navigateWithinSoftTabs:true,maxLines:30,minLines:20});TRIANGLE.developer.EditSession=ace.require("ace/edit_session").EditSession;TRIANGLE.developer.sessions.innerHTML=ace.createEditSession("html");TRIANGLE.developer.sessions.innerHTML.setOptions({mode:"ace/mode/html",tabSize:2,navigateWithinSoftTabs:true});TRIANGLE.developer.sessions.innerHTML.on("change",TRIANGLE.saveItem.innerHTML);TRIANGLE.developer.sessions.outerHTML=ace.createEditSession("html");TRIANGLE.developer.sessions.outerHTML.setOptions({mode:"ace/mode/html",tabSize:2,navigateWithinSoftTabs:true});TRIANGLE.developer.sessions.outerHTML.on("change",TRIANGLE.saveItem.outerHTML);TRIANGLE.developer.sessions.css=ace.createEditSession("css");TRIANGLE.developer.sessions.css.setOptions({mode:"ace/mode/css",tabSize:2,navigateWithinSoftTabs:true,useWorker:false});TRIANGLE.developer.sessions.css.on("change",TRIANGLE.saveItem.cssStyles);TRIANGLE.developer.sessions.hover=ace.createEditSession("hover");TRIANGLE.developer.sessions.hover.setOptions({mode:"ace/mode/css",tabSize:2,navigateWithinSoftTabs:true,useWorker:false});TRIANGLE.developer.sessions.hover.on("change",TRIANGLE.saveItem.hoverStyles);TRIANGLE.developer.sessions.styleTag=ace.createEditSession("style");TRIANGLE.developer.sessions.styleTag.setOptions({mode:"ace/mode/css",tabSize:2,navigateWithinSoftTabs:true});TRIANGLE.developer.sessions.styleTag.on("change",TRIANGLE.developer.saveStyleTag);TRIANGLE.developer.sessions.globalStyleTag=ace.createEditSession("globalStyle");TRIANGLE.developer.sessions.globalStyleTag.setOptions({mode:"ace/mode/css",tabSize:2,navigateWithinSoftTabs:true});TRIANGLE.developer.sessions.globalStyleTag.on("change",TRIANGLE.developer.saveGlobalStyleTag);TRIANGLE.developer.sessions.scriptTag=ace.createEditSession("script");TRIANGLE.developer.sessions.scriptTag.setOptions({mode:"ace/mode/javascript",tabSize:2,navigateWithinSoftTabs:true});TRIANGLE.developer.sessions.scriptTag.on("change",TRIANGLE.developer.saveScriptTag);TRIANGLE.developer.sessions.globalScriptTag=ace.createEditSession("globalScript");TRIANGLE.developer.sessions.globalScriptTag.setOptions({mode:"ace/mode/javascript",tabSize:2,navigateWithinSoftTabs:true});TRIANGLE.developer.sessions.globalScriptTag.on("change",TRIANGLE.developer.saveGlobalScriptTag);TRIANGLE.developer.sessions.codeSnippet=ace.createEditSession("codeSnippet");TRIANGLE.developer.sessions.codeSnippet.setOptions({mode:"ace/mode/html",tabSize:2,navigateWithinSoftTabs:true});TRIANGLE.developer.sessions.codeSnippet.on("change",TRIANGLE.developer.saveCodeSnippet);var h=document.getElementById("menu").getElementsByTagName("input");for(var b=0;b<h.length;b++){switch(h[b].id){case"margin":h[b].addEventListener("keyup",TRIANGLE.saveItem.saveMargin);break;case"borderWidth":h[b].addEventListener("keyup",TRIANGLE.saveItem.saveBorder);break;case"borderColor":h[b].addEventListener("keyup",TRIANGLE.saveItem.saveBorder);break;default:h[b].addEventListener("keyup",TRIANGLE.saveItem.applyChanges);break}}document.addEventListener("scroll",function(){TRIANGLE.hoverBorder.hide();TRIANGLE.selectionBorder.update();TRIANGLE.dragDrop.updateItemMap()});TRIANGLE.iframe().contentDocument.addEventListener("scroll",function(){TRIANGLE.hoverBorder.hide();TRIANGLE.selectionBorder.update();TRIANGLE.dragDrop.updateItemMap()});function e(){TRIANGLE.dragDrop.stop();setTimeout(TRIANGLE.options.compareUndoList,TRIANGLE.saveItem.animationTime+30)}document.addEventListener("mouseup",e);TRIANGLE.iframe().contentDocument.addEventListener("mouseup",e);function d(){if(TRIANGLE.item&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.text.originalTextPosition=TRIANGLE.text.getSelectionCoords().r}}document.addEventListener("mousedown",d);TRIANGLE.iframe().contentDocument.addEventListener("mousedown",d);function a(k){TRIANGLE.iframe().getElementById("updateAnimation").innerHTML="";var i=k.ctrlKey||k.metaKey;if(k.keyCode==8&&!TRIANGLE.keyEvents.countActiveInputs()){k.preventDefault()}if(i&&k.keyCode===83){k.preventDefault()}if((!TRIANGLE.item||!TRIANGLE.item.objRef.isContentEditable)&&i&&k.keyCode===90){k.preventDefault()}if(i&&k.keyCode==86&&TRIANGLE.item&&TRIANGLE.item.objRef.isContentEditable){TRIANGLE.text.originalTextPosition=TRIANGLE.text.getSelectionCoords().r}TRIANGLE.keyEvents.whichKey.document(k);setTimeout(TRIANGLE.options.compareUndoList,TRIANGLE.saveItem.animationTime+30)}document.addEventListener("keydown",a);TRIANGLE.iframe().contentDocument.addEventListener("keydown",a);window.addEventListener("resize",TRIANGLE.selectionBorder.update);TRIANGLE.iframe().contentWindow.addEventListener("resize",TRIANGLE.selectionBorder.update);TRIANGLE.images.load();TRIANGLE.library.load();TRIANGLE.colors.fillCanvas("red");TRIANGLE.colors.setColorBoxEvents();var g=document.querySelectorAll(".draggable");for(var b=0;b<g.length;b++){g[b].addEventListener("mousedown",function(i){TRIANGLE.draggable.initiate(i,document.getElementById(this.getAttribute("draggable-target")))},true)}TRIANGLE.images.crop.addHandleEventListeners();var c=document.createElement("div");c.className="scrollbar-measure";document.body.appendChild(c);TRIANGLE.scrollbarWidth=c.offsetWidth-c.clientWidth;document.body.removeChild(c);document.body.addEventListener("mousedown",function(i){if(i.target.tagName.toLowerCase()==="img"){i.preventDefault()}});TRIANGLE.iframe().contentDocument.body.addEventListener("mousedown",function(i){if(i.target.tagName.toLowerCase()==="img"){i.preventDefault()}});var j=function(o){o=o||window.event;var n=o.target||o.srcElement;while(n.tagName&&n.tagName.toLowerCase()!="a"&&!TRIANGLE.isType.textBox(n)){n=n.parentNode}if(n.tagName&&n.tagName.toLowerCase()==="a"){if(!o.preventDefault){o.returnValue=false;o.cancelBubble=true}o.preventDefault();o.stopPropagation();TRIANGLE.text.importedHyperlink=n;if(TRIANGLE.item){document.getElementById("hrefHyperlink").disabled=false;document.getElementById("hrefHyperlink").value=TRIANGLE.text.importedHyperlink.getAttribute("href");var p=document.getElementById("hrefTarget");p.disabled=false;var m=TRIANGLE.text.importedHyperlink.getAttribute("target");var k=0;for(var l=0;l<p.length;l++){if(m===p.options[l].text){k=l}}p.selectedIndex=k}}};if(window.addEventListener){TRIANGLE.template().addEventListener("click",j,false)}else{TRIANGLE.template().attachEvent("onclick",j)}window.onbeforeunload=function(){if(TRIANGLE.unsaved){return"Changes you made may not be saved"}};TRIANGLE.updateTemplateItems()};